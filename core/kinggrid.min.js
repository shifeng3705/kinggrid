!function(t){t.Thenjs=function(){"use strict";var f=100,e=Object.prototype.toString,o=typeof setImmediate==="function"?setImmediate:function(t){setTimeout(t,0)},h=Array.isArray||function(t){return e.call(t)==="[object Array]"};function i(t,e){var n=t.length,r=Array(n);e=e||0;while(n-- >e)r[n-e]=t[n];return r}function p(e,t){try{t.apply(null,i(arguments,2))}catch(t){e(t)}}function g(e,t){var n=i(arguments,2);o(function(){try{t.apply(null,n)}catch(t){e(t)}})}function a(t,e){var n=this,r;if(t instanceof a)return t;if(!(n instanceof a))return new a(t,e);n._success=n._each=n._eachSeries=n._parallel=n._series=null;n._finally=n._error=n._fail=n._result=n._nextThen=n._chain=null;if(!arguments.length)return n;r=l(n,e);try{if(typeof t==="function")t(r);else if(t==null)r();else if(typeof t.toThunk==="function")t.toThunk()(r);else if(typeof t.then==="function")t.then(function(t){r(null,t)},r);else r(null,t)}catch(t){r(t)}}a.defer=g,a.each=function(e,n,t){return d(function(t){g(t,m,t,e,n)},null,t)},a.eachSeries=function(e,n,t){return d(function(t){g(t,w,t,e,n)},null,t)},a.parallel=function(e,t){return d(function(t){g(t,_,t,e)},null,t)},a.series=function(e,t){return d(function(t){g(t,S,t,e)},null,t)},a.nextTick=function(t){var e=i(arguments,1);o(function(){t.apply(null,e)})},a.onerror=function(t){console.error("Thenjs caught error: ",t);throw t};var r=a.prototype;function u(e){var n=this,t=arguments;if(n._result===false)return;if(!n._result&&n._chain)n.debug.apply(n,["\nChain "+n._chain+": "].concat(i(t)));n._result=false;try{s(n,t,e)}catch(t){o(function(){c(n,t,e)})}}function s(t,e,n){if(t._finally)return t._finally.apply(null,e);if(n!=null)throw n;var r=t._success||t._each||t._eachSeries||t._parallel||t._series;if(r)return r.apply(null,i(e,1));t._result=e}function c(t,e,n){var r=t,i=t._error||t._fail;if(t._nextThen&&n==null){i=null;r=t._nextThen}while(!i&&r){i=r._fail;r=r._nextThen}if(i)return i(e);if(a.onerror)return a.onerror(e);r._result=[e]}function l(t,e){function n(){return u.apply(t,arguments)}n._isCont=true;if(e){r.debug=typeof e==="function"?e:C;t._chain=1}return n}function d(t,e,n){var r=new a,i=l(r,n);t(i,e);if(!e)return r;e._nextThen=r;if(e._chain)r._chain=e._chain+1;if(e._result)o(function(){u.apply(e,e._result)});return r}function v(t,e){return e._isCont?e:function(){e.apply(null,[t].concat(i(arguments)))}}function y(n,r,i,o){function t(t,e){if(i.finished)return;if(t!=null)return i.finished=true,n(t);r[o]=e;return--i.i<0&&n(null,r)}t._isCont=true;return t}function m(t,e,n){var r,i=[],o={};if(!h(e))return t(x(e,"each"));o.i=r=e.length-1;if(r<0)return t(null,i);for(var a=0;a<=r;a++)n(y(t,i,o,a),e[a],a,e)}function _(t,e){var n,r=[],i={};if(!h(e))return t(x(e,"parallel"));i.i=n=e.length-1;if(n<0)return t(null,r);for(var o=0;o<=n;o++)e[o](y(t,r,i,o),o,e)}function w(n,r,i){var o=0,a,u=[],s,c=f;function l(t,e){if(t!=null)return n(t);u[o]=e;if(++o>a)return n(null,u);s=--c>0?p:(c=f,g);s(n,i,l,r[o],o,r)}l._isCont=true;if(!h(r))return n(x(r,"eachSeries"));a=r.length-1;if(a<0)return n(null,u);i(l,r[0],0,r)}function S(n,r){var i=0,o,a=[],u,s=f;function c(t,e){if(t!=null)return n(t);a[i]=e;if(++i>o)return n(null,a);u=--s>0?p:(s=f,g);u(n,r[i],c,i,r)}c._isCont=true;if(!h(r))return n(x(r,"series"));o=r.length-1;if(o<0)return n(null,a);r[0](c,0,r)}function C(){console.log.apply(console,arguments)}function x(t,e){return new Error("The argument "+(t&&t.toString())+' in "'+e+'" is not Array!')}return r.fin=r.all=r["finally"]=function(n){return d(function(t,e){e._finally=v(t,n)},this)},r.then=function(n,r){return d(function(t,e){e._success=v(t,n);e._error=r&&v(t,r)},this)},r.fail=r["catch"]=function(n){return d(function(t,e){e._fail=v(t,n);e._success=function(){t.apply(null,[null].concat(i(arguments)))}},this)},r.each=function(r,i){return d(function(n,t){t._each=function(t,e){m(n,r||t,i||e)}},this)},r.eachSeries=function(r,i){return d(function(n,t){t._eachSeries=function(t,e){w(n,r||t,i||e)}},this)},r.parallel=function(n){return d(function(e,t){t._parallel=function(t){_(e,n||t)}},this)},r.series=function(n){return d(function(e,t){t._series=function(t){S(e,n||t)}},this)},r.toThunk=function(){var e=this;return function(t){if(e._result){t.apply(null,e._result);e._result=false}else if(e._result!==false)e._finally=t}},a.NAME="Thenjs",a.VERSION="1.3.4",a}()}(this),function(q){var t,H=q.Thenjs;(q=window).kinggrid=t=null==t?new function(){function c(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length}function e(t){this.map=t}var a=!1,s=(q.JSON&&(a='{"x":"中"}'!==q.JSON.stringify({x:"中"})),!!window.ActiveXObject||"ActiveXObject"in window),G=(c.prototype={clamp:function(){var t=this.words,e=this.sigBytes;t[e>>>2]&=4294967295<<32-e%4*8,t.length=Math.ceil(e/4)},toString:function(t){return(t||G).stringify(this)}},{stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i++){var o=e[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new c.init(n,e/2)}}),N=function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i++){var o=e[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},B=function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new c(n,e)},n={stringify:function(t){try{return decodeURIComponent(escape(N(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return B(unescape(encodeURIComponent(t)))}},r=(e.map={},e.of=function(t){t=t||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return e.map[t]||new e(t)},e.prototype={decodeByte:function(t){for(var e,n,r=t.length,i=this.map,o=i.charAt(64),a=(!o||-1!=(o=t.indexOf(o))&&(r=o),[]),u=0,s=0;s<r;s++)s%4&&(e=i.indexOf(t.charAt(s-1))<<s%4*2,n=i.indexOf(t.charAt(s))>>>6-s%4*2,a[u>>>2]|=(e|n)<<24-u%4*8,u++);return new c(a,u)},decode:function(t){return n.stringify(this.decodeByte(t))},encode:function(t){if(t)return this.encodeByte(n.parse(t))},encodeByte:function(t){for(var e=t.words,n=t.sigBytes,r=this.map,i=(t.clamp(),[]),o=0;o<n;o+=3)for(var a=(e[o>>>2]>>>24-o%4*8&255)<<16|(e[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|e[o+2>>>2]>>>24-(o+2)%4*8&255,u=0;u<4&&o+.75*u<n;u++)i.push(r.charAt(a>>>6*(3-u)&63));var s=r.charAt(64);if(s)for(;i.length%4;)i.push(s);return i.join("")}},!{toString:null}.propertyIsEnumerable("toString")),u=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function i(t,e){var n=u.length,r=t.constructor,i=y.is("Function",r)&&r.prototype||ObjProto,o="constructor";for(y.has(t,o)&&!_.contains(e,o)&&e.push(o);n--;)(o=u[n])in t&&t[o]!==i[o]&&!_.contains(e,o)&&e.push(o)}var l=function(t,e){var n=t.length,r=[];for(e=e||0;n-- >e;)r[n-e]=t[n];return r};function o(){}function f(){return(new Date).getTime()}function t(t){this.name=t}function h(t,e){var n,r=0,i="";for(n in t){var o=t[n];if(null!=o){function a(t){0<r&&(i+=e),i+=n+"="+t,r++}if(y.is("Array",o))for(var u=0;u<o.length;u++)a(o[u]);else a(o)}}return P.trigger("formatData",i),i}function p(t,e){var n="",e=e||"";if(y.is("Array",t))for(var r=0;r<t.length;r++)0<r&&(n+=e),n+=h(t[r],e);else n=h(t,e);return n}function g(t,e){P.trigger.apply(P,["response",e].concat(this)),l(arguments,1),t&&t(e)}var d,U,v,y={Utf8:n,Base64:e,slice:l,boolean:function(t,e,n){return Boolean(t.hasOwnProperty(e)?t[e]:n)},rand:function(t){return Math.ceil((9301*(new Date).getTime()+49297)%233280/233280*t)},addEvent:(I=q.document.attachEvent,v="micromessenger"!=(A=navigator.userAgent.toLowerCase()).match(/MicroMessenger/i)&&("qq"!=A.match(/QQ/i)&&("weibo"!=A.match(/WeiBo/i)&&(null!=A.match(/Android/i)?null==A.match(/browser/i):null!=A.match(/iPhone/i)?null==A.match(/safari/i):null==A.match(/macintosh/i)&&null==A.match(/windows/i)))),I?function(e,t,n){for(var r=t.split(" "),i=0;i<r.length;i++)e.attachEvent("on"+r[i],function(t){t.target=e,t.preventDefault=o,t.stopPropagation=o,n(t)})}:function(t,e,n){void 0===t.eventList&&(t.eventList={});for(var r=e.split(" "),i=0;i<r.length;i++){for(var o in t.eventList)if(o===r[i])return;v?t.addEventListener(r[i],n):document.addEventListener.apply(t,[r[i]].concat(y.slice(arguments,2))),t.eventList[r[i]]=!0}}),extend:(d=function(t){if(!y.is("Object",t))return[];var e,n=[];for(e in t)n.push(e);return r&&i(t,n),n},function(t){var e=arguments.length;if(e<2||null==t)return t;for(var n=1;n<e;n++)for(var r=arguments[n],i=d(r),o=i.length,a=0;a<o;a++){var u=i[a];U&&void 0!==t[u]||(t[u]=r[u])}return t}),filter:function(t,e){var n,r,i={},o=e;for(n in y.is("String",e)&&(r=y.slice(arguments,1),o=function(t){for(var e=0;e<r.length;e++)if(r[e]===t)return!1;return!0}),t)(r=o.call(t,n))&&(i[n]=t[n]);return i},convertText:function(t){for(var e="",n=0;n<t.length;n++)e+=t[n].replace(/(\S)/gi,"<span>$1</span>").replace(/\n|\r/gi,"<span><br></span>").replace(/\s/gi,"<span>&nbsp;</span>");return e},rotateBase64Img:function(t,e,n){var r,i,o,a=document.createElement("canvas"),u=a.getContext("2d");if(e%90!=0)throw console.error("旋转角度必须是90的倍数!"),"旋转角度必须是90的倍数!";var s=e/90%4,c={sx:0,sy:0,ex:0,ey:0},l=new Image;l.crossOrigin="anonymous",l.src=t,l.onload=function(){switch(r=l.width,i=l.height,o=i<r?r:i,a.width=2*o,a.height=2*o,s){case 0:c.sx=o,c.sy=o,c.ex=o+r,c.ey=o+i;break;case 1:c.sx=o-i,c.sy=o,c.ex=o,c.ey=o+r;break;case 2:c.sx=o-r,c.sy=o-i,c.ex=o,c.ey=o;break;case 3:c.sx=o,c.sy=o-r,c.ex=o+i,c.ey=o+r}u.translate(o,o),u.rotate(e*Math.PI/180),u.drawImage(l,0,0);var t=u.getImageData(c.sx,c.sy,c.ex,c.ey);s%2==0?(a.width=r,a.height=i):(a.width=i,a.height=r),u.putImageData(t,0,0),n&&n(a.toDataURL())}},handleEdittable:function(i,t){var o=new Array,a=0,u=0;return $.each(i.find("span"),function(t,e){var n=$(e).text()||$(e).html(),r=new Object;"<br>"==n&&(a=0,u+=s?$(e).height()/2:$(e).height(),n="",s&&(u+=4)),0==u&&(u=$(e).height()),a>=i.width()-$(e).width()&&(a=0,u+=$(e).height()),r.txt=n,r.left=a,r.top=u,s&&(r.top+=3),o.push(r),""!=n&&(a+=$(e).width())}),o},val:function(t,e){var n;return y.is("Function",t)?(n=arguments.length<3?[]:[].slice.call(arguments).slice(2),t.apply(e,n)):t},$:function(t){var e,n=document.getElementById(t);return n||(e=document.getElementsByName(t))&&0<e.length&&(n=e[0]),n||(e=document.getElementsByTagName(t))&&0<e.length&&(n=e[0]),n},keys:function(t){if(!y.is("Object",t))return[];if(nativeKeys)return nativeKeys(t);var e,n=[];for(e in t)y.has(t,e)&&n.push(e);return r&&i(t,n),n},contains:function(t,e,n){return function(t){t=t&&t.length;return"number"==typeof t&&0<=t&&t<=MAX_ARRAY_INDEX}(t)||(t=_.values(t)),0<=_.indexOf(t,e,"number"==typeof n&&n)},values:function(t){for(var e=_.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r},has:function(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)},inherit:function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n,(t.prototype.constructor=t).uber=e.prototype},is:function(t,e){var n=Object.prototype.toString.call(e).slice(8,-1);return null!=e&&n===t},colorRgb:function(t){var e=t.toLowerCase();if(e&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){for(var n="#",r=1;r<4;r+=1)n+=e.slice(r,r+1).concat(e.slice(r,r+1));e=n}for(var i=[],r=1;r<7;r+=2)i.push(parseInt("0x"+e.slice(r,r+2)));return"RGB("+i.join(",")+")"}return e},colorHex:function(t){if(/^(rgb|RGB)/.test(t)){for(var e=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),n="#",r=0;r<e.length;r++){var i=Number(e[r]).toString(16);"0"===i&&(i+=i),n+=i}return(n=7!==n.length?t:n).toUpperCase()}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){var o=t.replace(/#/,"").split("");if(6===o.length)return t.toUpperCase();if(3===o.length){for(var a="#",r=0;r<o.length;r+=1)a+=o[r]+o[r];return a.toUpperCase()}}return t.toUpperCase()},dateConvert:function(t,i){var o=[["零","一","二","三","四","五","六","七","八","九"],["〇","一","二","三","四","五","六","七","八","九"]],a="十",e=t.match(/^(\d{2}|\d{4})(年)(\d{1,2})(月)(\d{1,2})(日)$/),n="";if(null!=e){for(var r=1;r<e.length;r+=2)n+=function(t){if(2==t.length)return"1"==t.charAt(0)?"0"==t.charAt(1)?a:a+o[i-1][t.charAt(1)]:"0"!=t.charAt(1)?o[i-1][t.charAt(0)]+a+o[i-1][t.charAt(1)]:o[i-1][t.charAt(0)]+a;for(var e=t,n="",r=0;r<e.length;r++)n+=o[i-1][e.charAt(r)];return n}(e[r])+e[r+1];return n}},formatDate:function(t,e){var n,r,i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],o={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),new RegExp("(MMM)").test(e)&&(e=e.replace(RegExp.$1,"$")),o)new RegExp("("+n+")").test(e)&&(r=o[n],2==RegExp.$1.length&&(r=("00"+o[n]).substr((""+o[n]).length)),e=e.replace(RegExp.$1,r));return e=e.replace("$",i),/[*]/gi.test(e)&&(t=e.replace(/[*]/gi,""),i=e.length-t.length,e=this.dateConvert(t,i)),e},getDate:function(t){return 10==t.toString().length&&(t*=1e3),new Date(t)},template:function(t,e){for(var n,r=/<%([^%>]+)?%>/g,i=/(^( )?(var|if|for|else|switch|case|break|{|}))(.*)?/g,o="var r=[];\n",a=0,u=function(t,e){return o+=e?t.match(i)?t+"\n":"r.push("+t+");\n":""!=t?'r.push("'+t.replace(/"/g,'\\"')+'");\n':"",u};n=r.exec(t);)u(t.slice(a,n.index))(n[1],!0),a=n.index+n[0].length;return u(t.substr(a,t.length-a)),o+='return r.join("");',new Function(o.replace(/[\r\t\n]/g,"")).apply(e,l(arguments,2))},first:function(t,e){return t.substring(0,1)[e?"toLowerCase":"toUpperCase"]()+t.substring(1)},html2Escape:function(t){return t.replace(/[<>&"]/g,function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]})},conversion_getDPI:function(){var t,e=new Array;return window.screen.deviceXDPI?(e[0]=window.screen.deviceXDPI,e[1]=window.screen.deviceYDPI):((t=document.createElement("DIV")).style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(t),e[0]=parseInt(t.offsetWidth),e[1]=parseInt(t.offsetHeight),t.parentNode.removeChild(t)),e},pxConversionMm:function(t){return 25.4*(t/this.conversion_getDPI()[0])},mmConversionPx:function(t){return t/25.4*this.conversion_getDPI()[0]},eosFormatTime:function(t){var e=t.split(" ")[0],t=t.split(" ")[1].split(":"),n=t.slice(1,t.length).join(":"),t=parseInt(t[0])+8,t=(t<24?t:t%24).toString();return e+" "+(t=t<10?"0"+t:t)+":"+n}},m={result:!(t.prototype={on:function(t,e){return this.__getEventListener(t).push(e),this},off:function(t,e){for(var n=this.__getEventListener(t),r=0;r<n.length;r++)e===n[r]&&n.splice(r--,1);return this},clear:function(t){return 0<this.__getEventListener(t).length&&(this.__listener[t]=[]),this},trigger:function(t){var e,n=this.__getEventListener(t),r=Array.prototype.slice.call(arguments);this["on"+t]&&(e=this["on"+t].apply(this,r.slice(1)));for(var i=0;i<n.length;i++)n[i].apply(this,r.slice(1));return e},__getEventListener:function(t){var e=this.__listener;return(e=e||(this.__listener={}))[t]||(e[t]=[]),e[t]}}),errcode:"serverErr"},k={result:!1,errcode:"interErr"},w={result:!1,errcode:"responseErr"},S={result:!1,errcode:"connectionErr"},C={result:!1,errcode:"parseErr"},x={result:!1,errcode:"timeoutErr"},b=function(t,e){this.url=t,this.data=e,P.trigger("beforeJSONP",t,e)},A=b.prototype,L=(A.parseData=function(){var t="",e=this.data;if(y.is("String",e))t=e;else if(y.is("Object",e))for(var n in e)e[n]&&(t+="&"+n+"="+encodeURIComponent(e[n]));else if(y.is("Array",e))for(var r=0;r<e.length;r++){var i=e[r];for(n in i)i[n]&&(t+="&"+n+"="+encodeURIComponent(i[n]))}return t=(t=(t+="&hookback="+this.name)+("&_="+f())).substr(1),P.trigger("parseData",t),t},A.getJSON=function(e){function t(){setTimeout(function(){clearTimeout(u),a.parentNode.removeChild(a);try{delete window[o]}catch(t){}},1)}var n=this,r=n.url,i=n.data,o=this.name="jsonp_"+f()+"_"+y.rand(1e5),r=r+(-1===r.indexOf("?")?"?":"&")+this.parseData(i),a=document.createElement("script"),u=(a.type="text/javascript",a.src=r,a.id=o,a.charset="utf-8",window[o]=function(t){n._execed=!0,g.call(n,e,t)},a.onload=function(){t(),n._execed||g.call(n,e,C)},a.onerror=function(){t(),void 0!==Signature.options.isResponseErr&&Signature.options.isResponseErr||g.call(n,e,w)},setTimeout(function(){t(),g.call(n,e,x)},D.options.timeout)),i=document.getElementsByTagName("head");i&&i[0]&&i[0].appendChild(a)},function(t,e){this.url=t,this.data=e,this.xdr=new XDomainRequest}),E=(L.prototype.getJSON=function(e){var n=this.xdr;n.onload=function(){var t;try{t=JSON.parse(n.responseText)}catch(t){return void g.call(n,e,C)}g.call(n,e,t)},n.onerror=function(){g.call(n,e,S)},n.timeout=D.options.timeout,n.ontimeout=function(){g.call(n,e,x)},n.open("POST",this.url),n.send(p(this.data,"\r\n"))},function(t,e){var n;if(window.XMLHttpRequest)n=new XMLHttpRequest;else if(window.ActiveXObject)for(var r=["MSXML2.XMLHTTP","Microsoft.XMLHTTP"],i=0;i<r.length;i++)try{n=new ActiveXObject(r[i]);break}catch(t){}this.xhr=n,this.url=t,this.data=e});E.prototype.getJSON=function(e){var n=this.xhr,r=!1,t=(n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status||304==n.status)try{var t=JSON.parse(n.responseText);g.call(n,e,t)}catch(t){return void g.call(n,e,C)}else r&&g.call(n,e,w)},n.open("POST",this.url,!0),n.onerror=function(){g.call(n,e,S)},n.timeout=D.options.timeout,n.ontimeout=function(){r=!0,g.call(n,e,x)},n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),p(this.data,"\r\n"));n.send(t)},XMLHttpRequest.prototype._send=function(t){Signature.setRequestHeader(this),this.send(t)},Function.prototype.before=function(t){var e=this;return function(){return t.apply(this,arguments),e.apply(this,arguments)}},XMLHttpRequest.prototype.send=XMLHttpRequest.prototype.send.before(function(){Signature.setRequestHeader(this)});var J=!("withCredentials"in XMLHttpRequest.prototype)&&"undefined"!=typeof XDomainRequest,M=function(t,e,n){return P.trigger.apply(P,["beforeAjax"].concat(l(arguments))),new(n?b:J?L:E)(t,e)},X={Boolean:"BOOL",String:"BSTR",Number:"LONG"};function O(t){for(var e,n,r=[],i=0;i<t.length;i++){var o={};o.type=(e=t[i],X[Object.prototype.toString.call(e).slice(8,-1)]),o.value=t[i],r.push(o)}return n=r,n=JSON.stringify(n),a?n.replace(/\\u([0-9a-fA-F]{2,4})/g,function(t,e){return String.fromCharCode(parseInt(e,16))}):n}function T(t,e,n,r){P.trigger("beforeMethod",arguments);var i=Array.prototype.slice.call(arguments).slice(4),o={value:0==i.length?'{"MethodCall":{"caller":"'+e+'","function":"'+r+'"},"usercode":"'+n+'"}':'{"MethodCall":{"caller":"'+e+'","function":"'+r+'",'+('"params":'+O(i))+'},"usercode":"'+n+'"}'};return function(e){M(t+"/MethodCall",o,!1).getJSON(function(t){P.trigger("responseMethod",t),"none"==t.type?e(null,m):e(null,t.value||t)})}}function K(t,e,n){P.trigger("beforeAttr",arguments);var r=Array.prototype.slice.call(arguments).slice(3),i={value:0==r.length?'{"PropertyCall":{"caller":"'+e+'","property":"'+n+'"}}':'{"MethodCall":{"caller":"'+e+'","property":"'+n+'",'+('"params":'+O(r))+"}}"};return function(e){M(t,i,!0).getJSON(function(t){P.trigger("responseMethod",t),"none"==t.type?e(null,m):e(null,t.value)})}}function j(t,e){this.url=t,this.data=e,P.trigger("beforeAjaxJ",t,e)}function R(t){this.serverUrl=t,this.thenjs=H(function(t){t(null)})}var D=function(){},I=(D.errCode={1e4:"系统错误",20001:"密钥盘信息错误",20003:"密码错误，请输入正确密码",20004:"请输入密码!",11100:"签章服务器错误",111e3:"当前用户没有签章",111001:"该用户没有公章",111002:"该用户没有私章",111003:"该用户没有法人章",111004:"该用户没有法人签名印章",111005:"该用户没有手写签名印章",11101:"当前用户没有签章",11102:"印章错误",11103:"证书过期",11104:"印章过期",11105:"获取签章信息失败!",11106:"获取证书信息失败!",11107:"未搜索到您要的签章!",11108:"未设置签章密码!",11109:"操作失败，签章助手未启用或未授权",11110:"操作失败，请拔掉当前钥匙盘再进行操作",11111:"允许移动失败，请使用原签章密钥允许移动！",11112:"允许移动失败，该签章数据没有允许移动请求权限！",11113:"您的浏览器不支持手写签名。",11114:"请插入当前签章所属密钥盘",11115:"当前用户没有操作该签章权限",none:"客户端未知异常!",signErr:"签名失败",serverErr:"调用产品组件异常",parseErr:"数据格式异常",responseErr:"产品组件响应异常",connectionErr:"产品组件连接异常",timeoutErr:"请求响应超时",interErr:"获取接口异常","-7":"签名组件错误","-8":"验证失败"},y.extend(D.errCode,{then:{"-1":"请安装客户端","-2":"请插入当前签章所属的密钥盘","-3":"未安装手机盾组件","-12":"获取证书失败","-13":"签名时，加载证书失败","-15":"签名数据不能为空","-16":"密码不能为空","-17":"解析证书失败","-18":"未安装手机盾组件","-19":"手机盾登录失败",1:"没有检测到密钥盘",2:"密钥盘没有正确初始化",3:"密钥盘驱动未安装",4:"只能插入一个密钥盘",7:"密码错误或密钥盘被锁定",8:"非法授权",9:"网络连接失败",10:"手机盾登录失败",11:"当前密钥盘没有印章",12:"获取印章信息失败",35:"钥匙盘未生效，不能签章！",36:"钥匙盘已过期，不能签章！",37:"授权信息结构非法！",38:"签章证书已经过期或还未生效！",39:"签章证书不受颁发机构信任！",40:"签章证书已被吊销！",41:"签章证书根证书未安装或无效的根证书！",42:"吊销列表文件不存在",43:"未检测到证书",44:"根证书文件不存在",45:"根证书和该证书的根证书不配套",46:"吊销列表和该证书的吊销列表不配套","-101":"获取密钥盘有效期异常","-103":"密钥盘未生效","-104":"期限许可已过期","-999":"金格组件未知错误","30001@gm":"验证电子印章失败：验证电子印章签名值失败！","30002@gm":"验证电子印章失败：验证电子印章制章人证书有效期失败！","30003@gm":"验证电子印章失败：验证电子印章的有效期失败！","30004@gm":"验证电子印章失败：验证签章人证书有效性失败！","30005@gm":"验证电子印章失败：验证电子签章数据失败！","-7@KGCrySignMessage":"签名组件错误","8@KGVerifySign":"验证失效","1@KGVerifySign":"未安装签名组件","2@KGCrySignMessage":"获取证书失败","3@KGCrySignMessage":"签名时，加载证书失败","5@KGCrySignMessage":"签名数据不能为空","6@KGCrySignMessage":"密码不能为空","7@KGCrySignMessage":"解析证书失败"},KGRunFingerPrints:{"-1":"设备类型设置错误","-2":"没有安装指纹组件","-3":"指纹采集失败"},KGRunHandWritten:{"-1":"设备类型设置错误","-2":"没有安装手写组件","-3":"授权码不正确","-4":"签名取消","-5":"无服务可用","-6":"签名设备错误","-7":"未知错误"},KGGetTSWithDigest:{1:"获取时间戳异常",2:"获取时间戳失败",3:"响应数据为空"},KGGetTSURLInfo:{1:"时间戳未启用"},KGValidate_GM:{"-1":"没有安装签名组件","-2":"没有公共模块组件","-3":"KCL280 验证失败，未知原因的验证失败",1:"KCL272_验证签章人证书失败，签章人证书已过期或未生效！",2:"KCL274 验证签章人证书失败，签章人证书根证书验证未通过!",3:" KCL270_验证签章人证书失败，签章人证书已被吊销！",4:" KCL276 验证签章人证书失败，签章人证书根证书安装未成功!",5:" KCL266_验证签章人证书失败，未检测到签章人证书吊销列表！",6:"KCL260_验证签章人证书失败，未检测到签章人证书！",7:"KCL262_验证签章人根证书失败，未检测到签章人根证书！",8:"KCL264_验证签章人根证书失败，签章人证书与该证书的根证书不匹配！",9:"KCL268_验证签章人证书失败，签章人证书与该证书吊销列表不匹配！",10:"KCL273_验证制章人证书失败，制章人证书已过期或未生效",11:"KCL275 验证制章人证书失败，制章人证书根证书验证未通过!",12:"KCL271_验证制章人证书失败，制章人证书已被吊销！",13:"KCL277_验证制章人证书失败，制章人证书根证书安装未成功!",14:"KCL267_验证制章人证书失败，未检测到制章人证书吊销列表！",15:"KCL281_验证制章人证书失败，未检测到制章人证书！",16:"KCL263_验证制章人根证书失败，未检测到制章人根证书！",17:"KCL265_验证制章人根证书失败，制章人证书与该证书的根证书不匹配！",18:"KCL269_验证制章人证书失败，制章人证书与该证书吊销列表不匹配！",19:"KCL261_验证签章人证书失败，签章人证书不在印章的签章人证书列表中！",20:"KCL278_验证印章制章时间失败，印章未生效！",21:"KCL279 验证印章制章时间失败，印章已经过期！"},KGValidateCertificate:{"-1":"没有安装签名组件","-2":"未知错误",1:"验证失败，签章证书已经过期或还未生效！",2:"验证失败，签章证书不受颁发机构信任！",3:"验证失败，签章证书已被吊销！",4:"验证失败，签章证书根证书未安装或无效的根证书！",5:"验证失败，吊销列表文件不存在！",6:"验证失败，未检测到证书！",7:"验证失败，根证书文件不存在！",8:"验证失败，根证书和该证书的根证书不配套！",9:"验证失败，吊销列表和该证书的吊销列表不配套！"},KG_MSG:{in_input_msg:"请输入密码！",in_verification_msg:"请输入验证码！",timestamp_time:"(时间来源于时间戳服务器)",server_time:"(时间来源于签章服务器)",local_time:"(时间来源于本地)",modify_signdata:"签名数据被篡改",normal_signdata:"签名数据验证正常",success_signdata:"数字签名成功！",invalid_signdata:"签章无效，不能执行数字签名！",cannot_move:"这个印章不是你当前插入的key的印章，不能移动！"},KG_TITLE:{SignatureMoveNot:"禁止移动",SignatureMoveDo:"允许移动",SignSignature:"数字签名",SignVerify:"签名验证",SignatureVerify:"签章验证",RevokeSignature:"撤销签章",KinggridSignature:"电子签章",DateSet:"日期设置",HWSignature:"手写签批",scanBCSignature:"扫码签章",moveSignature:"移动签章",ProtectedDataSet:"保护项设置"},KGVerifyGBSealAction:{"-1":"服务器通讯失败",1:"印章结构体为空",2:"印章状态无效",3:"解析异常",4:"印章已删除",5:"印章未制作",6:"印章已冻结"},KGfontColor:{"黑":"black","红":"red","蓝":"blue","绿":"green"}}),D.msg=function(t,e){return D.errCode[t]||(e?D.errCode[e]:D.errCode)[t]||t},D.options={_version:"1.0",timeout:2e4},D.Utils=y,D.Listener=t,j.prototype.getJSON=function(r){var i=this;$.ajax({url:this.url,contentType:"text/plain;charset=utf-8",type:"POST",data:p(this.data,"\r\n"),success:function(t){g.call(i,r,t)},error:function(t,e,n){g.call(i,r,S)}})},H.onerror=function(t){if(!y.is("String",t))throw t;alert("[error]"+t)},R.prototype),P=(I.init=function(t,e,n){this.serverUrl;return this.progid=t,this.interid=e,this.clientCode=n,this},I.fail=function(r){var i=this;return i.thenjs=i.thenjs.fail(function(t,e){var n=r.call(i,t,e);t(i.respData(null==n?e:n))}),i},I.fin=function(r){var i=this;return i.thenjs=i.thenjs.fin(function(t,e,n){r.call(i,t,e,n)}),i},I.then=function(e){var r=this;return r.thenjs=r.thenjs.then(function(n,t){e.call(r,function(t,e){r.respData(e),n(t,e)},t)}),r},I.series=function(t){return this.thenjs=this.thenjs.series(t),this},I.calArgs=function(t){for(var e=this._data,n=[],r=0;r<t.length;r++){var i=t[r];y.is("Function",i)&&(i=i.call(this,e)),y.is("Array",i)?n=n.concat(i):n.push(i)}return n},I.msg=function(t,e,n,r){e=e||this._method,n=n||this.progid,r||this.clientCode,r=D.errCode.then;return P.trigger("msgArg",t,e,n),D.errCode[t]||r[t+"@"+e+"."+n]||r[t+"@"+e]||r[t]||t},I.ret=function(r){var i=this;return this.then(function(t,e){var n=r.call(i,e);t(null,i.respData(null==n?e:n))}),this},I.respData=function(t){return t&&(this._data=t),this._data},I.attr=function(t){var n=this,r=l(arguments);return n.series([function(t){var e=n.calArgs(r);n._method=e[0],K.apply(null,[n.serverUrl,n.proid].concat(e))(t)}]).then(function(t,e){t(null,n.respData(e[0]))}),this},I.attrSeries=function(){var n=this,t=[];n.initProid();for(var e=0;e<arguments.length;e++)t.push(function(){var e=n.calArgs(arguments);return function(t){n._method=e[0],K.apply(null,[n.serverUrl,n.proid].concat(e))(t)}}.apply(null,arguments[e]));return n.series(t).then(function(t,e){n.respData(e),t(null,e)}),this},I.initProid=function(){var n=this;return this.series([function(t,e,n,r){P.trigger("beforeProg",arguments);var i={value:'{"GetInterface":{"progid":"'+e+'","interface":"'+n+'"},"usercode":"'+r+'"}'};return function(e){M(t+"/GetInterface",i,!1).getJSON(function(t){P.trigger("resonseProg",t),"none"==t.type?e(null,w):"0"===t.value?e(null,k):e(null,t)})}}(n.serverUrl,n.progid,n.interid,n.clientCode)]).then(function(t,e){e=e[0];P.trigger("initProid",e),e.value?(n.proid=e.value,t(null,e)):t(e.errcode)}),this},I.invokeSeries=function(){var n=this,t=[];n.initProid();for(var e=0;e<arguments.length;e++)t.push(function(){var e=n.calArgs(arguments);return function(t){n._method=e[0],T.apply(null,[n.serverUrl,n.proid,n.clientCode].concat(e))(t)}}.apply(null,arguments[e]));return n.series(t).then(function(t,e){n.respData(e),t(null,e)}),this},I.invoke=function(t){var n=this,r=(n.initProid(),l(arguments));return n.series([function(t){var e=n.calArgs(r);n._method=e[0],T.apply(null,[n.serverUrl,n.proid,n.clientCode].concat(e))(t)}]).then(function(t,e){n.respData(e[0]),t(null,e[0])}),this},I.request=function(t,e){var n=this;return n.series([function(t,n){return P.trigger("ajaxRequest",arguments),D.ajax?function(e){new j(t,n).getJSON(function(t){e(null,t)})}:function(e){M(t,n,!1).getJSON(function(t){e(null,t)})}}(n.serverUrl+t,e)]).then(function(t,e){e=e[0];n.respData(e),t(null,e)}),this},new t("kgthen"));return D.addRequestListener=function(t,e){P.on(t,e)},D.surry=function(t,e,n,r){return new R(t||"http://127.0.0.1:9581").init(e,n,r)},D.KgThen=R,D}:t}(window),window,"function"!=typeof define||!define.amd||"undefined"!=typeof nonUseAmd&&nonUseAmd||define([],function(){return{Thenjs:window.Thenjs,kinggrid:window.kinggrid}});
//V3.0.0.572