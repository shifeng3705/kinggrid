var CryptoJS=CryptoJS||function(c){var e={},t=e.lib={},n=t.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}};function i(){}var d=t.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,i=this.sigBytes,o=e.sigBytes;if(this.clamp(),i%4)for(var a=0;a<o;a++){var s=n[a>>>2]>>>24-a%4*8&255;t[i+a>>>2]|=s<<24-(i+a)%4*8}else if(65535<n.length)for(a=0;a<o;a+=4)t[i+a>>>2]=n[a>>>2];else t.push.apply(t,n);return this.sigBytes+=o,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=c.ceil(t/4)},clone:function(){var e=n.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(4294967296*c.random()|0);return new d.init(t,e)}}),o=e.enc={},a=o.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o++){var a=t[o>>>2]>>>24-o%4*8&255;i.push((a>>>4).toString(16)),i.push((15&a).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i+=2)n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new d.init(n,t/2)}},s=o.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],o=0;o<n;o++){var a=t[o>>>2]>>>24-o%4*8&255;i.push(String.fromCharCode(a))}return i.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>2]|=(255&e.charCodeAt(i))<<24-i%4*8;return new d.init(n,t)}},r=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},l=t.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=r.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,i=t.sigBytes,o=this.blockSize,a=i/(4*o),s=(a=e?c.ceil(a):c.max((0|a)-this._minBufferSize,0))*o,e=c.min(4*s,i);if(s){for(var r=0;r<s;r+=o)this._doProcessBlock(n,r);var l=n.splice(0,s);t.sigBytes-=e}return new d.init(l,e)},clone:function(){var e=n.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(t.Hasher=l.extend({cfg:n.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(e,t){return new n.init(t).finalize(e)}},_createHmacHelper:function(n){return function(e,t){return new g.HMAC.init(n,t).finalize(e)}}}),e.algo={});return e}(Math);!function(){var e=CryptoJS,t=e.lib,n=t.WordArray,i=t.Hasher,t=e.algo,d=[],t=t.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],a=n[2],s=n[3],r=n[4],l=0;l<80;l++){l<16?d[l]=0|e[t+l]:(c=d[l-3]^d[l-8]^d[l-14]^d[l-16],d[l]=c<<1|c>>>31);var c=(i<<5|i>>>27)+r+d[l];c+=l<20?1518500249+(o&a|~o&s):l<40?1859775393+(o^a^s):l<60?(o&a|o&s|a&s)-1894007588:(o^a^s)-899497514,r=s,s=a,a=o<<30|o>>>2,o=i,i=c}n[0]=n[0]+i|0,n[1]=n[1]+o|0,n[2]=n[2]+a|0,n[3]=n[3]+s|0,n[4]=n[4]+r|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(64+i>>>9<<4)]=Math.floor(n/4294967296),t[15+(64+i>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=i._createHelper(t),e.HmacSHA1=i._createHmacHelper(t)}(),function(l){for(var e=CryptoJS,t=e.lib,n=t.WordArray,i=t.Hasher,t=e.algo,_=[],o=0;o<64;o++)_[o]=4294967296*l.abs(l.sin(o+1))|0;t=t.MD5=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n,o=e[i];e[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var a=this._hash.words,s=e[t+0],r=e[t+1],l=e[t+2],c=e[t+3],d=e[t+4],g=e[t+5],u=e[t+6],f=e[t+7],p=e[t+8],h=e[t+9],m=e[t+10],v=e[t+11],k=e[t+12],y=e[t+13],S=e[t+14],C=e[t+15],w=T(a[0],I=a[1],D=a[2],b=a[3],s,7,_[0]),b=T(b,w,I,D,r,12,_[1]),D=T(D,b,w,I,l,17,_[2]),I=T(I,D,b,w,c,22,_[3]);w=T(w,I,D,b,d,7,_[4]),b=T(b,w,I,D,g,12,_[5]),D=T(D,b,w,I,u,17,_[6]),I=T(I,D,b,w,f,22,_[7]),w=T(w,I,D,b,p,7,_[8]),b=T(b,w,I,D,h,12,_[9]),D=T(D,b,w,I,m,17,_[10]),I=T(I,D,b,w,v,22,_[11]),w=T(w,I,D,b,k,7,_[12]),b=T(b,w,I,D,y,12,_[13]),D=T(D,b,w,I,S,17,_[14]),w=x(w,I=T(I,D,b,w,C,22,_[15]),D,b,r,5,_[16]),b=x(b,w,I,D,u,9,_[17]),D=x(D,b,w,I,v,14,_[18]),I=x(I,D,b,w,s,20,_[19]),w=x(w,I,D,b,g,5,_[20]),b=x(b,w,I,D,m,9,_[21]),D=x(D,b,w,I,C,14,_[22]),I=x(I,D,b,w,d,20,_[23]),w=x(w,I,D,b,h,5,_[24]),b=x(b,w,I,D,S,9,_[25]),D=x(D,b,w,I,c,14,_[26]),I=x(I,D,b,w,p,20,_[27]),w=x(w,I,D,b,y,5,_[28]),b=x(b,w,I,D,l,9,_[29]),D=x(D,b,w,I,f,14,_[30]),w=P(w,I=x(I,D,b,w,k,20,_[31]),D,b,g,4,_[32]),b=P(b,w,I,D,p,11,_[33]),D=P(D,b,w,I,v,16,_[34]),I=P(I,D,b,w,S,23,_[35]),w=P(w,I,D,b,r,4,_[36]),b=P(b,w,I,D,d,11,_[37]),D=P(D,b,w,I,f,16,_[38]),I=P(I,D,b,w,m,23,_[39]),w=P(w,I,D,b,y,4,_[40]),b=P(b,w,I,D,s,11,_[41]),D=P(D,b,w,I,c,16,_[42]),I=P(I,D,b,w,u,23,_[43]),w=P(w,I,D,b,h,4,_[44]),b=P(b,w,I,D,k,11,_[45]),D=P(D,b,w,I,C,16,_[46]),w=A(w,I=P(I,D,b,w,l,23,_[47]),D,b,s,6,_[48]),b=A(b,w,I,D,f,10,_[49]),D=A(D,b,w,I,S,15,_[50]),I=A(I,D,b,w,g,21,_[51]),w=A(w,I,D,b,k,6,_[52]),b=A(b,w,I,D,c,10,_[53]),D=A(D,b,w,I,m,15,_[54]),I=A(I,D,b,w,r,21,_[55]),w=A(w,I,D,b,p,6,_[56]),b=A(b,w,I,D,C,10,_[57]),D=A(D,b,w,I,u,15,_[58]),I=A(I,D,b,w,y,21,_[59]),w=A(w,I,D,b,d,6,_[60]),b=A(b,w,I,D,v,10,_[61]),D=A(D,b,w,I,l,15,_[62]),I=A(I,D,b,w,h,21,_[63]),a[0]=a[0]+w|0,a[1]=a[1]+I|0,a[2]=a[2]+D|0,a[3]=a[3]+b|0},_doFinalize:function(){for(var e=this._data,t=e.words,n=8*this._nDataBytes,i=8*e.sigBytes,o=(t[i>>>5]|=128<<24-i%32,l.floor(n/4294967296)),o=(t[15+(64+i>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t[14+(64+i>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),this._hash),a=o.words,s=0;s<4;s++){var r=a[s];a[s]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}return o},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function T(e,t,n,i,o,a,s){e=e+(t&n|~t&i)+o+s;return(e<<a|e>>>32-a)+t}function x(e,t,n,i,o,a,s){e=e+(t&i|n&~i)+o+s;return(e<<a|e>>>32-a)+t}function P(e,t,n,i,o,a,s){e=e+(t^n^i)+o+s;return(e<<a|e>>>32-a)+t}function A(e,t,n,i,o,a,s){e=e+(n^(t|~i))+o+s;return(e<<a|e>>>32-a)+t}e.MD5=i._createHelper(t),e.HmacMD5=i._createHmacHelper(t)}(Math),function(){var e=CryptoJS.lib.Base,r=CryptoJS.enc.Utf8;CryptoJS.algo.HMAC=e.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));for(var n=e.blockSize,i=4*n,e=((t=t.sigBytes>i?e.finalize(t):t).clamp(),this._oKey=t.clone()),t=this._iKey=t.clone(),o=e.words,a=t.words,s=0;s<n;s++)o[s]^=1549556828,a[s]^=909522486;e.sigBytes=t.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,e=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=CryptoJS,t=e.lib,n=t.Base,d=t.WordArray,t=e.algo,i=t.MD5,o=t.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:i,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,i=this.cfg,o=i.hasher.create(),a=d.create(),s=a.words,r=i.keySize,l=i.iterations;s.length<r;){n&&o.update(n),n=o.update(e).finalize(t),o.reset();for(var c=1;c<l;c++)n=o.finalize(n),o.reset();a.concat(n)}return a.sigBytes=4*r,a}});e.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)}}(),function(){var e=CryptoJS,t=e.lib,n=t.Base,s=t.WordArray,i=t.BufferedBlockAlgorithm,o=e.enc,a=(o.Utf8,o.Base64),r=e.algo.EvpKDF,l=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(i){return{encrypt:function(e,t,n){return c(t).encrypt(i,e,t,n)},decrypt:function(e,t,n){return c(t).decrypt(i,e,t,n)}}}});function c(e){return"string"==typeof e?p:f}t.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var o=e.mode={},d=t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),d=o.CBC=((o=d.extend()).Encryptor=o.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;g.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),o.Decryptor=o.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=e.slice(t,t+i);n.decryptBlock(e,t),g.call(this,e,t,i),this._prevBlock=o}}),o);function g(e,t,n){var i,o=this._iv;o?(i=o,this._iv=void 0):i=this._prevBlock;for(var a=0;a<n;a++)e[t+a]^=i[a]}var o=(e.pad={}).Pkcs7={pad:function(e,t){for(var t=4*t,n=t-e.sigBytes%t,i=n<<24|n<<16|n<<8|n,o=[],a=0;a<n;a+=4)o.push(i);t=s.create(o,n);e.concat(t)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},u=(t.BlockCipher=l.extend({cfg:l.cfg.extend({mode:d,padding:o}),reset:function(){l.reset.call(this);var e,t=this.cfg,n=t.iv,t=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=t.createEncryptor:(e=t.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(t,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),d=(e.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,e=e.salt,e=e?s.create([1398893684,1701076831]).concat(e).concat(t):t;return e.toString(a)},parse:function(e){var t,e=a.parse(e),n=e.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=s.create(n.slice(2,4)),n.splice(0,4),e.sigBytes-=16),u.create({ciphertext:e,salt:t})}},f=t.SerializableCipher=n.extend({cfg:n.extend({format:d}),encrypt:function(e,t,n,i){i=this.cfg.extend(i);var o=e.createEncryptor(n,i),t=o.finalize(t),o=o.cfg;return u.create({ciphertext:t,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:i.format})},decrypt:function(e,t,n,i){return i=this.cfg.extend(i),t=this._parse(t,i.format),e.createDecryptor(n,i).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),o=(e.kdf={}).OpenSSL={execute:function(e,t,n,i){i=i||s.random(8);e=r.create({keySize:t+n}).compute(e,i),n=s.create(e.words.slice(t),4*n);return e.sigBytes=4*t,u.create({key:e,iv:n,salt:i})}},p=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:o}),encrypt:function(e,t,n,i){n=(i=this.cfg.extend(i)).kdf.execute(n,e.keySize,e.ivSize),i.iv=n.iv,e=f.encrypt.call(this,e,t,n.key,i);return e.mixIn(n),e},decrypt:function(e,t,n,i){i=this.cfg.extend(i),t=this._parse(t,i.format);n=i.kdf.execute(n,e.keySize,e.ivSize,t.salt);return i.iv=n.iv,f.decrypt.call(this,e,t,n.key,i)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,c=[],i=[],o=[],a=[],s=[],r=[],d=[],g=[],u=[],f=[],l=[],p=0;p<256;p++)l[p]=p<128?p<<1:p<<1^283;for(var h=0,m=0,p=0;p<256;p++){var v=m^m<<1^m<<2^m<<3^m<<4,k=(c[h]=v=v>>>8^255&v^99,l[i[v]=h]),y=l[k],S=l[y],C=257*l[v]^16843008*v;o[h]=C<<24|C>>>8,a[h]=C<<16|C>>>16,s[h]=C<<8|C>>>24,r[h]=C,d[v]=(C=16843009*S^65537*y^257*k^16843008*h)<<24|C>>>8,g[v]=C<<16|C>>>16,u[v]=C<<8|C>>>24,f[v]=C,h?(h=k^l[l[l[S^k]]],m^=l[l[m]]):h=m=1}var w=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,i=4*(1+(this._nRounds=6+n)),o=this._keySchedule=[],a=0;a<i;a++)a<n?o[a]=t[a]:(l=o[a-1],a%n?6<n&&a%n==4&&(l=c[l>>>24]<<24|c[l>>>16&255]<<16|c[l>>>8&255]<<8|c[255&l]):(l=c[(l=l<<8|l>>>24)>>>24]<<24|c[l>>>16&255]<<16|c[l>>>8&255]<<8|c[255&l],l^=w[a/n|0]<<24),o[a]=o[a-n]^l);for(var s=this._invKeySchedule=[],r=0;r<i;r++){var l,a=i-r;l=r%4?o[a]:o[a-4],s[r]=r<4||a<=4?l:d[c[l>>>24]]^g[c[l>>>16&255]]^u[c[l>>>8&255]]^f[c[255&l]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,a,s,r,c)},decryptBlock:function(e,t){var n=e[t+1],n=(e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,d,g,u,f,i),e[t+1]);e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,i,o,a,s,r){for(var l=this._nRounds,c=e[t]^n[0],d=e[t+1]^n[1],g=e[t+2]^n[2],u=e[t+3]^n[3],f=4,p=1;p<l;p++)var h=i[c>>>24]^o[d>>>16&255]^a[g>>>8&255]^s[255&u]^n[f++],m=i[d>>>24]^o[g>>>16&255]^a[u>>>8&255]^s[255&c]^n[f++],v=i[g>>>24]^o[u>>>16&255]^a[c>>>8&255]^s[255&d]^n[f++],k=i[u>>>24]^o[c>>>16&255]^a[d>>>8&255]^s[255&g]^n[f++],c=h,d=m,g=v,u=k;h=(r[c>>>24]<<24|r[d>>>16&255]<<16|r[g>>>8&255]<<8|r[255&u])^n[f++],m=(r[d>>>24]<<24|r[g>>>16&255]<<16|r[u>>>8&255]<<8|r[255&c])^n[f++],v=(r[g>>>24]<<24|r[u>>>16&255]<<16|r[c>>>8&255]<<8|r[255&d])^n[f++],k=(r[u>>>24]<<24|r[c>>>16&255]<<16|r[d>>>8&255]<<8|r[255&g])^n[f++];e[t]=h,e[t+1]=m,e[t+2]=v,e[t+3]=k},keySize:8});e.AES=t._createHelper(n)}(),function(e){"function"!=typeof define||!define.amd||"undefined"!=typeof nonUseAmd&&nonUseAmd?e():"undefined"!=typeof HTMLDev&&HTMLDev?define(["./core/kinggrid.plus"],e):define(["./core/kinggrid.plus.min"],e)}((window,function(e){var u=window,y=u.kinggrid,R=window.jQuery,t=window.kingPlus,a=!1,s=(u.JSON&&(a='{"x":"中"}'!==u.JSON.stringify({x:"中"})),!0);try{u.document.createElement("canvas").getContext("2d")}catch(e){s=!1}function d(e){e=JSON.stringify(e);return a?e.replace(/\\u([0-9a-fA-F]{2,4})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}):e}function n(e){return e=f?(e.originalEvent||e).touches.item(0):e}function A(e){this.start=R.proxy(this.start,this),this.over=R.proxy(this.over,this),this.end=R.proxy(this.end,this),this.onstart=this.onover=this.onend=R.noop,B||(f="mousedown"!=e.type,B={start:f?"touchstart":"mousedown",over:f?"touchmove":"mousemove",end:f?"touchend":"mouseup"})}function i(){}function o(){}function r(){}function l(){}function W(e,t){var n,i=this;for(n in i.signatureid=e,i.setSignatureData(t),i.on("load",function(){W.list[e]=this}),i.on("remove",function(e){i.signatureData;e=i._getLogInfo(z.extend(e||{},{LOGTYPE:"00",LOGSORT:"14",LOGMEMO:"撤销签章成功"}));i.sealService.saveLog(e),delete W.list[i.signatureid]}),i.on("update",function(e){"signMeta"===i._item&&(i.signatureData,e=i._getLogInfo(z.extend(e||{},{LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"数字签名成功"})),i.sealService.saveLog(e))}),i.on("fireremove",function(){W.removeList.push(i.signatureid)}),i.on("fireupdate",function(){for(var e=!1,t=0;t<W.updateList.length;t++)if(W.updateList[t]===i){e=!0;break}e||W.updateList.push(i)}),W)W.hasOwnProperty(n)&&0==n.indexOf("on")&&(this[n]=W[n]);return this}function g(e,t,n){var i,o,a;return s?((i=u.document.createElement("canvas")).height=n,i.width=t,o=i.getContext("2d"),(a=new Image).src=e,a.onload=function(){o.drawImage(a,0,0,t,n)}):((i=u.document.createElement("img")).style.width=t+"px",i.style.height=n+"px",i.setAttribute("src",e)),i}function c(){}var f,B,S,z=y.Utils,E=R(window),F=R(document),p=document.documentElement,h=!!("minWidth"in p.style)&&"onlosecapture"in p,m="setCapture"in p,p=(A.prototype={start:function(e){return e=this.startFix(e),_.trigger("dragStart",this,e),F.on(B.over,this.over).on(B.end,this.end),this.onstart(e),!1},over:function(e){return e=this.overFix(e),_.trigger("dragOver",this,e),this.onover(e),!1},end:function(e){return e=this.endFix(e),_.trigger("dragEnd",this,e),F.off(B.over,this.over).off(B.end,this.end),this.onend(e),!1},startFix:function(e){return e=n(e),this.target=R(e.target),this.selectstart=function(){return!1},F.on("selectstart",this.selectstart).on("dblclick",this.end),h?this.target.on("losecapture",this.end):E.on("blur",this.end),m&&this.target[0].setCapture(),e},overFix:function(e){return e=n(e)},endFix:function(e){return e=n(e),F.off("selectstart",this.selectstart).off("dblclick",this.end),h?this.target.off("losecapture",this.end):E.off("blur",this.end),m&&this.target[0].releaseCapture(),e}},A.create=function(s,e,r,t){function n(){}var l,c,d,g,u=R(s),i=new A(e),o=B.start,f=s.className.replace(/^\s|\s.*/g,"")+"-drag-start",a=u[0].style,p=F.scrollLeft(),h=F.scrollTop(),m=0==t.left?0:t.left+u.width()-p,v=t.right-p,k=t.top-h,y=0==t.bottom?0:t.bottom-u.height()-h,S=0,C=0,w=parseInt(a.left),b=parseInt(a.top),D=w,I=b,_=w,T=b,x=(r&&(D=parseInt(a.marginLeft),I=parseInt(a.marginTop),_=D,T=I),{onstart:n,onover:n,onend:n,off:function(){u.off(o,i.start)}}),P=function(){var e,t=1,n=u.parents(".kg-translate");return null!=n&&null!=(n=n.css("transform"))&&(e=(n=n.split("(")[1].split(")")[0].split(","))[0],n=n[3],t=Math.max(Math.sqrt(e*e),Math.sqrt(n*n))),t};return i.onstart=function(e){var t="fixed"===u.css("position"),n=F.scrollLeft(),i=F.scrollTop(),o=u.width(),a=u.height(),o=(o*=P(),a*=P(),c=l=0,d=t?E.width()-o+l:F.width()-o,g=t?E.height()-a+c:F.height()-a,u.offset()),a=this.startLeft=t?o.left-n:o.left,t=this.startTop=t?o.top-i:o.top,o=(this.clientX=e.clientX,this.clientY=e.clientY,u.parent()),o=(o.is("body")||(S=o[0].getBoundingClientRect().left+n,C=o[0].getBoundingClientRect().top+i),e.clientX-u.offset().left+n-u.width()),n=e.clientY-u.offset().top+i;0!=m&&(m+=o),0!=v&&(v+=o),0!=k&&(k+=n),0!=y&&(y+=n),u.addClass(f),x.onstart.call(s,e,a,t)},i.onover=function(e){var t=e.clientX,n=e.clientY,t=(0!=m&&e.clientX<=m&&(t=m),0!=v&&e.clientX>=v&&(t=v),0!=k&&e.clientY<=k&&(n=k),0!=y&&e.clientY>=y&&(n=y),t-this.clientX+this.startLeft),n=n-this.clientY+this.startTop,i=u[0].style,t=Math.max(l,Math.min(d,t)),n=Math.max(c,Math.min(g,n)),o=0,a=0,a=r?(o=i.marginLeft=(t-S-w)/P()+"px",i.marginTop=(n-C-b)/P()+"px"):(o=i.left=(t-S)/P()+"px",i.top=(n-C)/P()+"px");_=parseInt(o),T=parseInt(a),x.onover.call(s,e,o,a)},i.onend=function(e){var t=u.position(),n=t.left,t=t.top,i=(u.removeClass(f),u[0].style),o=!0;Math.abs(_-D)<6&&Math.abs(T-I)<6&&(o=!1),r?x.onend.call(s,e,o,i.marginLeft,i.marginTop):x.onend.call(s,e,o,n,t)},i.off=function(){u.off(o,i.start)},e?i.start(e):u.on(o,i.start),x},y.Listener),v=(R.extend(i.prototype,p.prototype),o.className=o.name||"SealService",z.inherit(o,i),R.extend(o.prototype,{loadSeal:function(){throw new Error("must impl")},saveLog:function(){},verifyPwd:function(){throw new Error("must impl")}}),r.className=r.name||"CertService",z.inherit(r,i),R.extend(r.prototype,{sign:function(){throw new Error("must impl")},verifySign:function(){throw new Error("must impl")}}),R.extend(l.prototype,{getAttr:function(e){return this[e]},setAttr:function(e){var n=this;R.each(e,function(e,t){"function"==typeof n[e]?n[e](t):n[e]=t})},removeAttr:function(e){delete this[e]}}),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII="),C=(z.inherit(W,l),R.extend(W.prototype,p.prototype),R.extend(W.prototype,{hashAlg:"sha1",encryptAlg:"RSA",_init:function(){},_getLogInfo:function(e,t){var n=decodeURIComponent(window.location.href),t=this.signatureData||t;return z.extend(e||{},{KEYSN:t.gbOvalue&&""!=t.gbOvalue?t.gbOvalue:t.keysn,SIGNSN:t.seal.signsn,DOCUMENTID:t.documentid,DOCUMENTNAME:t.documentname,APPVERSION:x.name,APPTYPE:"HTML",APPCODE:this.appcode,EXTPARAM2:n})},error:function(e,t,n,i){var o=e,t=(o=(o=z.is("Object",e)?e.errcode&&"511"!=e.errcode?e.errcode:e.errmsg:o)||"-999",z.is("String",arguments[1])?t:"then");C.hideLoading(),W.options.errorCall?W.options.errorCall.call(null,e,t):(o=e.errmsg||y.msg(o,t),C.alert(o,function(){i&&i._beginDlgOkCall&&1==i._beginDlgOkCall||W.options.beginDlgOkCall&&W.options.beginDlgOkCall.call()},function(){W.options.beginDlgShowCall&&W.options.beginDlgShowCall.call()}))},load:function(e){var t=this,n=(this.trigger("beforeLoad"),this.setAttr(e),this.certService=new W.factory.cert[W.options.certType](e,this.signatureData),this.signatureData);if(void 0!==e.extra&&null!==e.extra&&void 0!==e.extra[t.signatureid]){if(void 0!==e.extra[t.signatureid].scaleImage&&null!==e.extra[t.signatureid].scaleImage&&(n.seal.height=n.seal.height*e.extra[t.signatureid].scaleImage,n.seal.width=n.seal.width*e.extra[t.signatureid].scaleImage),null!=e.extra[t.signatureid].position){var i,o=R.extend({},n.position),a="";for(i in o)a=i;this.removeItem(n.position),this.updatePos(e.extra[t.signatureid].position,{marginLeft:null==e.extra[t.signatureid].offsetX?o[a].marginLeft:e.extra[t.signatureid].offsetX,marginTop:null==e.extra[t.signatureid].offsetY?o[a].marginTop:e.extra[t.signatureid].offsetY})}}else void 0!==e.scaleImage&&null!==e.scaleImage&&(n.seal.height=n.seal.height*e.scaleImage,n.seal.width=n.seal.width*e.scaleImage);return this.sealService=new W.factory.seal[W.options.sealType](e,n),this._init(),this.trigger("load"),this},toBase64Img:function(e){var t=e.imgdata,n=t.indexOf(e.signsn);return-1==n?t:(t=e.imgdata.substring(n+65),z.Base64.of().encodeByte(z.Base64.of(e.signsn).decodeByte(t)))},clearImg:function(){var e=this;if(e.imgEles)for(var t in e.imgEles)this.trigger("removeAt",e.imgEles[t][0]),e.imgEles[t].remove();e.imgEles={}},repaint:function(){this.clearImg(),this.verify()},getUpdateType:function(){return this._item},updatePos:function(e,t){var n=this.signatureData.position[e];this._item="position",this.signatureData.position[e]=z.extend({},n,t)},updateItem:function(e,t){this._item=e,this.signatureData[e]=t},removeItem:function(e){for(var t in e)delete e[t]},fireUpdate:function(t){function e(e){t&&t(e),n[e?"update":"restore"](),delete n._item}var n=this;return W.asyn.update?W.asyn.update.call(n,e):(this.trigger("fireupdate"),e(!0)),this},restore:function(){this.setSignatureData(this.oriSignatureData),this.repaint()},update:function(){return this.setSignatureData(this.signatureData),this.repaint(),this.trigger("update"),this},remove:function(){for(var e in this.clearImg(),this.trigger("remove"),this)delete this[e];return this},fireRemove:function(t){function e(e){t&&t(e),e&&n.remove()}var n=this;return W.asyn.remove?W.asyn.remove.call(n,e):(this.trigger("fireremove"),e(!0)),this},hide:function(){if(this.imgEles)for(var e in this.imgEles)this.imgEles[e].hide()},createImg:function(){var e=this.signatureData,t=R(document.createElement("img")),n=0<e.appname.indexOf("H2TH5")?(e.seal.imgext=".png",e.seal.imgdata):this.toBase64Img(e.seal),i=v;return this.broken||(i="data:image/"+e.seal.imgext+";base64,"+n),t.css({width:Math.ceil(9600*parseFloat(e.seal.width)/254),height:Math.ceil(9600*parseFloat(e.seal.height)/254)}).attr({src:i}),t},show:function(){var e,t=this.signatureData.position,n=this.imgEles=this.imgEles||{};for(e in t){var i="kg-img-div-"+this.signatureid+"-"+e,o=(o=n[i])||(n[i]=this.showAt(e,t[e]));this._handleImg(o)}this.trigger("show")},showAt:function(e,t){this.trigger("beforeShowAt",e,t);var n=this,i=z.$(e),o=n.signatureData.appname,a=n.signatureData.position,a=(-1!=o.indexOf("H2TH5")&&a.H2TH5&&(-1===a.H2TH5.marginTop.indexOf("px")&&(a.H2TH5.marginTop+="px",a.H2TH5.marginLeft+="px"),null===i&&(o=R("<div style='position:absolute;left:0;top:0;'></div>"),i=R("<div id='H2TH5'></div>"),o.append(i),R("body").append(o))),R(i));if(0==(a=n.extra&&n.extra[this.signatureid]&&(o=n.extra[this.signatureid].scopePosition)?(o instanceof Object?o:R(z.$(o))).find("#"+e):a).length){if(!W.options.defaultPos)throw new Error("no find position:"+e+" signatureid="+this.signatureid);e=W.options.defaultPos,a=R(z.$(e))}var s,r,i="kg-img",o=n.createImg(),l=(o.addClass(i).attr("id",i+"-"+n.signatureid),R(document.createElement("div")).addClass(i+"-div").addClass(i+"-div-"+e).attr({id:i+"-div-"+this.signatureid+"-"+e,elemid:e,signatureid:this.signatureid})),c=R(document.createElement("div")).css({position:"absolute"}),d=(c.append(o),l.append(c),l.css({width:o.width(),height:o.height()}),0),g=0,u=n.signatureData.dateTime,f=n.signatureData.postilFontSet,u=(null!=u&&u.isCheck&&u.fontDate&&(p=this.addDateToImg(u.fontDate,n.signatureData.timestamp.time,l,c),null!=this.imageAndDate&&this.imageAndDate&&"outside"==u.fontDate.fontPosition[2]&&("right"==u.fontDate.fontPosition[3]?d+=p.dateWidth:"left"==u.fontDate.fontPosition[3]&&(f||(d+=p.dateWidth),c.css({right:0})),"below"==u.fontDate.fontPosition[4]&&(g+=p.dateHeight))),o.width()+d),p=(null!=f&&null!=f.fontValue&&""!=f.fontValue.trim()&&(u+=r=this.calWidth(f.fontValue,f),p=this.calHeight(f.fontSize),c.css({left:r}),g+=p,this.addPostilFontToImg(f,l)),o.height()+g),f=(null!=n.thirdConfig&&null!=n.thirdConfig.imgWh?(l.css({width:parseInt(n.thirdConfig.imgWh.width)>u?n.thirdConfig.imgWh.width:u,height:parseInt(n.thirdConfig.imgWh.height)>p?n.thirdConfig.imgWh.height:p}),c.css({left:W.isIE?"auto":"unset",right:d})):l.css({width:u,height:p}),l),o="kg-default",g=a.attr("display");return g?(a.addClass("display-"+g),o="kg-"+g,s=a,(n=document.getElementById(i+"-container-"+e))||(n=document.createElement("div")).setAttribute("id",i+"-container-"+e),(f=R(n).addClass(o+"-container")).append(l),l.attr("kg-display",!0)):"html"!=(s=a.offsetParent())[0].tagName.toLowerCase()&&"relative"!=s[0].style.position||(s=R("body")),l.addClass(o),s.append(f),g?"landscape"===g&&(c=f.children(),d=f.parent().width(),r=0,c.each(function(){r+=parseInt(R(this).width())+1}),f.width(d<r?r:d)):this.calSealPos(a,l,f,t),this.trigger("showAt",l[0],e,t),l},calSealPos:function(e,t,n,i){var o,a=e.offsetParent(),n=n||t,e=("html"!=a[0].tagName.toLowerCase()&&"relative"!=a[0].style.position||(a=R("body")),e.offset()),s=a.offset();a.is("body")&&(s={top:0,left:0}),n.css({top:e.top-s.top,left:e.left-s.left}),a=i?(o=i.marginLeft,i.marginTop):(o=t.css("marginLeft"),t.css("marginTop")),t.css({marginLeft:o||0,marginTop:a||0})},addPostilFontToImg:function(e,t){var n=R(document.createElement("div")),i=(n.addClass("kg-font-positl-div"),R(document.createElement("span")));return i.css({color:e.fontColor,"font-family":e.fontFamily,"font-size":e.fontSize+"px"}).addClass("kg-font-positl-span"),i.html(e.fontValue),n.append(i),t.prepend(n),n},calWidth:function(e,t){var n=document.createElement("canvas").getContext("2d");return n.font=t.fontSize+"px arial,"+t.fontFamily,n.measureText(e).width+6},calHeight:function(e){return 1.5*parseInt(e)},getLength:function(e){return e.replace(/[\u0391-\uFFE5]/g,"aa").length},addDateToImg:function(e,t,n,i){var t=new Date(t),t=y.Utils.formatDate(t,e.fontFormat),o=R(document.createElement("div")).addClass("kg-date"),a=0,s=0;if(!e.fontPosition)for(var r=C.fontTemplate.position.length,l=0;l<r;l++)if(C.fontTemplate.position[l]==this.signdate.position){e.fontPosition=C.fontTemplate.fontPosition[l];break}"outside"==e.fontPosition[2]&&("right"==e.fontPosition[3]?a+=n.width():"left"==e.fontPosition[3]&&(a-=n.width()),"below"==e.fontPosition[4]&&(s+=n.height())),o.css({width:n.width(),height:n.height(),top:s,left:a});s=R(document.createElement("div")).addClass("kg-date-tmb").css({width:n.width()}),a=R(document.createElement("div")).addClass("kg-date-lcr").css({"text-align":e.fontPosition[0],"font-family":e.fontFamily,"font-size":e.fontSize+"px",color:e.fontColor});return"bottom"==e.fontPosition[1]?s.css({bottom:0}):"middle"==e.fontPosition[1]&&a.css({"line-height":n.height()+"px"}),a.html(t),s.html(a),o.html(s),i.append(o),{dateWidth:this.calWidth(t,e),dateHeight:this.calHeight(e.fontSize)}},canSign:function(){return!this.modified&&!W.options.readonly&&W.options.signable&&!this.signatureData.signMeta},canMove:function(e){e=!W.options.readonly&&this.signatureData.moveable&&W.options.moveable&&!Boolean(R(e).attr("kg-display"));return e=e&&W.options.moveable_self?this.signatureData.keysn==W.options.keysn:e},canDelete:function(){return!W.options.readonly},_handleImg:function(e){var t;e.show(),0==e.children(".kg-shade").length&&((t=R(document.createElement("div")).addClass("kg-shade")).append(g(v,e.width(),e.height())),e.append(t)),this._invalid(e),this.trigger("handleImg",e[0])},setSignatureData:function(e){z.is("String",e)?this.signatureData=JSON.parse(z.Base64.of().decode(e)):this.signatureData=e,this.oriSignatureData=JSON.parse(JSON.stringify(this.signatureData))},getSignatureid:function(){return this.signatureid},getSignatureData:function(){var e=JSON.stringify(this.signatureData);return z.Base64.of().encode(e)},getBase64Image:function(t,n,e,i){var o="kg-img-div-",e=(o=(o+=t)+"-"+e,document.getElementById(o));null!=e&&(a?i(this,"",t,n):html2canvas(e).then(function(e){e=e.toDataURL("image/png").split(",");i(this,e,t,n)}))},_invalid:function(e){var t=e.children(".kg-invalid");if(0==t.length){t=R(document.createElement("div")).addClass("kg-hide").addClass("kg-invalid"),e.append(t);for(var n=e.height()/3,i=(t.css({top:n,height:n}),n/3),o=e.width(),a=0;a<3;a++){var s=R(document.createElement("div")).height(i);a%2==0&&(s.addClass("kg-invalid-item"),s.append(g("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVR42mNoaGgAAAMEAYF1LgG8AAAAAElFTkSuQmCC",o,i))),t.append(s)}}if(this.modified){for(var r="",l=0;l<this.modifiedItems.length;l++){var c=this.modifiedItems[l];r+=c.desc+"["+c.field+"]由{"+c.orivalue+"}更改为{"+c.newvalue+"};"}e.attr("modified",r).addClass("error"),t.removeClass("kg-hide")}else e.removeAttr("modified").removeClass("error"),t.addClass("kg-hide")},_verify:function(e,t){this.trigger("before_verify");this.modified;e=this.verifyProtectedData(e);if(!t||t.batchVerify||null==this.oriSignatureData.timestamp.timestampInfo)return this.show(),this.trigger("_verify"),!e;this.modified;var n=this;this.getVerifyTimeStamp(this.oriSignatureData.timestamp.timestampInfo,function(e){n.timeVerify=e,n.show(),n.trigger("_verify"),t&&t.sucCall&&t.sucCall.call(n)})},verify:function(e,t){this.trigger("beforeVerify");e=this._verify(e,t);return this.trigger("verify"),e},getVerifyProtectedItems:function(e,t){for(var n in e)if(null!=e[n]&&null!=e[n]){n=e[n];if(n.field==t)return n}return null},getVerifyProtectedData:function(){for(var e,t,n,i,o=this.validatedData,a=this.signatureData.protectedData,s={},r=0;r<a.length;r++)null!=a[r]&&null!=a[r]&&(t=(e=a[r]).field,null==(n=o&&(o[t]||this.getVerifyProtectedItems(o,t)&&this.getVerifyProtectedItems(o,t).value))&&((i=z.$(t))?null==(n=i.getAttribute("kg-value")||i.value)&&(n=i.innerHTML||i.innerText):n=null!=e.name&&null!=e.name?document.getElementById(e.name).value:""),i=z.val(n,this),i=this._formatValue(i),s[t]=i);return s},getSignTimeStamp:function(e){for(var t={},n=0;n<e.length;n++)t[e[n].field]=e[n].value;return z.Base64.of().encode(d(t))},getValidatedTimeStamp:function(){var e=d(this.getVerifyProtectedData());return z.Base64.of().encode(e)},getVerifyTimeStamp:function(e,t){var n,i,o=this.getValidatedTimeStamp(),a=e.CertData;"client"==W.options.sealType?(n=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode)).invoke("SetParamByName","TSCERTDATA",z.Base64.of().encode(a)).ret(function(){n.invoke("KGVerifyTSWithReq",e.TimeStampResponse,e.TimeStampResult,"",o,e.TimeStr,"").ret(function(e){t.call(this,e.result)})}):(i=W.options.serverUrl+"_key_verifyTimeStamp",R.ajax({url:i,type:"POST",data:{verifyed:o,cert:a,tsResp:e.TimeStampResponse},async:!1,success:function(e){t.call(this,e.result)},error:function(e){t.call(this,!1)}}))},getH5SignData:function(){return[{hashAlg:this.hashAlg,encryptAlg:this.encryptAlg,signdata:CryptoJS.SHA1(this.getSignData()).toString()}]},verifyProtectedData:function(e){e&&(this.validatedData=e);for(var t,n,e={},i=(R.extend(!0,e,this.signatureData.protectedData),W.verifyData&&(this.validatedData=W.verifyData(e)),[]),o=this.getVerifyProtectedData(),a=this.signatureData.protectedData,s=0;s<a.length;s++)null!=a[s]&&null!=a[s]&&(n=a[s],(t=o[a[s].field])!==n.value&&(n={field:n.field,desc:n.desc,orivalue:n.value,newvalue:t},i.push(n)));return this.modified=0<i.length,this.modifiedItems=i,this.modified},verifySignData:function(n){var i=this,e=(C.showLoading(),this.certService);if(this.signatureData.signMeta.html2sign){e instanceof T||((e=new T(W.options)).sData=i.signatureData);for(var t=i.getVerifyProtectedData(),o=this.signatureData.protectedData,a=[],s=0;s<o.length;s++){var r,l=o[s],c={};for(r in l)l.hasOwnProperty(r)&&(c[r]=l[r]);c.value=t[l.field],a.push(c)}t=d(a)}else t=this.getValidatedSignData();e.verifySign(R.extend({seal:this.signatureData.seal,signeddata:this.signatureData.signMeta.signeddata,crtdata:this.signatureData.signMeta.certinfo.crtdata,keysn:this.signatureData.keysn,signsn:this.signatureData.seal.signsn,signdata:t},{successCall:function(e){var t;C.hideLoading(),e.errcode||(t=!e.result,i.signModified=t,t=i.verify(null,{sucCall:function(){n&&n(e)}})),null==t&&e.result||n&&n(e)}}))},_renderValue:function(e){return e.replace(/\r\n/gi,"<br>")},_formatValue:function(e,t){return e&&e.replace(/\r\n/gi,"\n").replace(/\n/gi,"\r\n")},getItemVal:function(e){var t,n=z.is("String",e)?z.$(e):e;if(n)return"input"===(t=n.tagName.toLowerCase())||"textarea"===t||"select"===t?n.getAttribute("kg-value")||n.value:n.getAttribute("kg-value")||(a?n.innerText:n.textContent);throw new Error("No find protectedItem:"+e+" signatureid="+this.signatureid)},getProtectedData:function(e){function t(e){var t;if(z.is("String",e))t=o(e);else{if(!z.is("Object",e)||!e.field)throw new Error("Unsupported protectedItems:"+e.toString);t=e}return z.is("Function",t.value)&&(t.value=t.value.call(i,t.field,t.desc)),t.value=i._formatValue(t.value),t}var i=this,n=[],o=function(e){var t,n=z.$(e);if(n)return(t={field:e}).desc=n.getAttribute("kg-desc")||e,t.value=i.getItemVal(n),t;throw new Error("No find protectedItem:"+e+" signatureid="+this.signatureid)};if(e)if(z.is("Array",e))for(var a=0,s=e.length;a<s;a++)n.push(t(e[a]));else n.push(t(e));return n},__findSignedData:function(e){if(z.is("String",e))return e.split(";")[0];if(z.is("Array",e))return e[0];throw new Error("error signeddata: "+e)},getValidatedSignData:function(){var e=d(this.getVerifyProtectedData()),e=z.Base64.of().encode(e);return CryptoJS.SHA1(e).toString()},getSignData:function(e){for(var t=(e||this.signatureData).protectedData,n={},i=0;i<t.length;i++)n[t[i].field]=t[i].value;return z.Base64.of().encode(d(n))},showSignSignatureDialog:function(l){var c=this,d=W.options.verification,e={target:z.is("Array",l.target)?l.target:[l.target],title:y.msg("SignSignature","KG_TITLE"),onCancel:function(){R("#kg-password").blur(),W.options.dlgCancelCall&&W.options.dlgCancelCall.call()},onShow:function(){var t,n,o,a,s,e,i,r=this;W.editThemeColor(),W.repairInputEvent(R("#kg-password")),d?(n=(t=c).signatureData.keysn,o="",a=r.find(".kg-tipText"),c.sealService.getTelphone({keysn:n,successCall:function(e){e.result?(a.html(e.phone),o=e.phone):c.errorCallback(e.massage,l.errorCall)}}),(a=r.find(".kg-tipText")).html(o),a.click(function(){a.hide(),r.find("#kg-revokeVerifyCode").focus()}),r.find("#kg-revokeVerifyCode").click(function(){a.hide(),r.find("#kg-revokeVerifyCode").focus()}),s=r.find(".kg-revokeMark"),r.find(".kg-revokeBtn").click(function(e){C.showLoading();var i=R(this);t.sealService.applySMSCode({keysn:n,successCall:function(e){var t,n;e.result?(clearInterval(n),C.hideLoading(),a.css({display:"block"}).html(R.kgi18n.prop("sentSMSCode")),s.css({display:"block"}),t=60,n=setInterval(function(){0<=t?(t<10&&(t="0"+t),i.html(t+"秒"),t--):(i.html("验证码"),s.css({display:"none"}),a.html(o),clearInterval(n))},1e3)):c.errorCallback(e.message,l.errorCall)}})}),r.find("#kg-revokeVerifyCode").keydown(function(e){13==e.keyCode&&r.options.onOk.call(r)})):(r.find("#kg-password").keydown(function(e){13==e.keyCode&&r.options.onOk.call(r)}),e=W.options.pwdIsEncrypt,i=W.options.password,e&&i&&r.find("#kg-password").val(i))},onOk:function(){var t=this,n=t.find("#kg-password"),i=t.find("#kg-revokeVerifyCode");if(d){if(!i.val())return C.alert(y.msg("in_verification_msg","KG_MSG"),function(){i.focus()}),!1}else if(!n.val())return C.alert(y.msg("in_input_msg","KG_MSG"),function(){n.focus()}),!1;c.sealService.checkKeysn.call(c,{keysn:c.signatureData.keysn,usercode:c.signatureData.usercode},function(e){return e.result?d&&i.val()?(C.showLoading(),void c.sealService.verifyPwd({verify:d,pwd:i.val(),keysn:l.target.keysn,successCall:function(e){if(C.hideLoading(),e.result)return l._onOk.call(t,i.val()),!1;c.error(e,null,null,{_beginDlgOkCall:!0})}})):(l._onOk.call(t,n.val()),!1):(c.error(e,null,null,{_beginDlgOkCall:!0}),!1)})}};return c.showDialog("signSignatureBtl",e)},changeMoveAble:function(e,t){this.signatureData.moveable=e,this.fireUpdate(),t&&t()},signSignature:function(i){var o=this,t={target:o,_onOk:function(e){var t=this,n=o.getH5SignData();o.runSign(n,e,null,function(e){e.result?o.fireUpdate(function(e){e&&t.remove()}):o.error(e,null,null,{_beginDlgOkCall:!0}),i&&i(e)})}};if(!o.signatureData.phoneshield)return o.showSignSignatureDialog(t);"client"==W.options.sealType&&o.sealService.getPhoneShieldLic({phoneshield:W.options.phoneshield},function(e){"1"==e.phoneshield||"3"==e.phoneshield?(y.options.timeout=1e3*(e.validatetime+10),t._onOk("")):"2"==e.phoneshield?o.error({errcode:"11110"},"then"):o.error({errcode:"11109"},"then")})},showRevokeSignatureDialog:function(l){var c=this,d=W.options.verification,e={target:z.is("Array",l.target)?l.target:[l.target],title:y.msg("RevokeSignature","KG_TITLE"),quickClose:null==W.options.quickClose||W.options.quickClose,onCancel:function(){W.options.dlgCancelCall&&W.options.dlgCancelCall.call()},onShow:function(){W.options.beginDlgShowCall&&W.options.beginDlgShowCall.call();var t,n,o,a,s,e,i,r=this;W.editThemeColor(),W.repairInputEvent(R("#kg-password")),d?(n=(t=c).signatureData.keysn,o="",a=r.find(".kg-tipText"),c.sealService.getTelphone({keysn:n,successCall:function(e){e.result?(a.html(e.phone),o=e.phone):t.errorCallback(e.massage,l.errorCall)}}),(a=r.find(".kg-tipText")).html(o),a.click(function(){a.hide(),r.find("#kg-revokeVerifyCode").focus()}),r.find("#kg-revokeVerifyCode").click(function(){a.hide(),r.find("#kg-revokeVerifyCode").focus()}),s=r.find(".kg-revokeMark"),r.find(".kg-revokeBtn").click(function(e){C.showLoading();var i=R(this);t.sealService.applySMSCode({keysn:n,successCall:function(e){var t,n;e.result?(clearInterval(n),C.hideLoading(),a.css({display:"block"}).html(R.kgi18n.prop("sentSMSCode")),s.css({display:"block"}),t=60,n=setInterval(function(){0<=t?(t<10&&(t="0"+t),i.html(t+"秒"),t--):(i.html("验证码"),s.css({display:"none"}),a.html(o),clearInterval(n))},1e3)):c.errorCallback(e.message,l.errorCall)}})}),r.find("#kg-revokeVerifyCode").keydown(function(e){13==e.keyCode&&r.options.onOk.call(r)})):(r.find("#kg-password").keydown(function(e){13==e.keyCode&&r.options.onOk.call(r)}),e=W.options.pwdIsEncrypt,i=W.options.password,e&&i&&r.find("#kg-password").val(i))},onOk:function(){var e=this.find("#kg-password"),t=this.find("#kg-revokeVerifyCode");if(d){if(!t.val())return C.alert(y.msg("in_verification_msg","KG_MSG"),function(){t.focus()}),!1}else if(!e.val())return C.alert(y.msg("in_input_msg","KG_MSG"),function(){e.focus()}),!1;return l._onOk.call(this,(d?t:e).val()),!1}};return c.showDialog("signSignatureBtl",e)},revokeSignature:function(a){function s(t){void 0!==W.options.delCallBack&&W.options.delCallBack?W.options.delCallBack(r.signatureid,r.signatureData)&&r.fireRemove(function(e){e&&(t.remove?t:r).remove()}):r.fireRemove(function(e){e&&(t.remove?t:r).remove()})}var r=this;if("scanStamp"!=r.signatureData.stampType||W.options.clientConfig){t={target:r,_onOk:function(e,t){var n=this,i=r.signatureData.seal.esid,o=r.signatureData.keysn;C.showLoading(),i&&!o?(C.hideLoading(),r.sealService.getRemoveAuthority(r.signatureid,r.signatureData,function(e){e?(s(n),a&&a({result:!0})):n.remove()})):r.sealService.verifyPwd({verify:W.options.verification,pwd:e,keysn:r.signatureData.keysn,successCall:function(e){C.hideLoading(),!e.result||null!=e.delkeysn&&e.delkeysn!=r.signatureData.keysn?r.error(e,null,null,{_beginDlgOkCall:!0}):s(n),a&&a(e)},phoneshield:t})}};if(r.signatureData.phoneshield&&"client"==W.options.sealType)r.sealService.getPhoneShieldLic({phoneshield:"1"},function(e){"1"==e.phoneshield||"3"==e.phoneshield?(y.options.timeout=1e3*(e.validatetime+10),t._onOk("","1")):"2"==e.phoneshield?r.error({errcode:"11110"},"then"):r.error({errcode:"11109"},"then")});else{if(!W.options.showNoPW||"server"!=W.options.sealType)return r.showRevokeSignatureDialog(t);t._onOk(W.options.password)}}else{var t={title:y.msg("RevokeSignature","KG_TITLE"),target:r,onCancel:!1},n=W.ScanStamp.call(r,function(){return r.showDialog("scanStampdlg",t)},function(e){var t;e.result?(t=n.dialog,s(t)):r.error(e,null,null,{_beginDlgOkCall:!0}),a&&a(e)}),e=r.signatureData.esid;n.getQrCodeImageByDelete(e)}},showDialog:function(t,e){e.sucCall;var n,i,o,a,s,r,l=z.is("Array",e.target)?e.target:[e.target],c={title:y.msg("KinggridSignature","KG_TITLE"),onShow:function(){var t=this;W.editThemeColor(),setTimeout(function(){t.find("#kg-password").focus()},40),t.find("#kg-password").keydown(function(e){13==e.keyCode&&t.options.onOk.call(t)})},onCancel:e.errCall||function(){return C.hideLoading(),!0},content:function(){var e=[W.options.template[t]].concat(l);return z.template.apply(null,e)}},c=z.extend(c,e),d=C.showDialog(t,c);return"showSealsBtl"===t&&(n=d.find("#sealTpl-dialog"),i=!1,r=s=a=o=0,n.prevObject[0].onmousedown=function(e){i=!0,null!=(e=e||event)&&(o=e.clientX,a=e.clientY,s=parseInt(n.prevObject[0].style.top),r=parseInt(n.prevObject[0].style.left))},n.prevObject[0].onmousemove=function(e){var t;i&&null!=(e=e||event)&&(t=r+e.clientX-o,e=s+e.clientY-a,0<t&&0<e&&(n.prevObject[0].style.left=t+"px",n.prevObject[0].style.top=e+"px"))},n.prevObject[0].onmouseup=function(e){i&&(i=!1,r=s=a=o=0)}),"signatureInfoBtl"!=t&&"signInfoBtl"!=t||d.find(".ui-dialog-close").click(function(){d.close(),W.options.dlgCancelCall&&W.options.dlgCancelCall.call()}),d},runMove:function(e,t,n){var o,a=this,i=(_.trigger("startMove",a,e,t),function(e){var t,n,i=e.moveableRange;if(!i){for(n in e.position){t=n;break}e=R("#"+t).attr("kg-mita");e&&(i=e)}if(i){e=R("#"+i);if(0<e.length)return{left:e.offset().left,right:e.offset().left+e.outerWidth(),top:e.offset().top,bottom:e.offset().top+e.outerHeight()}}return{left:0,right:0,top:0,bottom:0}});return"client"==W.options.sealType&&W.options.moveable_self&&a.keysn!=a.signatureData.keysn?(W.alert(y.msg("cannot_move","KG_MSG")),!1):(e=e,t=t,o=n,n=i(a.signatureData),(t=A.create(t,e,!0,n)).onend=function(e,t,n,i){o&&o(t,n,i),_.trigger("endMove",a,e,n,i),t&&(e=R(this),a.updatePos(e.attr("elemid"),{marginLeft:n,marginTop:i}),a.fireUpdate())},e.preventDefault(),t)},runSign:function(n,e,t,i){var o=this,a=o.signatureData;if(W.options._clientHW)return W.options._clientHW=!1,i({result:!0});C.showLoading(),o.certService.sign({seal:this.signatureData.seal,keysn:this.signatureData.keysn,signsn:this.signatureData.seal.signsn,documentid:this.signatureData.documentid,documentname:this.signatureData.documentname,password:e,type:t,phoneshield:this.signatureData.phoneshield,signMeta:n,successCall:function(e){var t;C.hideLoading(),e.result&&(e.signeddata?(e.certinfo.algName=e.certinfo.algName.toUpperCase(),t=z.is("Array",e.tsaInfo)?e.tsaInfo[0]:e.tsaInfo,o.updateItem("signMeta",{hashAlg:n[0].hashAlg,encryptAlg:n[0].encryptAlg,signdata:n[0].signdata,signeddata:o.__findSignedData(e.signeddata),certinfo:e.certinfo,tsaInfo:t})):(e.result=!1,e.errcode="signErr"),a.certType=W.options.certType),i&&i(e)}})}}),t()),t=(W.options=R.extend({savelogFlg:!0,b64Url:"/iWebSignature_base64",imageUrl:"/iWebSignature_image",languagesPath:"../kinggrid/languages",pw_enc_save:!0,autoCertMode:!0,showSealsDlg:!0,encryptPwd:!0,showRememberPwd:!0,version:"iSignature_HTML5(V3.0)",verification:!1},y.options,{dialogConfig:{okValue:"确  定",cancelValue:"取  消",fixed:!0,backdropOpacity:.2,modal:!0},template:{},themeColor:{red:{"primary-background-color":"#C62929","primary-border-color":"#C62929","primary-color":"#ffffff","primary-hover-background-color":"#e45a5a","primary-hover-border-color":"#e45a5a","primary-hover-color":"#ffffff","default-background-color":"#ffffff","default-border-color":"#cccccc","default-color":"#333333","default-hover-background-color":"#ffffff","default-hover-border-color":"#C62929","default-hover-color":"#C62929","second-background-color":"#fff","second-color":"#C62929","second-hover-background-color":"#fff4f4","second-hover-color":"#C62929","primary-select-image":'url("image/select_red.png") no-repeat center white',"primary-box-shadow":"0px 2px 6px rgba(198, 41, 41,.2)"},blue:{"primary-background-color":"#1890ff","primary-border-color":"#1890ff","primary-color":"#ffffff","primary-hover-background-color":"#4eaaff","primary-hover-border-color":"#4eaaff","primary-hover-color":"#ffffff","default-background-color":"#ffffff","default-border-color":"#cccccc","default-color":"#333333","default-hover-background-color":"#ffffff","default-hover-border-color":"#1890ff","default-hover-color":"#1890ff","second-background-color":"#fff","second-color":"#1890ff","second-hover-background-color":"#eef7ff","second-hover-color":"#1890ff","primary-select-image":'url("image/select_blue.png") no-repeat center white',"primary-box-shadow":"0px 2px 6px rgba(0, 132, 255,.2)"}}},window.KGCONFIG),W.addProvider=function(e,t,n){W.factory[e][t]=n},W.init=function(e,t){this.Seals={},z.extend(W.options,e);var n=W.options,e=(!1===W.options.showSealsDlg&&W.options.password&&!W.options.showNoPW&&(W.options.defaultPassword=W.options.password),t=t||e.okCall,n.serverUrl&&(n.b64Url="_signature_b64",n.imageUrl="_signature_image",0<n.serverUrl.indexOf("?")?n.serverUrl=n.serverUrl+"&action=rest":n.serverUrl=n.serverUrl+"?action=rest"),S="client"==n.sealType?(n.clientUrl=n.https,W.aisleKing=y.surry(n.clientUrl||"http://127.0.0.1:9581","IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode)):W.aisleKing=y.surry(n.serverUrl||n.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode),n.clientConfig),e=(e&&"client"===n.sealType?(n.LANGUAGE=n.clientConfig.LANGUAGE,W.AXI("SetParamByName",e,t)):t&&t.call(),jQuery.kgi18n.normaliseLanguageCode({}));n.isMobile=/phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(navigator.userAgent),n.LANGUAGE?n.Global=n.LANGUAGE.substring(0,2):(n.LANGUAGE=e,2<jQuery.kgi18n.normaliseLanguageCode({}).length?n.Global=e.substring(0,2):n.Global=e),n.autoCertMode&&(n.icon_sign=!1,n.icon_signverify=!1),this.dynamicLoadCss(n.languagesPath+"/style/language_"+n.Global+".css"),this.loadProperties(),_.trigger("init")},W.factory={cert:{},seal:{}},W.SealService=o,W.CertService=r,W.asyn={},W.scanCallBack=function(){},W._create=function(e){var a=this;return a.setAttr(e),a.certService=new W.factory.cert[a.certType](e),a.sealService=new W.factory.seal[a.sealType](e),a.on("createSignature",function(e,t,n){var e=e.signatureData,i=[],o="盖章成功",e=(e.phone&&null!=e.phone&&""!=e.phone&&(o="盖章成功【手机短信验证"+e.phone+"】"),a._getLogInfo({LOGTYPE:"00",LOGSORT:"13",LOGMEMO:o,LOGSORTSUBCLASS:"1301"}));i.push(z.extend(t||{},e)),n&&i.push(a._getLogInfo({LOGTYPE:"00",LOGSORT:"304",LOGMEMO:"数字签名成功"})),a.sealService.saveLog(i)}),this},c.prototype=W.prototype,new c);function w(e,t,n){var i,o=[],a={};for(i in e){var s={},r=e[i];z.is("String",r)&&0!=r.indexOf("ey")?(s["b64_"+i]=e[i],o.push(s)):a[i]=r}var l,c=[],d=a;for(l in d)c.push(new W(l,d[l]).load(W.options));var g,u=o.length;if(u)for(var f=W.options.signSize||5,p=Math.ceil(u/f),h=1;h<=p;h++){var m=f*(h-1),v=u<f*h?u:f*h;(S=y.surry(W.options.serverUrl)).request(W.options.b64Url,o.slice(m,v)).ret(function(e){if(e.result)for(var t in e){var n;0==t.indexOf("b64_")&&(n=e[t],z.is("String",n)&&(n=JSON.parse(n)),c.push(new W(t.substring(4),n).load(W.options)))}else W.prototype.error.call(null,e)})}null!=S&&(g=function(){t&&t(1==c.length?c[0]:c)},u?S.fin(g):g(),n&&n())}W._create.prototype=t,R.extend(t,{keyData:null,sealExpired:function(e,t,n,i,o){var a,s,r,l,c=this,d=!0;return void 0===W.options.valid||null===W.options.valid||!1===W.options.valid?c.certExpired(t,n,i):void 0===e.endata||null===e.endata?(r=W.options.serverUrl+"_key_sealIsExpired",l=parseInt(o),o=(l+=1).toString(),R.ajax({url:r,type:"POST",data:{keysn:c.keyData.keysn,year:(new Date).getFullYear(),month:(new Date).getMonth(),date:(new Date).getDate(),index:o},async:!1,success:function(e){return e.error?(c.errorCallback({errcode:"11105"},t.errorCall),!1):0==e.result?c.certExpired(t,n,i):(c.errorCallback({errcode:"11104"},t.errorCall),!1)},error:function(e){c.errorCallback({errcode:"11105"},t.errorCall)}}),!1):(l=e.endata,r=parseInt(n.substr(0,4)),o=parseInt(n.substr(5,2)),e=parseInt(n.substr(8,2)),a=parseInt(l.substr(0,4)),s=parseInt(l.substr(5,2)),l=parseInt(l.substr(8,2)),(d=a<r?(c.errorCallback({errcode:"11104"},t.errorCall),!1):r!=a||(s<o?(c.errorCallback({errcode:"11104"},t.errorCall),!1):o!=s||(!(l<e)||(c.errorCallback({errcode:"11104"},t.errorCall),!1))))?c.certExpired(t,n,i):d)},certExpired:function(r,l,c){var d=this,g=!1;return void 0===W.options.valid||null===W.options.valid||!1===W.options.valid||(y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode).invoke("KGGetCerInfo","").ret(function(e){var t,n,i,o=parseInt(l.substr(0,4)),a=parseInt(l.substr(5,2)),s=parseInt(l.substr(8,2));e.result?(e=e.certinfo.notAfter,t=parseInt(e.substr(0,4)),n=0==(n=parseInt(e.substr(4,1)))?parseInt(e.substr(5,1)):parseInt(e.substr(4,2)),i=0==(i=parseInt(e.substr(6,1)))?parseInt(e.substr(7,1)):parseInt(e.substr(6,2)),t<o||o==t&&(n<a||a==n&&i<s)?d.errorCallback({errcode:"11103"},r.errorCall):g=!0):d.errorCallback({errcode:"11106"},r.errorCall),null!=c&&c(g)}),g)},errorCallback:function(e,t,n,i){t?(C.hideLoading(),t.call(null,e,n)):this.error(e,n,null,i)},runHW:function(i,o){var e,a=this;C.showLoading(),W._showAndHideSealsDlg(),void 0!==i.imageData&&null!=i.imageData?(void 0!==i.beginCall&&i.beginCall&&i.beginCall.call(a),e=function(e){if(C.hideLoading(),e.result&&e.seals.length){for(var t in e.seals){var n=e.seals[t].sealTag||e.seals[t].sealtag,n=[{width:i.width,height:i.height,imgext:e.seals[t].imgext,signname:i.name,signsn:e.seals[t].signsn,username:e.seals[t].username,imgdata:i.imageData,sealTag:n,seSeal:e.seals[t].seSeal,headinfoex:e.seals[t].headinfoex}];e.seals=n;break}a.keyData=e,a.showSeals(o)}else a.errorCallback({errcode:"111000"},i.errorCall)},i.keyData&&i.keyData.result?e(i.keyData):a.sealService.loadSeal({isHW:!0,data:i.imageData,successCall:e,errorCall:function(e){a.errorCallback(e,i.errorCall)}})):i.qrCodeUserUid&&(C.hideLoading(),(e={}).qrCodeUserUid=i.qrCodeUserUid,e.seals=i.sealData,e.reuslt=!0,e.ServerTime=new Date(+new Date+288e5).toJSON().substr(0,19).replace("T"," "),e.username=i.username,e.esid=i.esid,i.stampType&&(e.stampType=i.stampType),a.keyData=e,a.showSeals(o))},run:function(n){var i=this;i.showPromptDialog(function(){return i.keyData?i.showSeals(n):(C.showLoading(),void 0!==n.beginCall&&n.beginCall&&n.beginCall.call(i),i.sealService.loadSeal({type:n.type,successCall:function(t){C.hideLoading(),t.result?t.seals&&t.seals.length?(i.keyData=t,i.sealService.getKeysn({},function(e){W.options.keysn=e,W._getCookie("ksn")!=e&&W.clearRPW();var e=i.keyData.seals;W._showAndHideSealsDlg(e),W.options.clientConfig||void 0===W.options.imgtag||0===W.options.imgtag||void 0!==t.ServerTime?(i.curDate=t.ServerTime,i.showSeals(n)):void 0!==i.serverUrl&&null!==i.serverUrl?(e={usercode:i.usercode,keysn:i.keyData.keysn,signname:i.signname,authcode:W.authcode},y.surry(i.serverUrl).request("_key_load",e).ret(function(e){e.result?(i.curDate=e.ServerTime,i.keyData=e,i.showSeals(n)):i.errorCallback(e,n.errorCall)})):(i.curDate=(new Date).toLocaleString(),i.showSeals(n))})):i.errorCallback({errcode:"11100"+W.options.imgtag},n.errorCall):i.errorCallback(t,n.errorCall)},errorCall:function(e){i.errorCallback(e,n.errorCall)}})),this})},getSealsByKeysn:function(e,i,t){var o=this;o.sealService.loadSeal({successCall:function(e){if(e.result){var t=[];if(void 0!==i&&null!=i){for(var n=0;n<e.seals.length;++n)t[n]=o.toBase64Img(e.seals[n]);i(t)}}},errorCall:function(e){o.errorCallback(e,t.errorCall)}})},loadSeals:function(t,n){var i=this;i.sealService.loadSeal({successCall:function(e){null!=t&&null!==e&&void 0!==e.seals&&null!==e.seals&&t(e)},errorCall:function(e){i.errorCallback(e,n&&n.errorCall?n.errorCall:null)}})},runSS:function(t,e){var n,i=this;null!==e&&(null==(i.keyData=e).seals||0==e.seals.length?i.errorCallback({errcode:"11107"},t.errorCall):void 0!==W.options.imgtag&&0!==W.options.imgtag&&void 0===e.ServerTime?void 0!==i.serverUrl&&null!==i.serverUrl?(n={usercode:i.usercode,keysn:i.keyData.keysn,signname:i.signname,authcode:W.authcode},y.surry(i.serverUrl).request("_key_load",n).ret(function(e){e.result?(i.curDate=e.ServerTime,i.keyData=e,i.showSeals(t)):i.errorCallback(e,t.errorCall)})):(i.curDate=(new Date).toLocaleString(),i.showSeals(t)):(i.curDate=e.ServerTime,i.showSeals(t)))},formatPos:function(e,n,i){var o={};if(e){function t(e){var t=e.elemid||e[0].id;o[t=t||"body"]=null!=n&&null!=i?{marginLeft:n,marginTop:i}:z.filter(e,t)}if(z.is("Array",e))for(var a=0;a<e.length;a++)t(e[a]);else z.is("String",e)?o[e]=null!=n&&null!=i?{marginLeft:n,marginTop:i}:{}:t(e)}else o.body={};return o},exec:function(n,i,o,t,a,s){function r(t){var e=c.signatureData;if(!t||!t.position)throw new Error("no set position");t.offsetX&&t.offsetY?(t.changeOffsetXY&&t.changeOffsetXY(t),e.position=c.formatPos(t.position,t.offsetX,t.offsetY)):t.changeOffsetXY?(n={width:Math.ceil(9600*parseFloat(o.width)/254),height:Math.ceil(9600*parseFloat(o.height)/254)},n=t.changeOffsetXY(n),e.position=c.formatPos(t.position,n.offsetX,n.offsetY)):e.position=c.formatPos(t.position);var n=t.signatureid||c.genId(),i=(t&&t.scopePosition&&(null==W.options.extra&&(W.options.extra={}),W.options.extra[n]={scopePosition:t.scopePosition}),e.timeid=(new Date).getTime(),new W(n,e).load(W.options));t.okCall&&(n={name:o.signname,height:o.height,width:o.width,imgdata:c.toBase64Img(o)},t.isBatchSignature?t.okCall.call(i,function(e){},t.documentid):t.okCall.call(i,function(e){c.trigger("createSignature",i,t.logMeta,d),e&&i.show()},n)),C.hideLoading()}var l,c=this,e=(delete c.signatureData,e=null!=n.protectedItemsType&&"1"==n.protectedItemsType?n.protectedItems:c.getProtectedData(n.protectedItems),{timestamp:{time:(null==n.signtime?new Date:new Date(Date.parse(n.signtime.replace(/-/g,"/")))).getTime(),signtime:null==n.showtime?n.signtime:n.showtime,timestampInfo:n.timestampInfo},appname:W.options.version,documentid:(null==n.documentid?c:n).documentid,documentname:(null==n.documentname?c:n).documentname,moveable:z.boolean(n,"moveable",W.options.moveable),keysn:c.keyData.keysn,orgname:c.keyData.orgname,usercode:c.keyData.usercode,username:c.keyData.username||o.username,phoneshield:!!W.options.phoneshield,gbOvalue:c.keyData.gbOvalue,seal:o,phone:W.options.verification?c.keyData.phone:null,moveableRange:n.moveableRange,protectedData:e,sealType:n.sealType||c.sealType,extparam:n.extparam,ver:W.version,postilFontSet:n.postilFontSet,dateTime:n.datetime}),d=(c.keyData.stampType&&(e.stampType=c.keyData.stampType),o.esid&&(e.esid=o.esid),c.keyData.qrCodeUserUid&&(e.qrCodeUserUid=c.keyData.qrCodeUserUid),c.signatureData=e,c.certService.sData=c.signatureData,c.sealService.sData=c.signatureData,C.showLoading(),W.options.autoCertMode||n.autoCert||c.autoCert||W.options.phoneshield&&"1"!=W.options.fjrsIsphone);d||"scanStamp"===e.stampType?(n.hashAlg||c.hashAlg,n.encryptAlg||c.encryptAlg,c.getSignData(e),l=c.getH5SignData(),n.signMeta&&l[z.is("Array",n.signMeta)?"concat":"push"](n.signMeta),n.beforeSignCall&&n.beforeSignCall.call(c,l),a?"client"==W.options.sealType?c.runSign(l,t,n.type,function(e){e.result&&(r(n),s&&1<s.batchSignature.length&&(n.documentid=s.batchSignature[s.batchSignature.length-1].documentid,n.documentname=s.batchSignature[s.batchSignature.length-1].documentname,n.position=s.batchSignature[s.batchSignature.length-1].position,n.protectedItems=s.batchSignature[s.batchSignature.length-1].protectedItems,--s.batchSignature.length,c.exec(n,i,o,t,a,s))),i(e)}):c.sealService.verifyPwd({verify:W.options.verification,pwd:t,keysn:e.keysn,successCall:function(e){e.result?r(n):W.options.pwd_clear_flag&&c.onDeleteRPW&&c.onDeleteRPW(),i(e)},phoneshield:W.options.phoneshield}):c.keyData.noPassWord||c.signatureData.seal.esid?c.runSign(l,t,n.type,function(e){e.result?r(n):c.error(e,null,null,{_beginDlgOkCall:!0}),i({result:!0})}):c.sealService.checkKeysn.call(c,{keysn:c.signatureData.keysn,usercode:c.signatureData.usercode},function(e){e.result?c.runSign(l,t,n.type,function(e){var t;e.result&&(t=c.keyData.seals,setTimeout(function(){W._showAndHideSealsDlg(t)}),r(n)),i(e)}):c.error(e,null,null,{_beginDlgOkCall:!0})})):a?r(n):c.sealService.verifyPwd({verify:W.options.verification,pwd:t,keysn:e.keysn,successCall:function(e){var t;e.result?(t=c.keyData.seals,setTimeout(function(){W._showAndHideSealsDlg(t)}),r(n)):W.options.pwd_clear_flag&&c.onDeleteRPW&&c.onDeleteRPW(),i(e)},phoneshield:W.options.phoneshield})},runPwd:function(n){var i=this,e={cancelCall:n.cancelCall,_onOk:function(e){W.options.showNoPW=!0,W.options.password=e;var t=this.find("#kg-remenberPwd").is(":checked");i.trigger("execSuccess",this,e,t),i.run(R.extend(n,{beginCancalCall:function(){W.options.showNoPW=!1,W.options.password=""}}))}};i.showPwdDialog(e)},showPwdDialog:function(e){var n=this,i=e._onOk;n.showDialog("inputTpl",{onCancel:function(){R("#kg-password").blur(),e.cancelCall()},onShow:function(){var t=this;W.editThemeColor(),W.repairInputEvent(R("#kg-password")),n.trigger("showSealsDialog_PW",t),setTimeout(function(){t.find("#kg-password").focus()},40),t.find("#kg-password").keydown(function(e){13==e.keyCode&&t.options.onOk.call(t)})},onOk:function(){var e=this.find("#kg-password"),t=e.val();return t?(i.call(this,t),this.remove()):C.alert(y.msg("in_input_msg","KG_MSG"),function(){e.focus()}),!1},content:function(){var e=[C.template.inputTpl];return z.template.apply(null,e)}})},showPromptDialog:function(t){var a=this,o="kg-certValidaty-dontShow",s={},r="",l=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode);function c(t,e){var n,i,o;e.result?(n=e.certinfo.notAfter,o=(o=new Date(+new Date+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")).replace(/-/g,"/"),t.days=(i=n,o=o,i=new Date(g(n)),o=new Date(g(o)),Math.floor((i-o)/864e5)),l.invoke("KGGetPublicParm","Customer","ValidateCertUpdateURL","").ret(function(e){e&&(r=e)}),l.invoke("KGGetPublicParm","Public","HintRemainingDays","").ret(function(e){t.days>e?d(!0):(t.days<=e&&0<t.days?t.certStatus=1:t.certStatus=0,d())})):(W.options.password="",a.errorCallback({errmsg:e.errmsg}))}function d(e){e||"true"==function(){for(var e=document.cookie.split("; "),t=null,n=0;n<e.length;n++){var i=e[n].split("=");if(i[0]==o){t=i[1];break}}return t}()?t&&t():a.showDialog("prompt",i)}function n(){r?window.open(r):a.errorCallback({errmsg:"获取地址失败"})}a.clientConfig?l.invoke("KGGetPublicParm","Customer","ValidateCertExpireTime","").ret(function(e){typeof e==String&&"true"==e.toLowerCase()?W.options.password||W._getCookie("pwd")?(e=W._getCookie("pwd")||W.options.password,l.invoke("KGGetCerInfo",e).ret(function(e){c(s,e)})):a.showPwdDialog({cancelCall:function(){C.hideLoading()},_onOk:function(t){var n=this,i=n.find("#kg-remenberPwd").is(":checked");l.invoke("KGGetCerInfo",t).ret(function(e){e.result?(W.options.password=t,a.trigger("execSuccess",n,t,i),c(s,e)):a.errorCallback({errmsg:e.errmsg})})}}):d(!0)}):t();var i={cancelCall:function(){},onShow:function(){W.editThemeColor();var e,t=W._color||"red";switch(setTimeout(function(){u.iframeDialog?(R(window.top.document).find("[i-id=cancel]").html(R.kgi18n.prop("GoToRenewal")),R(window.top.document).find("[data-kgi18n-html]").each(function(e){R(this).html(R.kgi18n.prop(R(this).data("kgi18n-html"))),R(this).addClass("kg-fontFamily")}),a.isMobile||R(window.top.document).find(".ui-dialog-button").css("float","right")):(R("[i-id=cancel]").show(),R("[i-id=cancel]").html(R.kgi18n.prop("GoToRenewal")),a.isMobile||R(".ui-dialog-button").css("float","right"))},100),R("[i-id=cancel]").click(n),e=(u.iframeDialog?R(window.top.document):this).find(".kg-promtInfo"),s.certStatus){case 0:return void e.html('<i class="kg-icon-prompt"/><span data-kgi18n-html="RenewalPastDue"></span>');case 1:return e.html('<i class="kg-icon-prompt"/><span data-kgi18n-html="RenewalInfoLeft"></span> <span id="kg-date">'+s.days+'</span> <span data-kgi18n-html="RenewalInfoRight"></span>'),void this.find(".ui-dialog-checkInput").html('<div class="kg-tipCheck"><input type="checkbox" name="noPrompt" class="kg-primary-check-'+t+'" id="kg-noPrompt" >&nbsp;<label for="kg-noPrompt" data-kgi18n-html="NoPrompt">不再提示</label></div>')}},onOk:function(){var e;this.find("#kg-noPrompt").is(":checked")&&((e=new Date).setTime(e.getTime()+864e5),document.cookie=o+"=true;expires=+"+e.toGMTString()),s.certStatus&&t&&t()},content:function(){var e=[C.template.prompt];return z.template.apply(null,e)}};function g(e){return 0<e.indexOf("/")?e:e.slice(0,4)+"/"+e.slice(4,6)+"/"+e.slice(6,8)+" "+e.slice(8,10)+":"+e.slice(10,12)+":"+e.slice(12,14)}},getPassCheck:function(e,t,n){if(e&&1==e)return e;if(void 0===n||!0===n||"auto"===n)try{return t.find("#kg-remenberPwd").is(":checked")}catch(e){return!1}return!1},showSeals:function(c){var t,n,i,e,d=this,o={errorCall:c.errorCall,cancelCall:c.cancelCall,beginCancalCall:c.beginCancalCall,protectedItems:c.protectedItems,protectedItemsType:c.protectedItemsType,protectedItemsCheckedAll:null==c.protectedItemsCheckedAll||c.protectedItemsCheckedAll,_onOk:function(n,i,e,t,o,a){var s=this,r=new C.kgFont(null==s.fontSel?null==d.signdate?{}:d.signdate:s.fontSel),l=s.isCheck,l=(!1!==W.options.showSealsDlg&&d.autoDlg||!W.options.signdate||!W.options.signdate.ischeck||(l=W.options.signdate.ischeck),c.protectedItems=null==s.proItems?0==c.protectedItemsCheckedAll?[]:c.protectedItems:s.proItems,c.datetime={isCheck:l,fontDate:r},new C.kgFont(null==s.postilFontSet?null==d.thirdConfig||null==d.thirdConfig.postilFontSet?{}:d.thirdConfig.postilFontSet:s.postilFontSet,"0"));if(l.fontValue=null!=d.postilFontSet&&null!=d.postilFontSet.fontValue?d.postilFontSet.fontValue:"",c.postilFontSet=l,null!=t?(c.signtime=t,null!=o?(o.TimeExt?c.showtime=(t+" ("+o.TimeExt+")").replace(/-/g,"/"):c.showtime=t.replace(/-/g,"/"),c.showtime+=y.msg("timestamp_time","KG_MSG"),c.timestampInfo=o):(c.showtime=new Date(Date.parse(t.replace(/-/g,"/"))).toLocaleString(),c.showtime+=y.msg("server_time","KG_MSG"))):(c.signtime=void 0,c.showtime=(new Date).toLocaleString(),c.showtime+=y.msg("local_time","KG_MSG")),a=d.getPassCheck(a,s,W.options.showSealsDlg),void 0===W.options.valid||null===W.options.valid||!1===W.options.valid)c.batchSignature?d.sealService.verifyPwd({verify:W.options.verification,pwd:i,usercode:null==c.usercode?"":c.usercode,keysn:d.keyData.keysn,successCall:function(e){if(e.result){for(var t=0;t<c.batchSignature.length&&(c.batchSignature[t].signtime=c.signtime,c.batchSignature[t].showtime=c.showtime,null!=c.position&&(c.batchSignature[t].position=c.position),c.batchSignature[t].autoCert=c.autoCert,c.batchSignature[t].okCall=c.okCall,c.batchSignature[t].cancelCall=c.cancelCall,c.batchSignature[t].beginCall=c.beginCall,c.batchSignature[t].endCall=c.endCall,null!=c.protectedItems&&(c.batchSignature[t].protectedItems=c.protectedItems),c.batchSignature[t].protectedItemsType=c.protectedItemsType,c.batchSignature[t].datetime=c.datetime,c.batchSignature[t].offsetX=c.offsetX,c.batchSignature[t].offsetY=c.offsetY,c.batchSignature[t].changeOffsetXY=c.changeOffsetXY,c.batchSignature[t].isBatchSignature=!0,d.exec(c.batchSignature[t],function(e){e.result?void 0!==W.options.showNoPW||!0===W.options.showNoPW?void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(d):void 0!==W.options.showSealsDlg&&!0!==W.options.showSealsDlg&&!d.autoDlg||d.trigger("execSuccess",s,i,a):d.errorCallback(e,c.errorCall)},n,i,!0,c),void 0!==c.batchSignature[t].endCall&&c.batchSignature[t].endCall&&c.batchSignature[t].endCall.call(d),"client"!=W.options.sealType||!c.autoCert);++t);void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(d),void 0!==W.options.showSealsDlg&&!0!==W.options.showSealsDlg&&!d.autoDlg||s.remove()}else W.options.pwd_clear_flag&&d.onDeleteRPW&&d.onDeleteRPW(),d.errorCallback(e,c.errorCall)},phoneshield:W.options.phoneshield}):(d.exec(c,function(e){e.result?(void 0!==W.options.showNoPW||!0===W.options.showNoPW||W.options.phoneshield?void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(d):void 0!==W.options.showSealsDlg&&!0!==W.options.showSealsDlg&&!d.autoDlg||d.trigger("execSuccess",s,i,a),s.remove()):d.error(e,null,null,{_beginDlgOkCall:!0})},n,i),void 0!==c.endCall&&c.endCall&&c.endCall.call(d));else if(void 0===d.curDate||null===d.curDate||!d.sealExpired(n,c,d.curDate,function(e){e?c.batchSignature?d.sealService.verifyPwd({verify:W.options.verification,pwd:i,keysn:d.keyData.keysn,successCall:function(e){if(e.result){for(var t=0;t<c.batchSignature.length&&(c.batchSignature[t].signtime=c.signtime,c.batchSignature[t].showtime=c.showtime,null!=c.position&&(c.batchSignature[t].position=c.position),c.batchSignature[t].autoCert=c.autoCert,c.batchSignature[t].okCall=c.okCall,c.batchSignature[t].cancelCall=c.cancelCall,c.batchSignature[t].beginCall=c.beginCall,c.batchSignature[t].endCall=c.endCall,null!=c.protectedItems&&(c.batchSignature[t].protectedItems=c.protectedItems),c.batchSignature[t].protectedItemsType=c.protectedItemsType,c.batchSignature[t].datetime=c.datetime,c.batchSignature[t].offsetX=c.offsetX,c.batchSignature[t].offsetY=c.offsetY,c.batchSignature[t].changeOffsetXY=c.changeOffsetXY,c.batchSignature[t].isBatchSignature=!0,d.exec(c.batchSignature[t],function(e){e.result?void 0!==W.options.showNoPW||!0===W.options.showNoPW||W.options.phoneshield?void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(d):void 0!==W.options.showSealsDlg&&!0!==W.options.showSealsDlg&&!d.autoDlg||d.trigger("execSuccess",s,i,a):d.errorCallback(e,c.errorCall)},n,i,!0),void 0!==c.batchSignature[t].endCall&&c.batchSignature[t].endCall&&c.batchSignature[t].endCall.call(d),"client"!=W.options.sealType||!c.autoCert);++t);void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(d),void 0!==W.options.showSealsDlg&&!0!==W.options.showSealsDlg&&!d.autoDlg||s.remove()}else d.errorCallback(e,c.errorCall)},phoneshield:W.options.phoneshield}):(d.exec(c,function(e){e.result?(void 0!==W.options.showNoPW||!0===W.options.showNoPW||W.options.phoneshield?void 0!==c.beginCancalCall&&c.beginCancalCall&&c.beginCancalCall.call(d):void 0!==W.options.showSealsDlg&&!0!==W.options.showSealsDlg&&!d.autoDlg||d.trigger("execSuccess",s,i,a),s.remove()):d.errorCallback(e,c.errorCall,null,{_beginDlgOkCall:!0})},n,i),void 0!==c.endCall&&c.endCall&&c.endCall.call(d)):d.errorCallback({errcode:"11103"},c.errorCall)},e))return}};W.options.showNoPW||void 0===W.options.showSealsDlg?this.showSealsDialog(o):(e=!0,"auto"==W.options.showSealsDlg&&(t=d.keyData).seals&&1==t.seals.length&&(e=!1),d.autoDlg=e,!1!==W.options.showSealsDlg&&e?this.showSealsDialog(o):(void 0===W.options.password&&void 0!==d.password&&(W.options.password=d.password),e=W._getCookie("pwd"),e=e=W.options.pw_enc_save&&null!==e?z.Base64.of().decode(W._getCookie("pwd")):e,!1!==W.options.remberPwdAndShowSealsDlg&&e?W.options.password=e:W.options.showSealsDlg&&(W.options.showSealsDlg=!0),void 0===W.options.password?d.errorCallback({errcode:"11108"},c.errorCall):(n=d.getSignTimeStamp(d.getProtectedData(c.protectedItems)),null!=W.options.timestamp&&1==W.options.timestamp?"client"==W.options.sealType?(i=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode)).invoke("KGGetTSURLInfo").ret(function(e){e.result?i.invoke("KGGetTSWithDigest",e.TimeStampUrl,e.TimeStampUserName,e.TimeStampPassword,n,"").ret(function(e){e.result?o._onOk.call(d,d.keyData.seals[0],W.options.password,0,e.TimeStr,e):(d.errorCallback(e,c.errorCall,"KGGetTSWithDigest"),o._onOk.call(d,t.seals[0],pwdVal,0))}):(d.errorCallback(e,c.errorCall,"KGGetTSURLInfo"),o._onOk.call(d,t.seals[0],pwdVal,0))}):(e=W.options.serverUrl+"_key_getTimeStamp",R.ajax({url:e,type:"POST",data:{keysn:d.keyData.keysn,signTimeStamp:n},async:!1,success:function(e){e.result?o._onOk.call(d,d.keyData.seals[0],W.options.password,0,e.timestamp):o._onOk.call(d,d.keyData.seals[0],W.options.password,0)},error:function(e){o._onOk.call(d,d.keyData.seals[0],W.options.password,0)}})):o._onOk.call(d,d.keyData.seals[0],W.options.password,0))))},showSealsDialog:function(u){for(var e,f=this,p=f.keyData,h=(null!=f.signdate&&(p.signDateIsCheck=f.signdate.ischeck),p.noPassWord=-1!=["scanStamp"].indexOf(p.stampType)),t=(p.isMobile=W.options.isMobile,p.showRememberPwd=W.options.showRememberPwd,e=null!=u.protectedItemsType&&"1"==u.protectedItemsType?u.protectedItems:f.getProtectedData(u.protectedItems),p.showProtectedBtn=e&&0<e.length&&W.options.showProtectedBtn,p.verification=f.verification,u.protectedItemsCheckedAll),n=new Array,i=0;e&&i<e.length;i++)n[i]=e[i],n[i].isChecked=t;null!=f.thirdConfig&&(p.thirdConfig=f.thirdConfig),p.newProItems=n,p.Global=W.options.Global;var o,a,s=[p],m=u._onOk,r=u.beginCancalCall,c=null,l={onCancel:function(){c&&c.blur(),u.cancelCall()},onShow:function(){var t,n=this,e=(n.find("#kg-remenberPwd").click(function(e){e.currentTarget.checked?n.find("#rememberPwdAndNotShowSealTpl-container")[0].className="kg-visible":n.find("#rememberPwdAndNotShowSealTpl-container")[0].className="kg-hide"}),W.editThemeColor(),"scanStamp"==p.stampType&&W.scanCallBack(),n.find(".kg-switcher")),a=(e.length&&(t=new z.Switcher(e[0],{}),e.find(".arrow-right").click(function(e){e.preventDefault(),t.swipeNext()}),e.find(".arrow-left").click(function(e){e.preventDefault(),t.swipePrev()}),e.find(".kg-guide span").click(function(e){e.preventDefault(),t.to(+this.getAttribute("index"))}),f.switcher=t),n.find("#kg-dateSet").click(function(e){f.showFontDialog(n)}),n.find("#kg-fontSet").click(function(e){f.showPostilFontDialog(n)}),null!=f.thirdConfig&&(null!=f.thirdConfig.commonlang&&n.find("#i-kg-common-lang").change(function(e){var t=this.options[this.selectedIndex].innerHTML;n.find("#kg-postil-value").val(t)}),null!=f.thirdConfig.fontEditCall&&n.find(".kg-fontSet-edit").click(function(){f.thirdConfig.fontEditCall(f.thirdConfig)}),f.thirdConfig.postilFontSet&&(e=n.find("#kg-postil-value"),f.thirdConfig.postilFontSet.fontFamily&&e.css({fontFamily:f.thirdConfig.postilFontSet.fontFamily}),f.thirdConfig.postilFontSet.fontSize&&e.css({fontSize:f.thirdConfig.postilFontSet.fontSize}),f.thirdConfig.postilFontSet.fontColor&&e.css({color:f.thirdConfig.postilFontSet.fontColor}))),c=W.options.verification?R("#kg-verification"):R("#kg-password"),W.repairInputEvent(c),f),s=W.options.keysn,r=f.keyData.phone,l=n.find(".kg-tipText");l.html(r),l.click(function(){l.hide(),n.find("#kg-verification").focus()}),n.find("#kg-verification").click(function(){l.hide(),n.find("#kg-verification").focus()}),n.find(".kg-verificationButton").click(function(e){C.showLoading();var i=R(this),o=n.find(".kg-verificationMark");a.sealService.applySMSCode({keysn:s,successCall:function(e){var t,n;e.result?(clearInterval(n),C.hideLoading(),l.css({display:"block"}).html(R.kgi18n.prop("sentSMSCode")),o.css({display:"block"}),t=60,n=setInterval(function(){0<=t?(t<10&&(t="0"+t),i.html(t+"秒"),t--):(i.html("验证码"),o.css({display:"none"}),l.html(r),clearInterval(n))},1e3)):f.errorCallback(e.massage,u.errorCall)}})}),f.trigger("showSealsDialog",n),W.options.showNoPW&&W.options.phoneshield||f.trigger("showSealsDialog_PW",n),!W.options.showNoPW&&n.find("#kg-remenberPwd")[0].checked&&(n.find("#rememberPwdAndNotShowSealTpl-container")[0].className="kg-visible"),n.find("#kg-password").keydown(function(e){13==e.keyCode&&n.options.onOk.call(n)}),n.find("#kg-verification").keydown(function(e){13==e.keyCode&&n.options.onOk.call(n)}),n.find("#kg-protectedDataSet").click(function(e){f.showProtectedDataDialog(n,u,p)}),W.options.showNoPW||n.find("#kg-remenberPwd")[0].checked||n.find("#kg-password").val()||(W.options.password=null)},onOk:function(){var n=this,e=n.find("#kg-password"),i=e.val()||W.options.password,t=n.find("#kg-verification").val(),o=n.find(".kg-wrapper .active"),a=(n.isCheck=n.find("#kg-addDate").is(":checked"),n.find("#kg-remenberPwd").is(":checked")),s=n.find("#kg-postil-value").val();if(f.postilFontSet=null==f.postilFontSet?{}:f.postilFontSet,f.postilFontSet.fontValue=s,n.find("#kg-rememberPwdAndNotShowSealTpl").is(":checked")?W.options.rememberPwdAndNotShowSealTpl=!0:W.options.rememberPwdAndNotShowSealTpl=!1,W.options.verification){if(!t)return C.alert(y.msg("in_verification_msg","KG_MSG"),function(){setTimeout(function(){e.focus()},100)}),!1;i=t}else if(!W.options.phoneshield&&!h&&!i)return C.alert(y.msg("in_input_msg","KG_MSG"),function(){setTimeout(function(){e.focus()},100)}),!1;!a&&W._getCookie("ck")&&f.trigger("deletePWD");var r,l,s=f.keyData.seals[o.attr("index")].SealTag||f.keyData.seals[o.attr("index")].sealtag;if("client"==W.options.sealType&&s&&"GM"==s){var c=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode),t=f.keyData.seals[o.attr("index")].SealCert||f.keyData.seals[o.attr("index")].signercert,s=f.keyData.seals[o.attr("index")].ValidStart||f.keyData.seals[o.attr("index")].validstart,d=f.keyData.seals[o.attr("index")].ValidEnd||f.keyData.seals[o.attr("index")].validend,g=f.keyData.seals[o.attr("index")].CertList||f.keyData.seals[o.attr("index")].certlist;c.invoke("KGValidate_GM","",t,s,d,g,"").ret(function(e){if(!e.result)return f.errorCallback(e,u.errorCall,"KGValidate_GM"),!1;var t;null!=W.options.timestamp&&1==W.options.timestamp?(t=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode)).invoke("KGGetTSURLInfo").ret(function(e){e.result?t.invoke("KGGetTSWithDigest",e.TimeStampUrl,e.TimeStampUserName,e.TimeStampPassword,f.getSignTimeStamp(f.getProtectedData(u.protectedItems)),"").ret(function(e){e.result?m.call(n,p.seals[o.attr("index")],i,o.attr("index"),e.TimeStr,e,!!a):(f.errorCallback(e,u.errorCall,"KGGetTSWithDigest"),m.call(n,p.seals[o.attr("index")],i,o.attr("index"),void 0,void 0,!!a))}):f.errorCallback(e,u.errorCall,"KGGetTSWithDigest")}):m.call(n,p.seals[o.attr("index")],i,o.attr("index"),void 0,void 0,!!a)})}else{if("client"!=W.options.sealType||!f.keyData.seals[o.attr("index")].sealtag||"GB"!=f.keyData.seals[o.attr("index")].sealtag)return o=n.find(".kg-wrapper .active"),n.isCheck=n.find("#kg-addDate").is(":checked"),l=f.getSignTimeStamp(f.getProtectedData(u.protectedItems)),null!=W.options.timestamp&&1==W.options.timestamp?"client"==W.options.sealType?(c=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode)).invoke("KGGetTSURLInfo").ret(function(e){e.result?c.invoke("KGGetTSWithDigest",e.TimeStampUrl,e.TimeStampUserName,e.TimeStampPassword,l,"").ret(function(e){e.result?m.call(n,p.seals[o.attr("index")],i,o.attr("index"),e.TimeStr,e):(f.errorCallback(e,u.errorCall,"KGGetTSWithDigest"),m.call(n,p.seals[o.attr("index")],i,o.attr("index")))}):f.errorCallback(e,u.errorCall,"KGGetTSURLInfo")}):(t=W.options.serverUrl+"_key_getTimeStamp",R.ajax({url:t,type:"POST",data:{keysn:f.keyData.keysn,signTimeStamp:l},async:!1,success:function(e){var t;e.result?e.TimeStampResponse?(t=z.eosFormatTime(e.TimeStr),m.call(n,p.seals[o.attr("index")],i,o.attr("index"),t,e)):m.call(n,p.seals[o.attr("index")],i,o.attr("index"),e.timestamp):m.call(n,p.seals[o.attr("index")],i,o.attr("index"))},error:function(e){m.call(n,p.seals[o.attr("index")],i,o.attr("index"))}})):m.call(n,p.seals[o.attr("index")],i,o.attr("index")),!1;c=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode),s=(r=f.keyData.seals[o.attr("index")]).sesealinfo,c.invoke("KGVerifyGBSealAction",s,r.signsn).ret(function(e){if(!e.result)return f.errorCallback(e,u.errorCall,"KGVerifyGBSealAction"),!1;f.keyData.gbOvalue=e.ovalue,m.call(n,r,i,o.attr("index"),void 0,void 0,!!a)})}},content:function(){s.push(f.toBase64Img);var e=[W.options.template.showSealsBtl].concat(s);return(W.options.showNoPW||W.options.phoneshield)&&(e=[W.options.template.showSealsBtl_nopassword].concat(s)),z.template.apply(null,e)}};void 0!==r&&r&&(l=z.extend({onCancel:function(){void 0!==r&&r&&r.call(f),this.close()}},l)),W.options.showNoPW||W.options.phoneshield?f.showDialog("showSealsBtl_nopassword",l):W._sealsDlg=f.showDialog("showSealsBtl",l),W.options.showSignExpirePrompt&&null!=p.currenttime&&null!=p.currenttime&&null!=p.overdate&&null!=p.overdate&&(l=new Date(p.currenttime),o=new Date(p.overdate),(o=Math.floor((o.getTime()-l.getTime())/864e5))<=p.hintdays&&0<=o&&(localStorage.getItem("lastAlertDate")&&null!=localStorage.getItem("lastAlertDate")&&""!=localStorage.getItem("lastAlertDate")?(a=localStorage.getItem("lastAlertDate"),a=new Date(a),0<l.getTime()-a.getTime()&&f.showExpirtDialog("当前用户还有"+o+"天过期，请及时更新！",p.currenttime)):f.showExpirtDialog("当前用户还有"+o+"天过期，请及时更新！",p.currenttime)))},showProtectedDataDialog:function(i,o,a){var t="protectedDataSetBtl",n=[{newProData:a.newProItems,proItemsCheckedAll:o.protectedItemsCheckedAll}],e={title:y.msg("ProtectedDataSet","KG_TITLE"),content:function(){n.push(z.html2Escape);var e=[W.options.template[t]].concat(n);return z.template.apply(null,e)},onShow:function(){W.editThemeColor()},onOk:function(){for(var n=a.newProItems.length;n--;)s.find("input[name='kg-proItem']").each(function(e,t){if(this.checked&&R(this).val()==a.newProItems[n].field)return!(a.newProItems[n].isChecked=!0);a.newProItems[n].isChecked=!1});var e=new Array;if(null!=o.protectedItemsType&&"1"==o.protectedItemsType)for(var t=0;t<a.newProItems.length;t++)a.newProItems[t].isChecked&&e.push(a.newProItems[t]);else for(t=0;t<a.newProItems.length;t++)a.newProItems[t].isChecked&&e.push(a.newProItems[t].field);i.proItems=e}},s=C.showDialog(t,e);return s.find("#kg-proData-items").on("click",function(e){if("LABEL"==e.target.tagName&&s.find("#kg-selectedProData").text(R(e.target).text().split("]")[1]),"checkbox"==e.target.type)if(R(e.target).is(":checked")){for(var t=!0,n=s.find("input[name='kg-proItem']"),i=0;i<n.length;i++)if(!n[i].checked){t=!1;break}t&&(s.find("input[name='selectAll']")[0].checked=!0,o.protectedItemsCheckedAll=!0)}else s.find("input[name='selectAll']")[0].checked=!1,o.protectedItemsCheckedAll=!1}),s.find("#kg-selectBox").on("click",function(e){if(R(e.target).is(":checked")){o.protectedItemsCheckedAll=!0;for(var t=s.find("input[name='kg-proItem']"),n=0;n<t.length;n++)t[n].checked=!0,a.newProItems[n].isChecked=!0}else{o.protectedItemsCheckedAll=!1;for(t=s.find("input[name='kg-proItem']"),n=0;n<t.length;n++)t[n].checked=!1,a.newProItems[n].isChecked=!1}}),s},showPostilFontDialog:function(e){C.dafaultDate;var t=null==this.thirdConfig||null==this.thirdConfig.postilFontSet?{}:this.thirdConfig.postilFontSet,n=C.defaultFont,i="fontSetBtl",o=(null==t.fontFamily?n:t).fontFamily,a=(null==t.fontSize?n:t).fontSize,n=n.fontColor,s=(null!=t.fontColor&&/^#([0-9a-fA-f]{6})$/.test(t.fontColor)&&(n=t.fontColor.toUpperCase()),null!=e.postilFontSet&&(o=e.postilFontSet.fontFamily,a=e.postilFontSet.fontSize,n=e.postilFontSet.fontColor),[{fontFamily:this.getArrayPush(W.options.fontTemplate.fontFamily,o),fontSize:this.getArrayPush(W.options.fontTemplate.fontSize,a),fontColor:this.getArrayPush(W.options.fontTemplate.fontColor,n),dFontFamily:o,dFontSize:a,dFontColor:n}]),t={title:R.kgi18n.prop("FontSetting"),content:function(){var e=[W.options.template[i]].concat(s);return z.template.apply(null,e)},onShow:function(){W.editThemeColor()},onOk:function(){e.postilFontSet={fontFamily:this.find("#kg-fontFamily").val(),fontSize:this.find("#kg-fontSize").val(),fontColor:y.Utils.colorHex(this.find("#kg-select-color").css("backgroundColor"))},e.find("#kg-postil-value").css("font-family",e.postilFontSet.fontFamily),e.find("#kg-postil-value").css("font-size",e.postilFontSet.fontSize+"px"),e.find("#kg-postil-value").css("color",e.postilFontSet.fontColor)}},r=C.showDialog(i,t);return r.find("#kg-select-color").on("click",function(){r.find(".kg-color-div").css("display","block"),r.find("#kg-color-ul").css("display","block")}),r.find("#kg-color-ul li a").click(function(){R("#kg-select-color").css("backgroundColor",R(this).css("backgroundColor")),r.find(".kg-color-div").css("display","none"),r.find("#kg-color-ul").css("display","none")}),r.find(".kg-color-div").on("mouseover",function(e){e=e.fromElement||e.relatedTarget;this.contains(e)||R(this).show()}),r.find(".kg-color-div").on("mouseout",function(e){e=e.toElement||e.relatedTarget;this.contains(e)||R(this).hide()}),r},showFontDialog:function(n){var e=this,t=C.dafaultDate,i=null==e.signdate?{}:e.signdate,o=C.defaultFont,e=this,a="dateSetBtl",e=(null==i.fontFormat?o:i).fontFormat,s=(null==i.fontFamily?o:i).fontFamily,r=(null==i.fontSize?o:i).fontSize,l=o.fontColor,o=(null!=i.fontColor&&/^#([0-9a-fA-f]{6})$/.test(i.fontColor)&&(l=i.fontColor.toUpperCase()),(null==i.position?o:i).position),c=(null!=n.fontSel&&(e=n.fontSel.fontFormat,s=n.fontSel.fontFamily,r=n.fontSel.fontSize,l=n.fontSel.fontColor,o=C.fontTemplate.position[n.fontSel.fontPositionIndex]),this.getArrayPush(W.options.fontTemplate.fontFormat,e)),d=[{fontFormat:this.getFormatDate(c,t),fontFamily:this.getArrayPush(W.options.fontTemplate.fontFamily,s),fontSize:this.getArrayPush(W.options.fontTemplate.fontSize,r),fontColor:this.getArrayPush(W.options.fontTemplate.fontColor,l),fontPosition:W.options.fontTemplate.position,dFontFormat:y.Utils.formatDate(new Date(t),e),dFontFamily:s,dFontSize:r,dFontColor:l,dFontPosition:o}],i={title:y.msg("DateSet","KG_TITLE"),content:function(){var e=[W.options.template[a]].concat(d);return z.template.apply(null,e)},onShow:function(){W.editThemeColor()},onOk:function(){var e=this,t=e.find("#kg-fontFormat").get(0).selectedIndex;n.fontSel={fontFormat:c[t],fontFamily:e.find("#kg-fontFamily").val(),fontSize:e.find("#kg-fontSize").val(),fontColor:y.Utils.colorHex(e.find("#kg-select-color").css("backgroundColor")),fontPositionIndex:e.find("#kg-fontPosition").get(0).selectedIndex}}},g=C.showDialog(a,i);return g.find("#kg-select-color").on("click",function(){"block"==g.find(".kg-color-div").css("display")?(g.find(".kg-color-div").css("display","none"),g.find("#kg-color-ul").css("display","none")):(g.find(".kg-color-div").css("display","block"),g.find("#kg-color-ul").css("display","block"))}),g.find("#kg-color-ul li a").click(function(e){e.stopPropagation(),g.find("#kg-select-color").css("backgroundColor",R(this).css("backgroundColor")),g.find("#kg-select-color").css("borderColor",R(this).css("backgroundColor")),g.find(".kg-color-div").css("display","none"),g.find("#kg-color-ul").css("display","none")}),g.find(".kg-color-div").on("mouseover",function(e){e=e.fromElement||e.relatedTarget;this.contains(e)||R(this).show()}),g.find(".kg-color-div").on("mouseout",function(e){e=e.toElement||e.relatedTarget;this.contains(e)||R(this).hide()}),g},getArrayPush:function(e,t){return-1==jQuery.inArray(t,e)&&e.push(t),e},getFormatDate:function(e,t){for(var n=new Array,i=0;i<e.length;i++)n[i]=y.Utils.formatDate(new Date(t),e[i]);return n},genId:function(){return(new Date).getTime()+function(){var e=""+Math.ceil(99999*((9301*(new Date).getTime()+49297)%233280/233280)),t=5-e.length;if(0<t)for(var n=0;n<t;n++)e="0"+e;return e}()},getSeal:function(e){return this.keyData.seals[e]},saveSignature:function(e,t,n,i){var o,a,s=this;null!=e&&null!=t&&null!=n&&(a=W.options.clientCode||"",o=W.options.keysn,a=null!=W.options.cache_path&&null!=W.options.cache_path?{clientCode:a,keysn:o,documentId:e,signatureId:t,signaturedata:n,cachepath:W.options.cache_path}:{clientCode:a,keysn:o,documentId:e,signatureId:t,signaturedata:n,cachepath:""},y.surry(W.options.serverUrl).request("_signature_saveHtmlSignature",a).ret(function(e){null!=i&&i.call(s,e)}))},removeSignature:function(e,t,n){var i=this;null!=e&&null!=t&&(e={documentId:e,signatureId:t},y.surry(W.options.serverUrl).request("_signature_reomveHtmlSignature",e).ret(function(e){null!=n&&n.call(i,e)}))},getSaveSignatures:function(e,t,n){null!=e&&y.surry(W.options.serverUrl).request("_signature_getHtmlSignature",{documentId:e}).ret(function(e){W._verfiyInfotoServer=e.verfiyInfotoServer,e.result?t(e.sign):n&&n(e.result)})},showExpirtDialog:function(e,t){C.showDialog("showExpirtDialog",{content:'<div class="kg-dialog kg-dialog-runSignature" id="sealExpirt-dialog"><div class="kg-dialog-content">'+e+'</div><div ><input type="checkbox" name="noMorePrompts" id="kg-noMorePrompts">&nbsp;<label for="kg-noMorePrompts">不再提示</label></div> </div>',onOk:function(){this.find("#kg-noMorePrompts").is(":checked")&&localStorage.setItem("lastAlertDate",t)},onCancel:function(){}})},getRPW:function(e){if(this.ongetRPW)return this.ongetRPW(e)}}),R.extend(W.options,{certType:"client",sealType:"client",clientUrl:"http://127.0.0.1:9581",moveable:!0,signable:!0,fontTemplate:C.fontTemplate,template:{showSealsBtl:C.template.sealTpl,showSealsBtl_nopassword:C.template.sealTpl_noInput,signSignatureBtl:'<div id="kg-dialog-sign" class="kg-dialog kg-dialog-password kg-dialog-sign"><div class="kg-form"><div class="form-item clearfix"><% if(this.verification){%><label class="kg-sm kg-sm-3 kg-label" data-kgi18n-html="VerifyCode">验证码</label><div class="kg-sm kg-sm-7" style="position:relative"> <input type="password" style="text-indent:10px" name="kgpassword" autocomplete="new-password" id="kg-revokeVerifyCode" class="form-control"><span class="kg-verificationButton kg-revokeBtn kg-second-btn-red" style="width:70px;font-size:12px" title="获取短信验证码" data-kgi18n-title="SMSCodeTip" data-kgi18n-html="VerifyCode">验证码</span><span class="kg-tip" style="right:70px"></span><span class="kg-tipText"></span><span class="kg-verificationMark kg-revokeMark"/></div><%}else{%><label class="kg-sm kg-sm-3 kg-label" data-kgi18n-html="PassWord">密码</label><div class="kg-sm kg-sm-7"> <input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div><%}%> </div></div></div>',protectedDataSetBtl:'<div id="kg-setProData" class="kg-dialog "><div id="kg-pro-data" class="kg-sm-13 kg-dialog-proData "><% var newProData = this.newProData; %><% var isAllChecked = this.proItemsCheckedAll; %><div id="kg-proData-items" class="kg-dialog-proData-items"><% for(var i=0;i<newProData.length;i++){%><div class="kg-dialog-proData-item"><% var proId = "proItem"+i; %><% var filedd = newProData[i].desc && newProData[i].desc != "" ? newProData[i].desc : newProData[i].field; %><% var content = "[" + filedd+"]" + arguments[0](newProData[i].value); %><% if(newProData[i].isChecked){ %><input type="checkbox" checked name="kg-proItem" id="<% proId%>" value="<% newProData[i].field%>" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label" custom="pro-value"><% content%></label>&nbsp;<% } %><% else{ isAllChecked = false; %><input type="checkbox" name="kg-proItem" id="<% proId%>" value="<% newProData[i].field%>" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label"  custom="pro-value"><% content%></label>&nbsp;<% } %></div><%}%></div><div class="kg-dialog-line"></div><div class="kg-dialog-proData-selProData"><label id="kg-selectedProData" class="kg-selProData"></label></div></div><div ><% if(isAllChecked){ %><input type="checkbox" checked  name="selectAll" id="kg-selectBox"  class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>" >&nbsp;<label class="kg-dialog-label" for="kg-selectBox" custom="pro-value" data-kgi18n-html="SelectAll">全部选中</label>&nbsp;<% } else{ %><input type="checkbox"  name="selectAll" id="kg-selectBox" class="<%this.isMobile?"kg-dialog-checkbox ":"kg-primary-check-red kg-dialog-checkbox "%>">&nbsp;<label class="kg-dialog-label" for="kg-selectBox" custom="pro-value" data-kgi18n-html="SelectAll">全部选中</label>&nbsp;<% } %></div></div>',dateSetBtl:'<div id="kg-setDate" class="kg-dialog kg-dialog-Date"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Format">格式</label><div class="kg-sm kg-sm-6"><select name="fontFormat" id="kg-fontFormat" class="kg-select kg-fontFormat"><% var fontFormat = this.fontFormat; %><% for(var i=0;i<fontFormat.length;i++) {%><% if(fontFormat[i] == this.dFontFormat){%><option class="kg-option" value="<% fontFormat[i]%>" selected><% fontFormat[i]%></option><%}else{%><option class="kg-option" value="<% fontFormat[i]%>"><% fontFormat[i]%></option><%}%><%}%></select></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Font">字体</label><div class="kg-sm kg-sm-6"><select name="fontFamily" id="kg-fontFamily" class="kg-select kg-fontFamily"><% var fontFamily = this.fontFamily; %><% for(var i=0;i<fontFamily.length;i++) {%><% if(fontFamily[i] == this.dFontFamily){%><option class="kg-option" value="<% fontFamily[i]%>" selected><% fontFamily[i]%></option><%}else{%><option class="kg-option" value="<% fontFamily[i]%>"><% fontFamily[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Size">尺寸</label><div class="kg-sm kg-sm-6"><select name="fontSize" id="kg-fontSize" class="kg-select kg-fontSize"><% var fontSize = this.fontSize; %><% for(var i=0;i<fontSize.length;i++) {%><% if(fontSize[i] == this.dFontSize){%><option class="kg-option" value="<% fontSize[i]%>" selected><% fontSize[i]%></option><%}else{%><option class="kg-option" value="<% fontSize[i]%>"><% fontSize[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Color">颜色</label><div class="kg-sm kg-sm-6"><% var fontColor = this.fontColor; %><div id="kg-select-color" class="kg-select-color" style="background-color:<% this.dFontColor%>"/><div class="kg-color-div"><ul class="kg-color-ul" id="kg-color-ul"><% for(var i=0;i<fontColor.length;i++){ %><li class="kg-color-li"><a href="javascript:;" style="background-color:<% fontColor[i]%>"></a></li><%}%></ul></div></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label kg-indent" data-kgi18n-html="Location">位置</label><div class="kg-sm kg-sm-6"><select name="fontPosition" id="kg-fontPosition" class="kg-select kg-fontPosition"><% var fontPosition = this.fontPosition; %><% for(var i=0;i<fontPosition.length;i++) {%><% if(fontPosition[i] == this.dFontPosition){%><option class="kg-option" value="<% fontPosition[i]%>" selected ><% fontPosition[i]%></option><%}else{%><option class="kg-option" value="<% fontPosition[i]%>"><% fontPosition[i]%></option><%}%><%}%></select></div> </div></div></div></div>',fontSetBtl:'<div id="kg-setFont" class="kg-dialog kg-dialog-font"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label indent" data-kgi18n-html="Font">字体：</label><div class="kg-sm kg-sm-6"><select name="fontFamily" id="kg-fontFamily" class="kg-select kg-fontFamily"><% var fontFamily = this.fontFamily; %><% for(var i=0;i<fontFamily.length;i++) {%><% if(fontFamily[i] == this.dFontFamily){%><option class="kg-option" value="<% fontFamily[i]%>" selected><% fontFamily[i]%></option><%}else{%><option class="kg-option" value="<% fontFamily[i]%>"><% fontFamily[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label indent" data-kgi18n-html="Size">尺寸：</label><div class="kg-sm kg-sm-6"><select name="fontSize" id="kg-fontSize" class="kg-select kg-fontSize"><% var fontSize = this.fontSize; %><% for(var i=0;i<fontSize.length;i++) {%><% if(fontSize[i] == this.dFontSize){%><option class="kg-option" value="<% fontSize[i]%>" selected><% fontSize[i]%></option><%}else{%><option class="kg-option" value="<% fontSize[i]%>"><% fontSize[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label indent" data-kgi18n-html="Color">颜色：</label><div class="kg-sm kg-sm-6"><% var fontColor = this.fontColor; %><div id="kg-select-color" class="kg-select-color" style="background-color:<% this.dFontColor%>"/><div class="kg-color-div"><ul class="kg-color-ul" id="kg-color-ul"><% for(var i=0;i<fontColor.length;i++){ %><li class="kg-color-li"><a href="javascript:;" style="background-color:<% fontColor[i]%>"></a></li><%}%></ul></div></div></div></div></div>'}}),W.list={},W.updateList=[],W.removeList=[],W.loadSignature=function(e,t,n,i){var o={};null==W.options.extra&&(W.options.extra={}),o[e]=t,void 0!==o.extra&&null!==o.extra&&(W.options.extra[o.signatureid]=o.extra),w(o,n||function(e){W.verify()},i)},W.loadSignatures=function(e,t,n){var i={};if(null==W.options.extra&&(W.options.extra={}),z.is("Array",e))for(var o=0;o<e.length;o++){var a=e[o];i[a.signatureid]=a.signatureData,void 0!==a.extra&&null!==a.extra&&(W.options.extra[a.signatureid]=a.extra)}else for(var s in e){var r=e[s];i[s]=r}w(i,t||function(){W.verify()},n)},W.resetSignaturePos=function(e){if(null==W.options.extra&&(W.options.extra={}),z.is("Array",e))for(var t=0;t<e.length;t++){var n=e[t];void 0!==n.extra&&null!==n.extra&&(W.options.extra[n.signatureid]=n.extra)}else for(var i in e){var o=e[i];W.options.extra[i]=o}},W.clearRPW=function(){var e=W.create();e.onDeleteRPW&&e.onDeleteRPW()};function b(e){var n=this;R.each(e,function(e,t){"function"==typeof n[e]?n[e](t):n[e]=t})}function D(e){var n=this;R.each(e,function(e,t){"function"==typeof n[e]?n[e](t):n[e]=t})}function I(e,t){var n=this;n.sData=t,R.each(e,function(e,t){"function"==typeof n[e]?n[e](t):n[e]=t})}var _=new p("Signature"),T=(W.addLiseter=function(e,t){_.on(e,t)},W.verify=function(){var e,t=W.list,n=[];for(e in _.trigger("beforeVerify",void 0),t){var i=t[e];i._verify(null,{batchVerify:!0})||n.push(i),_.trigger("eachVerify",i)}return _.trigger("verify",i),n},W._aesEncrypt=function(e){return CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),CryptoJS.enc.Utf8.parse("AaBbCcDdEeFfGgH1"),{iv:CryptoJS.enc.Utf8.parse("#$~%kinggrid%~$#"),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).ciphertext.toString()},W._getCookie=function(e){for(var t=(window!=top?window:window.top).document.getElementsByTagName("head")[0],n=t.getElementsByTagName("script"),i=!0,o=0;o<n.length;o++)0<n[o].src.indexOf("password.webview")&&(i=!1);if(!i)return(t=window.localStorage).getItem(a=e+"_expires")<=new Date?(t.removeItem(e),t.removeItem(a),null):t.getItem(e);var a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(a))?unescape(t[2]):null},W._showAndHideSealsDlg=function(e){W.options.defaultPassword?(W.options.showSealsDlg=!1,W.options.password=W.options.defaultPassword):void 0!==W.options.showSealsDlg&&(W._getCookie("pwd")&&W._getCookie("SST")&&!W.options.remberPwdAndShowSealsDlg?W.options.showSealsDlg=!1:W.options.showSealsDlg=!0)},W.verifySignByList=function(e){var t,n=[];for(t in _.trigger("beforeVerify",void 0),e){var i=e[t],o=i._verify(null,{batchVerify:!0}),a=i.signatureData,s=new Object;s.appname=W.options.version,s.documentid=a.documentid,s.documentname=a.documentname,s.keysn=a.keysn,s.orgname=a.orgname,s.timestamp=a.timestamp,s.usercode=a.usercode,s.username=a.username,s.signname=a.seal.signname,s.signsn=a.seal.signsn,o||(s.modifiedItems=i.modifiedItems),n.push(s),_.trigger("eachVerify",i)}return _.trigger("verify",i),n},W.bind=function(e){z.extend(W.asyn,e)},W.loadProperties=function(){jQuery.kgi18n.properties({name:"language",path:W.options.languagesPath+"/lang/",mode:"map",language:W.options.LANGUAGE||jQuery.kgi18n.normaliseLanguageCode({}),cache:!1,encoding:"UTF-8",callback:function(){for(var e in y.errCode)if(z.is("Object",y.errCode[e]))for(var t in y.errCode[e])y.errCode[e][t]=R.kgi18n.prop(e+t);else y.errCode[e]=R.kgi18n.prop("errCode"+e);for(var e in C.fontTemplate.position)C.fontTemplate.position[e]=R.kgi18n.prop("position"+e);C.dialogConfig.okValue=R.kgi18n.prop("Confirm"),C.dialogConfig.cancelValue=R.kgi18n.prop("Close"),C.defaultFont.position=R.kgi18n.prop("position0");for(var n=R(".kgImgIcons").find(".kg-img-icon"),i=0;i<n.length;i++){var o=R(n[i]).attr("id"),a=o.indexOf("-","kg-img-icon".length)+1,s=o.indexOf("-",a),o=o.substring(a,s);R(n[i]).attr("title",R.kgi18n.prop("Title"+o))}}})},W.dynamicLoadCss=function(e){for(var t=document.getElementsByTagName("head")[0],n=(t=u.iframeDialog?window.top.document.getElementsByTagName("head")[0]:t).getElementsByTagName("link"),i=0;i<n.length;i++)0<n[i].href.indexOf("/languages/")&&t.removeChild(n[i]);var o=document.createElement("link");o.type="text/css",o.rel="stylesheet",o.href=e,t.appendChild(o)},W.show=function(){var e,t=W.list;for(e in t)t[e].show()},W.hide=function(){var e,t=W.list;for(e in t)t[e].hide()},W.isIE=!!(window.ActiveXObject||"ActiveXObject"in window),W.setRequestHeader=function(e){if(!this.options.clientConfig){var t,n=this.options.RequestHeaderList;for(t in n)e.setRequestHeader(t,n[t])}},W.getAuthCode=function(t,n){window.OnecodeJSBridge?window.OnecodeJSBridge.call("getAuthCode",{},function(e){e.status?t(e.authCode):n(e.errorMsg)}):n("OnecodeJSBridge初始化失败, 请在码上办事小程序或者是APP中打开")},W.ScanStamp=function(M,s,r){var l,c,n,d,i,o,e,g,u,a,f,t,p,h,m,v,k,y,S,C=this,w="1",G="=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b=[];function D(){W.userToken&&(v=document.getElementById("kg-exitSessionContainer"),k=document.getElementById("kg-exitSessionClick"),v.style.display="flex",k.addEventListener("click",I))}function I(){C.sealService.exitSession(W.userToken,function(e){e.result&&(W.userToken=usetToken=null,O(),v=document.getElementById("kg-exitSessionContainer"),k=document.getElementById("kg-exitSessionClick"),v.style.display="none",k.removeEventListener("click",I),W._sealsDlg.close())})}function N(){h=document.getElementById("kg-companySelectContainer"),m=document.getElementById("kg-companySelect"),h.style.display="block",m.addEventListener("change",L),m.innerHTML="",f.forEach(function(e,t){var n=document.createElement("option");n.value=e.entityCode,n.innerText=e.entityName,m.appendChild(n)})}function L(e){T(e.target.value)}function _(){C.sealService.queryUserCompany(W.userToken,function(e){var t=e.data.data,n=e.data.code,e=e.data.message;0==n?(t=Array.prototype.slice.call(t.companys),(f=t).length||f.push({entityName:"授权印章",entityCode:1}),T(f[0].entityCode)):6===n?(W.userToken=null,P(c,r)):W.alert(e)})}function T(e){var t={userToken:W.userToken};0==e?t.category=3:(t.entityCode=e,t.category=r,"delete"==c&&""==t.category&&(t.category=3)),C.sealService.getUserSeals(t.userToken,t.category,t.entityCode,function(e){var t,n=[],i=e.data.data,o=e.data.code,a=e.data.message;0==o?(t=i.userInfo,i=i.seals,g=t.userId,u=t.userName,"stamp"==c&&(0<i.length?(n=i.map(function(e){e.imgdata=e.imageData,delete e.imageData;var t=1/(720/254);return e.height=z.pxConversionMm(Math.round(.15*e.height/t)),e.width=z.pxConversionMm(Math.round(.15*e.width/t)),e.version=4,"1"==w&&(e.scanId=d),e.imgext=".png",e}),e={qrCodeUserUid:g,username:u,stampType:"scanStamp",sealData:n},F(),s(e)):1<f.length?T(f[0].entityCode):(W.alert("该用户没有可用印章！"),F())),"delete"==c&&C.sealService.getSealauthority(d,l,W.userToken,function(e){e.result?(d=null,s(e)):(F(),W.alert(e.errmsg))})):6===o?(W.userToken=null,P(c,r)):W.alert(a)})}function x(t){C.sealService.getQrCodeToken(function(e){a=e.stampSystemUrl+"/qr";e=z.Base64.of(G).decode(e.requestParameters);n=decodeURIComponent(e.split("&")[0]),i=decodeURIComponent(e.split("&")[1]),p="?token="+n+"&checkCode="+i,t&&t()})}function P(e,t){S.classList.add("hide"),C.sealService.getQRCodeImage(e,t,function(e){e.result?(1==(w=e.session?e.session:w)&&(W.userToken=null,o=e.image,y.src="data:image/png;base64,"+o,d=e.qrcodeId,x(A)),2==w&&(W.userToken?(o="data:image/png;base64,"+e.image,y.src=o,1==t?(W.scanCallBack=D,T()):(W.scanCallBack=function(){N(),D()},_())):W.options.isMobile?new Promise(function(e,t){W.getAuthCode(e,t)}).then(function(e){C.sealService.establishSession(e,function(e){var t=e.data.data,n=(e.data.code,e.message);e.result?(W.userToken=t.token,(1==r?T:_)()):W.alert(n)})}):(W.scanCallBack=D,o="data:image/png;base64,"+e.image,y.src=o,d=e.qrcodeId,x(A)))):(S.classList.remove("hide"),d=null,C.errorCallback(e,W.options.errorCall))})}function A(){t=R.ajax({type:"get",url:a+"/user/get/"+d+p,timeout:75e3,success:function(e){var n,t,i;e?(n=e.data,t=e.code,e=e.message,0==t?(1==w&&(W.userToken=null,d=n.scanId,g=n.userInfo?n.userInfo.userId:void 0,u=n.userInfo?n.userInfo.userName:void 0,i=[],n.seals&&0<n.seals.length&&(i=n.seals.map(function(e){delete e.isGmSeal,delete e.isPersonal,e.imgdata=e.imageData,e.imgext=".png",e.qrcodeId=d,e.scanId=n.scanId,e.scanSealType=r,e.signname=e.sealName,e.sealData&&(e.sealTag="GM"),delete e.sealName,delete e.imageData;var t=1/(720/254);return e.height=z.pxConversionMm(Math.round(.15*e.height/t)),e.width=z.pxConversionMm(Math.round(.15*e.width/t)),e.version=4,e})),B({code:t,message:e,scanId:n.scanId,qrCodeUserUid:n.userInfo?n.userInfo.userId:void 0,qrCodeUserName:n.userInfo?n.userInfo.userName:void 0,seals:i,status:0==t})),2==w&&(W.userToken=n.userToken,(1==r?T:_)())):B({code:t,message:e})):S.classList.remove("hide")},error:function(){S.classList.remove("hide")}})}function B(e){1==e.status&&0==e.code?e.scanId&&e.qrCodeUserUid&&(e.scanId,g=e.qrCodeUserUid,u=e.qrCodeUserName,"stamp"==c&&(0<e.seals.length?(b=e.seals,F(),s({qrCodeUserUid:g,username:u,stampType:"scanStamp",sealData:b})):(F(),W.alert("该用户没有可用印章！"))),"delete"==c&&C.sealService.getSealauthority(d,l,W.userToken,function(e){e.result?(d=null,s(e)):(F(),W.alert(e.errmsg))})):801==e.code?setTimeout(function(){x(A)},3e3):802==e.code?S.classList.remove("hide"):803==e.code?F():W.alert(e.message)}function E(){t&&t.abort()}function F(){E(),e.close()}function U(){e.show()}function O(){b=[]}return e=M(),S=e.find("#kg-qrCodeImgForeground")[0],y=e.find("#kg-qrcodeImg")[0],e.find("#kg-qrCodeExpires")[0],e.find(".ui-dialog-close").click(E),U(),S.addEventListener("click",function(){P(c,r)}),{open:U,close:F,sealData:b,dialog:e,clearSealData:O,getQrCodeImageByStamp:function(){P(c="stamp",r)},getQrCodeImageByDelete:function(e){l=e,P(c="delete")}}},W.editThemeColor=function(e){if(W._color!=e)if(W._color=e||W._color,W.isIE)W._color&&n(["kg-primary-arrow-","kg-primary-btn-","kg-default-btn-","kg-second-btn-","kg-title-","kg-primary-check-"]);else{var t=W.options.themeColor[e];for(k in t)document.documentElement.style.setProperty("--"+k,t[k]);n(["kg-primary-check-"])}function n(e){for(var t="red"==W._color?"blue":"red",n=0;n<e.length;n++)for(var i=R("."+e[n]+t),o=0;o<i.length;o++)"red"==W._color?(R(i[o]).toggleClass(e[n]+"red"),R(i[o]).toggleClass(e[n]+"blue")):"blue"==W._color&&(R(i[o]).toggleClass(e[n]+"blue"),R(i[o]).toggleClass(e[n]+"red"))}},W.repairInputEvent=function(e){var t;/(iPhone|iPad|iPod|IOS)/i.test(navigator.userAgent)&&(t=R("body").width(),(e=R(e)).focus(function(){R("body").width("90%")}),e.blur(function(){setTimeout(function(){R("body").width(t)})}))},W._verfiyInfotoServer=!1,W.AXI=function(e,t,n){W.authcode=void 0;var i,o=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode);for(i in t){var a=t[i];""!==i&&""!==a?o.invoke(e,i,a):null!==i&&""!==i?o.invoke(e,i):o.invoke(e)}return o.ret(function(t){t.result&&(W.options.moveable_self?(W.options.fjrsIsphone&&o.invoke("SetParamByName","FJRSISPHONE",W.options.fjrsIsphone),o.invoke("KGGetKeyOtherInfo","0").ret(function(e){e.result&&(e=e.Res.substring(1,e.Res.length-1),W.options.keysn=e),null!=n&&n(t)})):null!=n&&n(t))}),o},W.showAndHideBySignatureId=function(e,t){var n,i=W.list;for(n in i)0<=n.indexOf(e)&&(t?i[n].show():i[n].hide())},W.addIcon=function(e){var t=W.options.icons||[];t.push(e),W.options.icons=t},W.create=function(e){var t=R.extend({},W.options,e);return void 0!==e&&void 0!==e.imgtag&&(W.options.imgtag=e.imgtag),void 0!==e&&void 0!==e.password&&(W.options.password=e.password),new W._create(t)},R.extend(W.prototype,{saveSignatures:function(){},getSignatures:function(){}}),z.inherit(b,W.SealService),z.inherit(D,W.CertService),R.extend(b.prototype,{saveLog:function(e){var t=[];z.is("Object",e)?t.push(e):t=e;e=d({MSG:t});W.options.savelogFlg&&y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode).invoke("SetParamByName","SAVEMSG",e)},loadSeal:function(c){var d=this,g=c.successCall,u=c.errorCall,e=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode);d.appcode?e.invoke("SetParamByName","APPCODE",d.appcode):d.appcode="",void 0!==W.options.imgtag&&e.invoke("SetParamByName","SIGNTYPE",W.options.imgtag),W.options.fjrsIsphone&&e.invoke("SetParamByName","FJRSISPHONE",W.options.fjrsIsphone),e.invoke("KGGetKeyInfo").ret(function(e){if(e.result){if(W.options.fjrsIsphone&&localStorage.setItem("fjrsToken",e.fjrs_token),W.options.phoneshield=!(!e.phoneshield||"1"!=e.phoneshield&&"3"!=e.phoneshield),W.options.phoneshield&&(y.options.timeout=1e3*(e.validatetime+10)),""==e.seals){if(null==c.data)return void u.call(d,{result:!1,errcode:"11"});e.seals={};var t={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"};e.seals[0]=t}else{if(W.options.signname||W.options.signindex){W.options.signname=z.is("Array",W.options.signname)?W.options.signname:[W.options.signname];for(var n=new Array,i=0;i<e.seals.length;i++){void 0!==(s=e.seals[i])&&i==W.options.signindex&&n.push(e.seals[i]);for(var o=0,a=W.options.signname.length;o<a;o++)void 0!==s&&s.signname==W.options.signname[o]&&e.seals[W.options.signindex]!=s&&n.push(e.seals[i])}0==n.length?(e.result=!1,e.errcode="11101"):e.seals=n}for(i=0;i<e.seals.length;i++){var s,r=(s=e.seals[i]).imgdata.substring(0,65),l=s.imgdata.substring(65);e.seals[i].imgdata=z.Base64.of().encodeByte(z.Base64.of(r).decodeByte(l))}}c.isHW&&!e.seals.length&&(e.seals[0]=t={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"},W.options._clientHW=!0),g.call(d,e)}else u.call(d,e)})},verifyPwd:function(e){var t=this,n=e.pwd,i=e.phoneshield?"1":"0",o=e.successCall,a=(null==n&&(n=""),y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode));a.invoke("SetParamByName","ISPHONE",i),a.invoke("SetParamByName","FJRSISPHONE",e.phoneshield||"0"),i&&a.invoke("SetParamByName","FJRSDELKEYSN",e.keysn),a.invoke("KGVerifyPin",n,e.keysn).ret(function(e){o.call(t,e)})},getKeysn:function(e,n){var t=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode),i=e&&e.key?e.key:"0",o=W.options.getKeysnCallBack;W.options.fjrsIsphone&&(t.invoke("SetParamByName","FJRSISPHONE",W.options.fjrsIsphone),t.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken"))),t.invoke("KGGetKeyOtherInfo",i).ret(function(e){if(e.result){var t;"0"==i?(t=e.Res.substring(1,e.Res.length-1),n(t)):n(e)}else{if(o)return o(e.result,e.errcode);C.alert(y.msg(e.errcode,"then"),function(){W.options.beginDlgOkCall&&W.options.beginDlgOkCall.call()},function(){W.options.beginDlgShowCall&&W.options.beginDlgShowCall.call()})}})},getPhoneShieldLic:function(e,t){var n=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode);e.phoneshield&&"0"!=e.phoneshield&&n.invoke("SetParamByName","FJRSISPHONE",e.phoneshield),n.invoke("KGPhoneShieldLic").ret(function(e){t(e)})},checkKeysn:function(t,n){this.sealService.getKeysn({},function(e){t.keysn==e?n({result:!0}):n({result:!1,errcode:"11114"})})},getRemoveAuthority:function(e,t,n){n(!0)}}),R.extend(D.prototype,{verifySign:function(n){var i=this,o=n.successCall,a=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode);n.seal&&n.seal.sealtag&&"GB"==n.seal.sealtag&&a.invoke("SetParamByName","GBSIGNSN",n.seal.signsn),W.options.fjrsIsphone&&a.invoke("SetParamByName","FJRSISPHONE",W.options.fjrsIsphone),a.invoke("SetParamByName","KEYSN",n.keysn),a.invoke("SetParamByName","SIGNSN",n.signsn),a.invoke("KGVerifySignMessage","123456",n.signdata,n.signeddata).ret(function(e){e.result||e.errcode;var t=e;t.result&&n.seal&&"GB"==n.seal.sealtag?a.invoke("KGVerifyGBStampAction",n.signeddata).ret(function(e){e.result||(t={result:!1}),o.call(i,t)}):o.call(i,t)}),n.seal&&n.seal.sealtag&&"GB"==n.seal.sealtag&&a.invoke("SetParamByName","GBSIGNSN","")},parseDate:function(e){var t=new Date;return t.setFullYear(e.substring(0,4),+e.substring(4,6)-1,e.substring(6,8)),t.setHours(e.substring(8,10),e.substring(10,12),e.substring(12,14),0),t.getTime()},sign:function(e){var t=this,n=e.successCall,i=e.signMeta,o=[],a=[],s=e.seal,r=e.phoneshield?"1":"0",l=e.password;null==l&&(l="");for(var c=0;c<i.length;c++){var d=i[c];o.push(d.signdata),a.push(""+d.signdata.length)}var g=y.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode);g.invoke("SetParamByName","ISPHONE",r),s&&s.sealtag&&("GB"==s.sealtag&&(r=s.sesealinfo,g.invoke("SetParamByName","CLEARGBSESEALINFO",""),g.invoke("SetParamByName","GBSESEALINFO",r),g.invoke("SetParamByName","GBSIGNSN",s.signsn)),"GM"==s.sealtag&&g.invoke("SetParamByName","ISGM","1")),W.options.fjrsIsphone&&(g.invoke("SetParamByName","FJRSISPHONE",W.options.fjrsIsphone),g.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken"))),g.invoke("SetParamByName","KEYSN",e.keysn),g.invoke("SetParamByName","SIGNSN",e.signsn),g.invoke("KGCrySignMessage",l,o.join(";"),+a[0]).ret(function(e){e=R.extend({},e);e.result&&(e.certinfo.notAfter=t.parseDate(e.certinfo.notAfter),e.certinfo.notBefore=t.parseDate(e.certinfo.notBefore)),n.call(t,e)}),s&&s.sealtag&&"GB"==s.sealtag&&(g.invoke("SetParamByName","CLEARGBSESEALINFO",""),g.invoke("SetParamByName","GBSIGNSN",""))}}),W.addProvider("cert","client",D),W.addProvider("seal","client",b),z.inherit(I,W.SealService),function(e,t){var n=this;n.sData=t,R.each(e,function(e,t){"function"==typeof n[e]?n[e](t):n[e]=t})}),x=(z.inherit(T,W.CertService),R.extend(I.prototype,{getSealsUrl:"_key_load",verifyInputUrl:"_key_verify",saveLogUrl:"_signature_saveLog",applySMSCodeUrl:"_sms_applySMSCode",checkSMSCodeUrl:"_sms_checkSMSCode",telphoneUrl:"_sms_telphone",getQRCodeUrl:"_scan_getQrCodeImage",sealAuthorityUrl:"_scan_sealAuthority",getQRCodeTokenUrl:"_scan_getQrCodeToken",queryUserCompanyUrl:"_scan_queryUserCompany",getUserSealsUrl:"_scan_getUserSeals",establishSessionUrl:"_scan_establishSession",exitSessionUrl:"_scan_exitSession",saveLog:function(e){e=d(e);W.options.savelogFlg&&y.surry(this.serverUrl).request(this.saveLogUrl,{loginfo:e}).ret(function(e){e.result||W.prototype.error.call(null,e)})},getPwdSaveTime:function(t,n){y.surry(W.options.serverUrl).request("_signature_getPwdSaveTime").ret(function(e){t(e.result?e.pwdTime:n)})},loadSeal:function(r){var l=this,c=r.successCall,d=r.errorCall,e=(l.clientUrl,l.getSealsUrl,{usercode:l.usercode,keysn:l.keysn,authcode:l.authcode,appcode:W.options.appcode,sealTag:W.options.sealTag,certContext:W.options.cert});r.type&&(e.type=r.type),y.surry(l.serverUrl).request(l.getSealsUrl,e).ret(function(n){if(n.result){if(void 0!==W.options.imgtag&&null!==W.options.imgtag){var e=new Array;n.seals.length;for(s in n.seals)void 0!==(t=n.seals[s])&&parseInt(t.imgtag)==W.options.imgtag&&(e[e.length]=n.seals[s]);n.seals=e}if(W.options.signname||W.options.signindex){W.options.signname=z.is("Array",W.options.signname)?W.options.signname:[W.options.signname];var t,e=new Array;for(s in n.seals){void 0!==(t=n.seals[s])&&s==W.options.signindex&&e.push(n.seals[s]);for(var i=0,o=W.options.signname.length;i<o;i++)void 0!==t&&t.signname==W.options.signname[i]&&n.seals[W.options.signindex]!=t&&e.push(n.seals[s])}0==e.length?(n.result=!1,n.errcode="11101"):n.seals=e}if(!n.seals.length){var a;if(!r.isHW)return a="11101",W.options.imgtag&&(a="11100"+W.options.imgtag),void d.call(l,{result:!1,errcode:a});n.seals=[],n.seals[0]={signname:"",width:"",signsn:null,height:"",imgdata:"",imgext:".png"}}if(n.seals&&0<n.seals.length&&!r.isHW)for(var s=0;s<n.seals.length;s++)!function(t){!function(e,n){var i=this,o=(document.createElement("base64Img"),document.createElement("canvas")),a=o.getContext("2d"),s=new Image;s.src=e,s.addEventListener("load",function(){o.width=s.width,o.height=s.height,a.drawImage(s,0,0);for(var e=a.getImageData(0,0,o.width,o.height),t=0;t<e.data.length;t+=4)250<e.data[t]&&250<e.data[t+1]&&250<e.data[t+2]&&(e.data[t+3]=0);a.putImageData(e,0,0),i.baseImg=o.toDataURL("image/png").slice(22),n&&n(i.baseImg)},!1)}("data:iamge/jpg;base64,"+n.seals[t].imgdata,function(e){n.seals[t]&&(n.seals[t].imgdata=e)})}(s);c.call(l,n)}else d.call(l,n)})},verifyPwd:function(e){var t,n=this,i=W.options.encryptPwd,o=W.options.pwdIsEncrypt&&!!W.options.password,a=i?W._aesEncrypt(e.pwd):e.pwd,s=e.successCall,r=y.surry(n.serverUrl);e.verify?(t={keysn:e.keysn,verifyCode:e.pwd},r.request(n.checkSMSCodeUrl,t).ret(function(e){s.call(n,e)})):(t={usercode:(null==n.sData?e:n.sData).usercode,keysn:(null==n.sData?e:n.sData).keysn,password:a,isEncrypt:i,pwdIsEncrypt:o},r.request(n.verifyInputUrl,t).ret(function(e){s.call(n,e)}))},applySMSCode:function(t){var e={keysn:t.keysn};y.surry(this.serverUrl).request(this.applySMSCodeUrl,e).ret(function(e){t.successCall&&t.successCall(e)})},getTelphone:function(t){var e={keysn:t.keysn};y.surry(this.serverUrl).request(this.telphoneUrl,e).ret(function(e){t.successCall&&t.successCall(e)})},checkKeysn:function(e,t){e.keysn==W.options.keysn||e.usercode==W.options.usercode?t({result:!0}):t({result:!1,errcode:"11115"})},getKeysn:function(e,t){t(W.options.keysn)},getQRCodeImage:function(e,t,n){var i={},o=y.surry(this.serverUrl);i.way={stamp:"1",delete:"2"}[e],i.scanSealType=t,o.request(this.getQRCodeUrl,i).ret(function(e){n(e)})},getSealauthority:function(e,t,n,i){e={scanId:e,esid:t,userToken:n};y.surry(this.serverUrl).request(this.sealAuthorityUrl,e).ret(function(e){i(e)})},getRemoveAuthority:function(e,t,n){W.options.clientConfig&&n(!0),t.seal.esid&&"scanStamp"!=t.stampType?(t={documentId:t.documentid,documentName:t.documentname,esid:t.seal.esid,signeddata:t.signMeta.signeddata},y.surry(W.options.serverUrl).request("_signature_authentication",t).ret(function(e){e.result?n(!0):(W.prototype.error.call(null,e),n(!1))})):n(!0)},getQrCodeToken:function(t){y.surry(this.serverUrl).request(this.getQRCodeTokenUrl).ret(function(e){t(e)})},queryUserCompany:function(e,t){y.surry(this.serverUrl).request(this.queryUserCompanyUrl,{userToken:e}).ret(function(e){t(e)})},getUserSeals:function(e,t,n,i){y.surry(this.serverUrl).request(this.getUserSealsUrl,{userToken:e,category:t,entityCode:n}).ret(function(e){i(e)})},establishSession:function(e,t){y.surry(this.serverUrl).request(this.establishSessionUrl,{authCode:e}).ret(function(e){t(e)})},exitSession:function(e,t){y.surry(this.serverUrl).request(this.exitSessionUrl,{userToken:e}).ret(function(e){t(e)})}}),R.extend(T.prototype,{signUrl:"_sign",verifySignUrl:"_sign_verify",verifySign:function(e){var t=this,n=t.sData,i=e.successCall,o=!!n.stampType,a=y.surry(t.serverUrl),o={certType:n.certType,isUTF8:n.isUTF8,signsn:n.seal.signsn,html2sign:n.signMeta.html2sign,keysn:n.keysn,isScan:o,signdata:e.signdata,signeddata:n.signMeta.signeddata,crtdata:n.signMeta.certinfo.crtdata,sealTag:n.seal.sealTag||n.seal.sealtag};a.request(t.verifySignUrl,o).ret(function(e){i.call(t,e)})},sign:function(e){var t,n=this,i=e.signMeta[0],o=e.successCall,a=e.seal.sealTag,s=("GM"!=a&&"SM2"!=W.options.certAlgorithm||(i.encryptAlg="SM2"),W.options.encryptPwd),r=W.options.pwdIsEncrypt&&!!W.options.password,l=s?W._aesEncrypt(e.password):e.password;t="scanStamp"===n.sData.stampType?(t=e.seal.sealData,{keysn:e.keysn,scanSealType:e.seal.scanSealType,scanId:e.seal.scanId,esid:e.seal.esid,documentId:e.documentid,documentName:e.documentname,signdata:i.signdata,signsn:e.signsn,encryptAlg:i.encryptAlg,scanStamp:!0,userToken:W.userToken,sealData:t}):W.options.verification?{keysn:e.keysn,signdata:i.signdata,encryptAlg:i.encryptAlg,signsn:e.signsn,sealTag:a}:{keysn:e.keysn,isEncrypt:s,pwdIsEncrypt:r,password:l,signsn:e.signsn,sealTag:a,encryptAlg:i.encryptAlg,signdata:i.signdata},e.seal.esid&&(t.esid=e.seal.esid,t.documentId=e.documentid,t.documentName=e.documentname),e.seal.seSeal&&(t.seSeal=e.seal.seSeal,t.version=e.seal.version),e.type&&(t.type=e.type),y.surry(n.serverUrl).request(n.signUrl,t).ret(function(e){e.result&&(e.certinfo.algName=e.certinfo.algName.replace("with","")),o.call(n,e)})}}),W.addProvider("cert","server",T),W.addProvider("seal","server",I),W.alert=C.alert,W.version={name:"1.0.20",code:100});return u.Signature=W}));
//V3.0.0.572