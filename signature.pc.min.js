!function(e){"function"!=typeof define||!define.amd||"undefined"!=typeof nonUseAmd&&nonUseAmd?e():"undefined"!=typeof HTMLDev&&HTMLDev?define(["./signature"],e):define(["./signature.min"],e)}((window,function(e){var t,i,a,n,s=window,L=s.kinggrid,W=window.Signature,V=window.jQuery,l=!1,P=(s.JSON&&(l='{"x":"中"}'!==s.JSON.stringify({x:"中"})),L.Utils),r=W.options,H=(P.extend(W.options.template,{signInfoBtl:'<div class="kg-dialog kg-dialog-info kg-dialog-signedinfo" id="kg-signedinfo"><%var modified = this.signModified;%><%var timeVerify = this.timeVerify;%><div class="kg-title success <%modified?"kg-hide":""%>"><i class="kg-icon"></i><div><span data-kgi18n-html="ProtectionNormal">检测结果：签名数据验证正常！</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><span data-kgi18n-html="<%timeVerify==true?"Trusted":"UnTrusted"%>"></span></span><%}%></div></div><div class="kg-title danger  <%modified?"":"kg-hide"%> "><i class="kg-icon"></i><div><span data-kgi18n-html="ProtectionTamper">检测结果：签名数据被篡改！</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><span data-kgi18n-html="<%timeVerify==true?"Trusted":"UnTrusted"%>"></span></span><%}%></div></div><div class="kg-content"><div class="kg-tab"><div class="kg-nav-warp"><ul class="kg-nav clearfix"><li class="active"><a href="#" class="kg-title-red" kg-target="certinfo"  data-kgi18n-html="CertInfo">证书信息</a></li></ul></div><%var certinfo = this.signatureData.signMeta.certinfo; %><div class="kg-tab-content"><div class="kg-tab-pane active certinfo"><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label"   data-kgi18n-html="Version">版本：</label><span class="kg-value <%this.Global%>-value"><%certinfo.version%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SerialNumber">序号：</label><span class="kg-value <%this.Global%>-value"><%certinfo.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureAlgorithm">签名算法：</label><span class="kg-value <%this.Global%>-value"><%certinfo.algName%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Issuer">颁发者：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%certinfo.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="User">使用者：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%certinfo.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="ValidFrom">有效期从：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%kinggrid.Utils.formatDate(new Date(certinfo.notBefore) , "yyyy-MM-dd hh:mm:ss")%></span><label data-kgi18n-html="To" class="kg-to">至：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%kinggrid.Utils.formatDate(new Date(certinfo.notAfter) , "yyyy-MM-dd hh:mm:ss")%></span></div></div></div></div></div></div></div>',signatureInfoBtl:'<div class="kg-dialog kg-dialog-info" id="kg-sigantureinfo"><%var autoCertMode = Signature.options.autoCertMode; %><%var modified = this.modified;%><%var timeVerify = this.timeVerify;%><%var sealType = Signature.options.sealType;%><div class="kg-title success <%modified?"kg-hide":""%>"><i class="kg-icon"></i><div><span data-kgi18n-html="VerifyNormal">检测结果：保护数据正常！</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><span data-kgi18n-html="<%timeVerify==true?"Trusted":"UnTrusted"%>"></span></span><%}%></div></div><div class="kg-title danger  <%modified?"":"kg-hide"%> "><i class="kg-icon"></i><div><span data-kgi18n-html="VerifyTamper">检测结果：保护数据被篡改！</span><%if(timeVerify!=null){%><span class="timestamp <%timeVerify==true?"green":"red"%>"><span data-kgi18n-html="<%timeVerify==true?"Trusted":"UnTrusted"%>"></span></span><%}%></div></div><div class="kg-content"><div class="kg-tab"><%if(autoCertMode){%><%var certinfo = !!this.signatureData.signMeta?this.signatureData.signMeta.certinfo:0; %><%var tsaInfo = !!this.signatureData.signMeta?this.signatureData.signMeta.tsaInfo:0; %><%}%><ul class="kg-nav clearfix"><li class=" <% modified?"":"active"%> "><a href="#" class="kg-title-red" kg-target="signatureinfo" data-kgi18n-html="SignInfo" style="text-align:center;">签章信息</a></li><%if(autoCertMode){%><%if(!!certinfo){%><li class=""><a href="#" class="kg-title-red" kg-target="certinfo"  data-kgi18n-html="CertInfo">证书信息</a></li><%}%><%if(!!tsaInfo){%><li class=""><a href="#" class="kg-title-red" kg-target="tsaInfo"  data-kgi18n-html="tStampInfo">时间戳信息</a></li><%}%><%}%><%if(modified){%><li class=" <% modified?"active":""%> "><a href="#" class="kg-title-red" kg-target="modifieditems" data-kgi18n-html="TamperInfo" style="text-align:center;">篡改信息</a></li><%}%></ul><div class="kg-tab-content" ><% var SDATA = this.signatureData; %><% var scanStamp = this.signatureData.stampType;%><% var modifiedItems = this.modifiedItems; %><%if(modified){%><%var modifiedItems = this.modifiedItems;%><% for(var i=0;i<modifiedItems.length;i++){%><% var item = modifiedItems[i]; %><div class="kg-tab-pane modifieditems <% modified?"active":""%> "><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" kg-field="<%item.field%>"><%item.desc%><span data-kgi18n-html="By"></span></label><span class="kg-value <%this.Global%>-value""><%this["_renderValue"](this["html2Escape"](item.orivalue)) %></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="ChangeTo">更改为：</label><span class="kg-value <%this.Global%>-value""><%this["_renderValue"](this["html2Escape"](item.newvalue))%></span></div></div></div><%}%><%}%><div class="kg-tab-pane <% modified?"":"active"%> signatureinfo"><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Application">应用程序：</label><span class="kg-value <%this.Global%>-value"><%SDATA.appname%></span></div><%if(SDATA.orgname){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="AuthorizedUnit">授权单位：</label><span class="kg-value <%this.Global%>-value"><%SDATA.orgname%></span></div><%}%><%if(SDATA.username){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="UserName" style="line-height:17px;margin:4px 0;">用户名称：</label><span class="kg-value <%this.Global%>-value"><%SDATA.username%></span></div><%}%><%if(SDATA.keysn){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="KeySequence">密钥序列：</label><span class="kg-value <%this.Global%>-value"><%SDATA.keysn%></span></div><%}%><%if(SDATA.esid){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label">esid</label><span class="kg-value <%this.Global%>-value"><%SDATA.esid%></span></div><%}%><%if(SDATA.seal.signname){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureName">签章名称：</label><span class="kg-value <%this.Global%>-value"><%SDATA.seal.signname%></span></div><%}%><%if(SDATA.seal.signsn){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureSequence">签章序列：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%SDATA.seal.signsn%></span></div><%}%><%if(SDATA.timestamp.signtime){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureDate">签章日期：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%SDATA.timestamp.signtime%></span></div><%}%><%if(sealType == "client" && SDATA.seal.headinfoex){%><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="StampName">制章人名：</label><span class="kg-value <%this.Global%>-value"><%SDATA.seal.headinfoex.sealProducer%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="StampDate">制章日期：</label><span class="kg-value <%this.Global%>-value"><%SDATA.seal.headinfoex.sealMakingTime%></span></div><%}%></div></div><%if(autoCertMode){%><%if(!!certinfo){%><div class="kg-tab-pane certinfo"><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Version">版本：</label><span class="kg-value <%this.Global%>-value"><%certinfo.version%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SerialNumber" >序号：</label><span class="kg-value <%this.Global%>-value" ><%certinfo.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="SignatureAlgorithm">签名算法：</label><span class="kg-value <%this.Global%>-value"><%certinfo.algName%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="Issuer">颁发者：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%certinfo.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="User">使用者：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%certinfo.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="ValidFrom">有效期从：</label><span class="kg-value <%this.Global%>-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notBefore) , "yyyy-MM-dd hh:mm:ss")%></span><label data-kgi18n-html="To" class="kg-to">至：</label><span class="kg-value <%this.Global%>-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notAfter) , "yyyy-MM-dd hh:mm:ss")%></span></div></div></div><%}%><%if(!!tsaInfo){%><div class="kg-tab-pane tsaInfo"><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaTime">时间戳时间：</label><span class="kg-value <%this.Global%>-value"><%tsaInfo.tsaTime%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaSubject" >证书使用者：</label><span class="kg-value <%this.Global%>-value" ><%tsaInfo.tsaCert.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaSerialNumber">证书序列号：</label><span class="kg-value <%this.Global%>-value"><%tsaInfo.tsaCert.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaIssuerDN">时间戳机构：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%tsaInfo.tsaCert.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="TsaSigAlg">签名算法：</label><span class="kg-value <%this.Global%>-value" style="line-height:17px;margin:4px 0;"><%tsaInfo.tsaCert.oid%></span></div><div class="clearfix kg-item "><label class="kg-label <%this.Global%>-label" data-kgi18n-html="ValidFrom">有效期从：</label><span class="kg-value <%this.Global%>-value"><%kinggrid.Utils.formatDate(kinggrid.Utils.getDate(tsaInfo.tsaCert.startDate) , "yyyy-MM-dd hh:mm:ss")%></span><label data-kgi18n-html="To" class="kg-to">至：</label><span class="kg-value <%this.Global%>-value"><%kinggrid.Utils.formatDate(kinggrid.Utils.getDate(tsaInfo.tsaCert.endDate) , "yyyy-MM-dd hh:mm:ss")%></span></div></div></div><%}%><%}%></div></div></div></div>',handwritedlg:'<div class="kg-dialog kg-dialog-info" style="width:<%this.canvasWidth%>px;" id="kg-handwrite" unselectable="on" onselectstart="return false;" style="-moz-user-select:none;"><div class="kg-hw-content"><div class="kg-hw-info kg-hw-model"><span data-kgi18n-html="Model">模式</span><select id="hw_model" ><option value="0" <%this.mode == 0?"selected":""%> data-kgi18n-html="HWSignatrue" >手写签名</option><option value="1" <%this.mode == 1?"selected":""%> data-kgi18n-html="TextApproval">文字签批</option><option value="2" <%this.mode == 2?"selected":""%> >印章选项</option></select></div><div class="kg-hw-info kg-hw-name"><span data-kgi18n-html="Name">名称</span><input type="text"  data-kgi18n-value="HWApproval" value="手写签批" id="nameid" style="width:74px;height:18px;"/></div><div class="kg-hw-info kg-hw-color"><span data-kgi18n-html="Color">颜色</span><select id="hw_color"><option value="black" data-kgi18n-html="KGfontColor黑">黑</option><option value="red" data-kgi18n-html="KGfontColor红">红</option><option value="blue" data-kgi18n-html="KGfontColor蓝">蓝</option><option value="green" data-kgi18n-html="KGfontColor绿">绿</option></select></div><div class="kg-hw-info kg-hw-linewidth kg-hw-handwrite"><span data-kgi18n-html="PenWidth">笔宽</span><select id="hw_width"><% for(var i=1;i<=8;i++) {%><option value="<%i%>"><%i%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontFamily kg-hw-written"><span data-kgi18n-html="Font">字体</span><select id="hw_fontFamily"><% for(var i=0;i<this.fontFamily.length;i++) {%><option value="<%this.fontFamily[i].ename%>"><%this.fontFamily[i].zname%></option><%}%></select></div><div class="kg-hw-info kg-hw-fontSize kg-hw-written"><span data-kgi18n-html="FontSize">字号</span><select id="hw_fontSize"><%for(var i=16;i<=80;i+=4) {%><option value="<%i%>"<%i==this.fontSize?"selected":""%>><%i%></option><%}%></select></div><div class="kg-hw-info kg-hw-seals"><span data-kgi18n-html="Seal" class="kg-hwSeals">印章</span><select id="hw_seals"><% for(var i=0;i<this.seals.length;i++) {%><option value="<%[i]%>"><%this.seals[i].signname%></option><%}%></select></div></div><div class="kg-hw-canvas" style="width:<%this.canvasWidth%>px;height:<%this.canvasHeight%>px;"><div id="kg-hw-tip">请手写签批</div><div id="kg-hw-span" class="kg-hw-written kg-hw-text-span" style="width:<%this.canvasWidth%>px;height:<%this.canvasHeight%>px;" ></div><textarea class="kg-hw-written kg-hw-text-edit"  spellcheck="false" style="width:<%this.canvasWidth%>px;height:<%this.canvasHeight%>px;"></textarea><canvas id="canvasId" style="position:absolute;left:0" width="670" height="500"></canvas><div id="kg-handwriteImgContainer"><img id="kg-handwriteImg" style="left:0;top:0"/><span id="kg-remove-img"></div></div><div id="div-judge" style="display: block;height:38px;width:<%this.canvasWidth%>px;" align="center"><span id="kg-eraser" class="eraser gray"></span><button type="button" id="clearid" class="kg-button kg-default-btn-red" data-kgi18n-html="Clear">清除</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" id="okid" class="kg-button kg-primary-btn-red" data-kgi18n-html="Sign">签名</button></div></div>',barcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-barcode"><label class="kg-label">二维码内容：</label><textarea id="bcId"></textarea><br /><div id="output"><br /></div><div id="div-judge" style="display: block"><button type="button" id="bc_clearid" class="kg-button" data-kgi18n-html="Clear">清除</button><button type="button" id="bc_okid" class="kg-button" data-kgi18n-html="Confirm">确认</button></div></div>',scanBCdlg:'<div class="kg-dialog kg-dialog-info" id="kg-barcode"><div id="support"></div> <div id="contentHolder"><video id="video" width="320" height="320" autoplay></video><canvas style="display:none; background-color:#F00;" id="canvas_scanBC" width="320" height="320"></canvas> <br/> </div></div>',scanStampdlg:'<div class="kg-dialog" id="kg-scanStampdlg"><div id="support"></div> <div id="scanStampContent"><div id="kg-qrCodeImgForeground" class="hide" data-kgi18n-html="QrcodeInvalid">二维码已失效，点击刷新</div><img id="kg-qrcodeImg" width="320px" height="320px"/></div></div>'}),kingPlus()),d=(W.addLiseter("init",function(){t=W.aisleKing;for(var e=W.options.icons,i=0;i<e.length;++i){var a=e[i];switch(a.iconClass){case"kg-icon-move-":null!=W.options.icon_move_donot&&0==W.options.icon_move_donot&&(a.enable=!1);break;case"kg-icon-move":null!=W.options.icon_move&&0==W.options.icon_move&&(a.enable=!1);break;case"kg-icon-remove":null!=W.options.icon_remove&&0==W.options.icon_remove&&(a.enable=!1);break;case"kg-icon-sign":null!=W.options.icon_sign&&0==W.options.icon_sign&&(a.enable=!1);break;case"kg-icon-signverify":null!=W.options.icon_signverify&&0==W.options.icon_signverify&&(a.enable=!1);break;case"kg-icon-sealinfo":null!=W.options.icon_sealinfo&&0==W.options.icon_sealinfo&&(a.enable=!1)}}}),W.addLiseter("beforeVerify",function(){i=[],a={signsn:[],sealImg:[]}}),W.addLiseter("eachVerify",function(e){e.broken&&(i.push(e),a.signsn.push(e.signatureData.seal.signsn),a.sealImg.push(e.signatureData.seal.imgdata))}),W.addLiseter("startMove",function(a,e,i){var t;"client"==W.options.sealType&&W.options.moveable_self&&(t=L.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode),W.options.fjrsIsphone&&(t.invoke("SetParamByName","FJRSISPHONE",W.options.fjrsIsphone),t.invoke("SetParamByName","FJRSTOKEN",localStorage.getItem("fjrsToken"))),t.invoke("KGGetKeyOtherInfo","0").ret(function(e){var i;e.result?(i=e.Res.substring(1,e.Res.length-1),a.keysn=i,a.keysn!=a.signatureData.keysn&&W.alert(L.msg("cannot_move","KG_MSG"))):W.alert(L.msg(e.errcode,"then"))}))}),W.addLiseter("verify",function(){i.length}),{});return V(window).resize(function(){n&&clearTimeout(n),n=setTimeout(function(){for(var e in d){var e=V(d[e]),i=V(P.$(e.attr("elemid")));W.prototype.calSealPos.call(null,i,e)}},200)}),P.extend(W.prototype,{_init:function(){var o=this;o.on("showAt",function(e){P.$(e.getAttribute("elemid")).getAttribute("display")||(d[e.id]=e)}),o.on("removeAt",function(e){delete d[e.id]}),o.on("beforeShowAt",function(e){3960<this.signatureData.seal.imgdata.length&&l&&(this.brokenImgDiv=e)}),o.on("showAt",function(i){var e,a;o.brokenImgDiv&&(a=(e=o.signatureData.seal).signsn,t&&(t=L.surry(W.options.serverUrl)).request(o.imageUrl,{signsn:a,sealImg:e.imgdata,sid:o.signatureid}).ret(function(e){e.result&&(e=e.imageUrl||o.imageUrl+"_",V(i).find(".kg-img").attr({src:W.options.serverUrl+e+"&a0=0&sid="+o.signatureid}),delete o.brokenImgDiv)}))}),o.on("showAt",function(e){e=V(e);null!=W.options.image_sealinfo&&1!=W.options.image_sealinfo||(0<=V().jquery.indexOf("1.4")?e.live("click",function(){var e=o._verify(null,{sucCall:function(){o.signatureInfo()}});void 0!==W.options.verifySignatureInfo&&W.options.verifySignatureInfo&&W.options.verifySignatureInfo(o.modified,o.modifiedItems,o.signatureData)||null!=e&&o.signatureInfo()}):e.on("click",function(){var e=o._verify(null,{sucCall:function(){o.signatureInfo()}});void 0!==W.options.verifySignatureInfo&&W.options.verifySignatureInfo&&W.options.verifySignatureInfo(o.modified,o.modifiedItems,o.signatureData)||null!=e&&o.signatureInfo(e)})),e.append('<div class="kgImgIcons kg-img-icons" ></div>')}),o.on("handleImg",function(e){var i=V(e);if(i.find(".kg-img-icon").remove(),r.icons)for(var a=i.children(".kg-img-icons"),t=r.icons.length-1;0<=t;t--){var n=r.icons[t];if(P.val(n.enable,o,e)){if("doornotmove"==n.id&&(o.signatureData.moveable?(n.iconClass=n.iconClass.substring(0,13)+"not",n.title=L.msg("SignatureMoveNot","KG_TITLE"),n.value="0"):(n.iconClass=n.iconClass.substring(0,13)+"do",n.title=L.msg("SignatureMoveDo","KG_TITLE"),n.value="1")),"moveSignature"==n.id&&!o.signatureData.moveable)break;var s=V.kgi18n.prop("Title"+n.id),l=V('<a href="#" title="'+s+' " class="kg-img-icon" id="kg-img-icon-'+n.id+"-"+this.signatureid+'"><i class="'+n.iconClass+'"></i></a>');n.value&&(l=V('<a href="#" title="'+s+' " class="kg-img-icon" id="kg-img-icon-'+n.id+"-"+this.signatureid+'" extval="'+n.value+'"><i class="'+n.iconClass+'"></i></a>')),a.append(l),n.exec&&n.exec.call(o,e);!function(i,a){l.click(function(e){e.imgDiv=i,a.call(o,e,i)})}(e,n.click||function(e){e.preventDefault(),e.stopPropagation()})}}})},signatureInfo:function(e){var i,a=this,t=(a.html2Escape=P.html2Escape,{target:a,onCancel:!1,onShow:function(){W.options.beginDlgShowCall&&W.options.beginDlgShowCall.call(),W.editThemeColor();var e=this.find(".kg-tab");this.tab=P.tab(e)}});return W._verfiyInfotoServer&&(a.signatureData,i=[],e=a._getLogInfo({LOGTYPE:"00",LOGSORT:"33",LOGMEMO:e?"文档验证成功":"文档验证失败"}),i.push(e),a.sealService.saveLog(i)),a.showDialog("signatureInfoBtl",t)},signInfo:function(){var e={title:L.msg("SignVerify","KG_TITLE"),target:this,onCancel:!1,onShow:function(){W.options.beginDlgShowCall&&W.options.beginDlgShowCall.call(),W.editThemeColor();var e=this.find(".kg-tab");this.tab=P.tab(e)}};return this.showDialog("signInfoBtl",e)},handWriteDlg:function(E,M){function R(e){return document.getElementById(e)}var N,O=this,i=W.create({}),U=Number(E.image_width)||8,B=Number(E.image_height)||8,F=JSON.parse(localStorage.getItem("kg-hw-fontSize"))||Object.create(null);O.mode=E.mode||0,i.sealService.getKeysn({},function(e){N=e;function a(e,n){e.unshift({signname:"无"}),O.seals=e,E.canvas_width=parseInt(E.canvas_width)||670,E.canvas_height=parseInt(E.canvas_height)||500,E.hideToolBar&&(E.canvas_height+=V(".kg-hw-content").height(),W.hideToolBar=E.hideToolBar),F[N]?O.fontSize=F[N]:O.fontSize=E.fontSize||"20",O.canvasWidth=E.canvas_width,O.canvasHeight=E.canvas_height,O.fontFamily=H.fontFamily;var a,t,s,l,o,r,d,g,c,e={title:L.msg("HWSignature","KG_TITLE"),target:O,onCancel:!1},h=O.showDialog("handwritedlg",e),i=h.find("#canvasId")[0];if(i.getContext){var v,f=(E.dlg=h).find(".kg-hw-text-span"),u=h.find(".kg-hw-text-edit"),p=h.find("#hw_width"),m=h.find("#hw_color"),k=h.find("#kg-hw-tip"),b=(E.toolBarHeight=V(".kg-hw-content").height(),new SignaturePad(i,E));if(p.val(E.lineSize||5),E.fontColor)if(0==E.fontColor.indexOf("#"))m.val(E.fontColor),b.setColor(E.fontColor),f.css({color:E.fontColor}),u.css({color:E.fontColor});else for(var y=["black","red","blue","green"],w=0;w<4;w++)if(y[w]==E.fontColor){m.val(E.fontColor),b.setColor(E.fontColor),f.css({color:E.fontColor}),u.css({color:E.fontColor});break}function S(e){"0"==e?(O.mode=0,h.find(".kg-hw-written").css({display:"none"}),h.find(".kg-hw-handwrite").css({display:"block"}),k.css({display:"inline-block"}),h.find(".kg-hw-seals").css({display:"none"}),h.find(".kg-hw-color").css({display:"block"}),h.find("#kg-eraser").css({display:"block"}),h.find(".kg-hw-name").css({display:"block"}),i.removeAttribute("disabled"),D.setAttribute("disabled",!0),b.setWebHandWrite(v,{fontStyle:"normal",fontSize:f.css("font-size"),fontFamily:f.css("font-family"),fontColor:f.css("color")}),v=new Array,f.html(""),u.val(""),_.style["pointer-events"]="none",p.click(),m.click(),h.find("#canvasId").css({cursor:"auto"})):"1"==e?(O.mode=1,h.find(".kg-hw-handwrite").css({display:"none"}),h.find(".kg-hw-written").css({display:"block"}),h.find("#kg-hw-tip").css({display:"none"}),h.find(".kg-hw-seals").css({display:"none"}),h.find(".kg-hw-color").css({display:"block"}),h.find("#kg-eraser").css({display:"none"}),h.find(".kg-hw-fontSize").css({display:"block"}),h.find(".kg-hw-fontFamily").css({display:"block"}),_.style["pointer-events"]="none",I()):"2"==e&&(O.mode=2,b.setWebHandWrite(v,{fontStyle:"normal",fontSize:f.css("font-size"),fontFamily:f.css("font-family"),fontColor:f.css("color")}),v=new Array,f.html(""),u.val(""),h.find(".kg-hw-seals").css({display:"block"}),h.find(".kg-hw-handwrite").css({display:"none"}),h.find(".kg-hw-written").css({display:"none"}),k.css({display:"none"}),h.find(".kg-hw-color").css({display:"none"}),h.find(".kg-hw-seals").css({display:"block"}),h.find("#kg-eraser").css({display:"none"}),_.style["pointer-events"]="auto",i.setAttribute("disabled",!0),D.removeAttribute("disabled"),I())}function I(e){e=e||R("kg-eraser");var i=p.val(),a=m.val();b.setSize(i),b.setColor(a),f.css({color:a}),u.css({color:a}),h.find("#canvasId").css({cursor:"auto"}),V(e).addClass("gray")}function C(e){f.css({"font-size":e+"px","line-height":6+1.2*e+"px"}),u.css({"font-size":e+"px","line-height":6+1.2*e+"px"}).attr("rows",1)}E.buttonText&&h.find("#okid").html(E.buttonText),E.hideToolBar&&h.find(".kg-hw-content").css("display","none"),m.change(function(){I()}),h.find("#hw_model").change(function(e){S(e.target.value)}),u.keyup(function(e){var i=P.convertText(this.value);parseFloat(u.css("line-height"))*i.split("<br>").length>parseFloat(u.css("height"))?console.warn("文字超过限制"):f.html(i),v=P.handleEdittable(f,i)}),p.change(function(){I()}),h.find("#hw_fontFamily").change(function(e){f.css({"font-family":this.value}),u.css({"font-family":this.value}),I()}),h.find("#kg-eraser").click(function(){var e;V(this).hasClass("gray")?(e=(e=this)||R("kg-eraser"),b.setColor("white"),h.find("#canvasId").css({cursor:"crosshair"}),b.setSize(12),V(e).removeClass("gray")):I(this)}),C(O.fontSize),h.find("#hw_fontSize").change(function(e){C(this.value),v=P.handleEdittable(f,f.html()),F[N]=this.value,localStorage.setItem("kg-hw-fontSize",JSON.stringify(F))});var e=h.find("#clearid"),x=h.find("#okid");e.click(function(){b.clear(),v=new Array,f.html(""),u.val(""),V(D).css({display:"none",opacity:0,top:-1e4,left:-1e4}),h.find("#hw_seals").val(0)}),x.click(function(){h.close(),W.hideToolBar=null,b.setWebHandWrite(v,{fontStyle:"normal",fontSize:f.css("font-size"),fontFamily:f.css("font-family"),fontColor:f.css("color")}),b.setImageHandWrite(D),b.toDataURL(function(e){var i,a,t=E.canvas_height/E.canvas_width;e.imageData=e.imageData.replace(/^data:image\/\w+;base64,/,""),e.name=E.name||h.find("#nameid").val(),E.noCutting?(e.width=P.pxConversionMm(E.canvas_width/10),e.height=P.pxConversionMm(E.canvas_height/10)):(e.height=P.pxConversionMm(e.height)/E.canvas_height,e.width=P.pxConversionMm(e.width)/E.canvas_width,a=e,parseFloat(a.width)>parseFloat(a.height)?(i=U/e.width,e.width=U,e.height=e.height*i*t):(i=B/e.height,e.height=B,e.width=e.width*i/t)),e.keyData=n,M(e),h.remove()},{mode:O.mode,noCutting:E.noCutting,display_width:E.canvas_width,display_height:E.canvas_height})}),h.find(".ui-dialog-close").click(function(){h.close(),E.onCancel&&E.onCancel.call()});var D=R("kg-handwriteImg"),T=R("kg-remove-img"),_=R("kg-handwriteImgContainer");V(_).css({width:E.canvas_width+"px",height:E.canvas_height+"px"}),h.find("#hw_seals").change(function(e){T.style.display="none";var n,e=e.target.value;0==e?V(D).css({display:"none",opacity:0,top:-1e4,left:-1e4}):(V(D).css({display:"block"}),e="data:image/"+(n=O.seals[e]).imgext+";base64,"+n.imgdata,V(D).attr("src",e),D.onload=function(){var e=P.mmConversionPx(10*n.width),i=P.mmConversionPx(10*n.height),a=(E.canvas_height-i)/2,t=(E.canvas_width-e)/2;V(D).css({left:t,top:a,opacity:1,width:e,height:i})})}),t=_,c=!(s=function(){G(D,T)}),(a=D).addEventListener("mousedown",function(e){d=e.offsetX,g=e.offsetY,c=!0}),t.addEventListener("mousemove",function(e){var i;c&&(e.preventDefault(),i=e.clientX,e=e.clientY,l=i-d,o=e-g,r=t.getBoundingClientRect(),(l=l<r.left?r.left:l)>=r.right-a.offsetWidth&&(l=r.right-a.offsetWidth),(o=o<r.top?r.top:o)>=r.bottom-a.offsetHeight&&(o=r.bottom-a.offsetHeight),l-=r.left,o-=r.top,a.style.left=l+"px",a.style.top=o+"px",s&&s())}),t.addEventListener("mouseup",function(e){c=(e.target,a.children[0],!1)}),D.addEventListener("mouseover",function(){A(!0)}),T.addEventListener("mouseover",function(){A(!1)}),D.addEventListener("mouseout",function(){T.style.display="none"}),T.addEventListener("mouseout",function(){T.style.display="none"}),T.addEventListener("click",function(){V(D).css({display:"none",opacity:0,top:-1e4,left:-1e4}),h.find("#hw_seals").val(0),T.style.display="none"}),S(O.mode),e=(O.canvasWidth-144)/2,x=(O.canvasHeight-58)/2+25,k.css({left:e+"px",top:x+"px"})}else h.close(),E.onError?E.onError.call():O.error({errcode:"11113"},"then");function G(e,i){var a=e.offsetLeft+e.offsetWidth-i.offsetWidth/2,e=e.offsetTop-i.offsetHeight/2;i.style.left=a+"px",i.style.top=e+"px"}function A(e){2==O.mode&&(T.style.display="inline-block",e&&G(D,T))}}i.sealService.loadSeal({successCall:function(e){var i=JSON.parse(JSON.stringify(e.seals));a(i,e)},errorCall:function(e){a([],e)}})})},fingerPrintsDevice:function(n,s){var l=this;n.successCall;L.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode).invoke("KGRunFingerPrints",n.device_type||"0",n.image_type||"gif","JSComServer","","").ret(function(e){var i,a,t;e.result?(i=e.FingerPrintsMap,t=parseFloat(254*e.ImageWidth/9600).toFixed(2),a=parseFloat(254*e.ImageHeight/9600).toFixed(2),t={width:n.image_height||t,height:n.image_width||a,imageData:i,name:V.kgi18n.prop("TitleFS")},s(t)):l.errorCallback(e,n.errorCall,"KGRunFingerPrints")})},handWriteDevice:function(n,s){var l=this;null!=n.copy_right&&null!=n.copy_right&&L.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode).invoke("KGRunHandWritten",n.device_type||"0",n.copy_right,"JSComServer","","").ret(function(e){var i,a,t;e.result?(i=e.HandWrittenValue,t=parseFloat(254*e.ImageWidth/9600).toFixed(2),a=parseFloat(254*e.ImageHeight/9600).toFixed(2),t={width:n.image_height||t,height:n.image_width||a,imageData:i,name:V.kgi18n.prop("TitleHW")},s(t)):l.errorCallback(e,n.errorCall,"KGRunHandWritten")})},eqpHandWriter:function(n,s){var l=this;null!=n.Value&&null!=n.Value&&L.surry(W.options.clientUrl,"IWEBASSIST.iWebAssistCtrl.1","4240FB41-A213-42B6-8CB5E6705C99B319",W.options.clientCode).invoke("KGEQPHandWriter",n.Value,n.DllName,"JSComServer").ret(function(e){var i,a,t;e.result?(i=e.imagedata,t=parseFloat(254*e.imagewidth/9600).toFixed(2),a=parseFloat(254*e.imageheight/9600).toFixed(2),t={width:n.image_height||t,height:n.image_width||a,imageData:i,name:V.kgi18n.prop("TitleHSS")},s(t)):l.errorCallback(e,n.errorCall,"KGEQPHandWriter")})},barCodeDlg:function(e,i){var a;null!=e.content&&null!=e.content&&(a=V("#output").qrcode(e.content),i({height:e.image_height||"5",width:e.image_width||"5",imageData:a,name:V.kgi18n.prop("OtherInfoQrCode")}))},scanStampDlg:function(e,i){var a,t;W.options.clientConfig||(a=this,t={title:L.msg("scanBCSignature","KG_TITLE"),target:a,onCancel:!1},e=e.type,W.ScanStamp.call(a,function(){return a.showDialog("scanStampdlg",t)},function(e){i(e)},e).getQrCodeImageByStamp())},scanBCDlg:function(i,a){var e={title:L.msg("scanBCSignature","KG_TITLE"),target:this,onCancel:!1},t=this.showDialog("scanBCdlg",e);try{function n(e){r=!1,e.PERMISSION_DENIED?alert(V.kgi18n.prop("PERMISSION_DENIED"),V.kgi18n.prop("OtherInfoTip")):e.NOT_SUPPORTED_ERROR?alert(V.kgi18n.prop("NOT_SUPPORTED_ERROR"),V.kgi18n.prop("OtherInfoTip")):e.MANDATORY_UNSATISFIED_ERROR?alert(V.kgi18n.prop("MANDATORY_UNSATISFIED_ERROR"),V.kgi18n.prop("OtherInfoTip")):alert(V.kgi18n.prop("NOT_CAMERA_ERROR"),V.kgi18n.prop("OtherInfoTip"))}var s=document.getElementById("canvas_scanBC").getContext("2d"),l=document.getElementById("video"),o={video:!0,audio:!1},r=!0;if(navigator.getUserMedia){if(-1<navigator.userAgent.indexOf("MQQBrowser"))return alert(V.kgi18n.prop("NOT_SUPPORTED_ERROR"),V.kgi18n.prop("OtherInfoTip")),!1;navigator.getUserMedia(o,function(e){l.src=e,l.play()},n)}else if(navigator.webkitGetUserMedia)navigator.webkitGetUserMedia(o,function(e){l.src=window.webkitURL.createObjectURL(e),l.play()},n);else if(navigator.mozGetUserMedia)navigator.mozGetUserMedia(o,function(e){l.src=window.URL.createObjectURL(e),l.play()},n);else{if(!navigator.msGetUserMedia)return alert(V.kgi18n.prop("NOT_SUPPORTED_ERROR")),!1;navigator.msGetUserMedia(o,function(e){V(document).scrollTop(V(window).height()),l.src=window.URL.createObjectURL(e),l.play()},n)}SCAN_ERROR,r&&alert(V.kgi18n.prop("SCAN_ERROR"));var d=setTimeout(function(){s&&(s.drawImage(l,0,0,320,320),V("#contentHolder").html5_qrcode(function(e){V("#read").html(e),t.close(),alert(e),i.content=e,barCodeDlg(i,a),window.clearInterval(d)},function(e){V("#read_error").html(e),t.close(),window.clearInterval(d)},function(e){V("#vid_error").html(e),t.close(),window.clearInterval(d)}))},200)}catch(e){printHtml("浏览器不支持HTML5 CANVAS")}}}),W.addIcon({iconClass:"kg-icon-move",title:L.msg("moveSignature","KG_TITLE"),id:"moveSignature",enable:function(e){return this.canMove(e)},exec:function(e){var a,t,i=this;a=!0,t=e,0<=V().jquery.indexOf("1.4")?(V(t).live("touchstart mousedown",".kg-icon-move",function(e){a&&i.runMove(e,t)}),V(t).live("touchstart mouseover",".kg-icon-move",function(e){var i;void 0!==W.options.extra&&(i=t.attributes.signatureid.nodeValue)&&void 0!==W.options.extra[i]&&W.options.extra[i].icon_move&&(a=W.options.extra[i].icon_move())})):(V(t).on("touchstart mousedown",".kg-icon-move",function(e){a&&i.runMove(e,t)}),V(t).on("touchstart mouseover",".kg-icon-move",function(e){var i;void 0!==W.options.extra&&(i=t.attributes.signatureid.nodeValue)&&void 0!==W.options.extra[i]&&W.options.extra[i].icon_move&&(a=W.options.extra[i].icon_move())}))}}),W.addIcon({iconClass:"kg-icon-move-",title:L.msg("SignatureMoveNot","KG_TITLE"),id:"doornotmove",enable:!0,click:function(e){function i(e){e.nextElementSibling,V(e).attr("extval")&&"0"==V(e).attr("extval")?a.changeMoveAble(!1):a.changeMoveAble(!0)}var a=this,t=(e.preventDefault(),e.stopPropagation(),e.target.parentElement);a.signatureData.html2?a.error({errcode:"11112"},"then"):"server"==W.options.sealType?W.options.keysn==a.signatureData.keysn||W.options.usercode==a.signatureData.usercode||"scanStamp"===a.signatureData.stampType||a.signatureData.seal.esid?i(t):a.error({errcode:"11111"},"then"):"client"==W.options.sealType&&a.sealService.getKeysn({},function(e){e==a.signatureData.keysn||a.signatureData.esid?i(t):a.error({errcode:"11111"},"then")})}}),W.addIcon({iconClass:"kg-icon-remove",title:L.msg("RevokeSignature","KG_TITLE"),id:"revokeSignature",enable:function(){return this.canDelete()},click:function(e){e.preventDefault(),e.stopPropagation(),this.revokeSignature()}}),W.addIcon({iconClass:"kg-icon-sign",title:L.msg("SignSignature","KG_TITLE"),id:"sign",enable:function(){return this.canSign()},click:function(e){e.preventDefault(),e.stopPropagation();e=this._verify(null,{sucCall:function(){this.signSignature()}});null!=e&&(e?this.signSignature():W.alert(L.msg("invalid_signdata","KG_MSG"),function(){W.options.beginDlgOkCall&&W.options.beginDlgOkCall.call()},function(){W.options.beginDlgShowCall&&W.options.beginDlgShowCall.call()}))}}),W.addIcon({iconClass:"kg-icon-signverify",title:L.msg("SignVerify","KG_TITLE"),id:"verifysign",enable:function(){return this.signatureData.signMeta},click:function(e){e.preventDefault(),e.stopPropagation();var i=this;i.verifySignData(function(e){e.errcode?i.error(e):i.signInfo()})}}),W.addIcon({iconClass:"kg-icon-sealinfo",title:L.msg("SignatureVerify","KG_TITLE"),id:"signatureInfo",enable:!0,click:function(e){e.preventDefault(),e.stopPropagation();function i(e){W.options.autoCertMode&&a.signatureData.signMeta?a.verifySignData(function(e){e.errcode?a.error(e):a.signatureInfo(e.result)}):a.signatureInfo(e)}var a=this,e=this._verify(null,{sucCall:function(e){i(e)}});void 0!==W.options.verifySignatureInfo&&W.options.verifySignatureInfo&&W.options.verifySignatureInfo(this.modified,this.modifiedItems,this.signatureData)||null!=e&&i(e)}}),W}));
//V3.0.0.572