!function(t,e){var a;"function"==typeof define&&define.amd?define([],function(){return t.SignaturePad=e()}):"object"==typeof exports?module.exports=e():(a=e(),t.SignaturePad=a.SignaturePad,t.Painting=a.Painting)}(this,function(){var E;function t(t,e){this.times=1,this.canvas=t,this.isSign=!1,e.isMobile=/phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(navigator.userAgent),this.painting=new a("canvasId",e),this.initCanvas(e),this.painting.touchstartCallback=e.onBegin,this.painting.touchendCallback=e.onEnd,this.lineSize=e.lineSize||5,this.setSize(this.lineSize),this.lineMax=e.lineMax||4,this.painting.setLineMax(this.lineMax),this.lineMin=e.lineMin||.5,this.painting.setLineMin(this.lineMin),this.smoothness=e.smoothness||100,this.painting.setSmoothness(this.smoothness)}function a(t,o,e){var a,n=!1,r=/phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(navigator.userAgent);function i(t){return t.type.indexOf("mouse")<0&&(a=!0),t}function s(t){return(t=i(t||window.event)).stopPropagation(),"mousedown"!=t.type&&"touchstart"!=t.type||$(t.target)[0].id!=C.canvasName||a&&1<t.touches.length?0:((1===t.which||a&&1==t.touches.length)&&(n=!0,"svg"!=C.writeType&&(g.fillStyle=x,g.globalAlpha=p),t=N(a?t.touches[0]:t),P=t,w.unshift({time:(new Date).getTime(),dis:0,x:t.x,y:t.y}),M&&(F={top:t.y,right:t.x,bottom:t.y,left:t.x},M=!1),B(w)),void("function"==typeof C.touchstartCallback&&C.touchstartCallback()))}function h(t){if(!(t.length<=1)){var e,a,n,i,o,r,s,h,l;t.length<=2?(e=t[1].x,i=t[1].y,a=e+.5*((n=t[1].x+.5*(t[0].x-t[1].x))-e),o=i+.5*((r=t[1].y+.5*(t[0].y-t[1].y))-i),h=.5*((s=t[1].r)+(l=t[1].r+.5*(t[0].r-t[1].r)))):(e=t[2].x+.5*(t[1].x-t[2].x),i=t[2].y+.5*(t[1].y-t[2].y),a=t[1].x,o=t[1].y,n=a+.5*(t[0].x-a),r=o+.5*(t[0].y-o),s=t[2].r+.5*(t[1].r-t[2].r),l=(h=t[1].r)+.5*(t[0].r-h));for(var c=[],d=0;d<5;d++){var g,v=d/4,p=(1-v)*(1-v)*e+2*v*(1-v)*a+v*v*n,v=(1-v)*(1-v)*i+2*v*(1-v)*o+v*v*r,y=s+(l-s)/5*d;c.push({x:p,y:v,r:y}),3==c.length&&((g=function(t,e,a,n,i,o,r,s){var h,l,c,d,g,v,p,y=[];h=n-t,l=i-e,p=2*Math.sqrt(h*h+l*l+1e-4),c=l=l/p*a,a=-(h=h/p*a),d=n-o,g=i-r,p=2*Math.sqrt(d*d+g*g+1e-4),v=-(g=g/p*s),p=d=d/p*s,y.push({mx:t+c,my:e+a,color:"#1A1A1A"}),y.push({c1x:n+c,c1y:i+a,c2x:n+v,c2y:i+p,ex:o+v,ey:r+p}),y.push({c1x:o+v-d,c1y:r+p-g,c2x:o-v-d,c2y:r-p-g,ex:o-v,ey:r-p}),y.push({c1x:n-v,c1y:i-p,c2x:n-c,c2y:i-a,ex:t-c,ey:e-a}),y.push({c1x:t-c-h,c1y:e-a-l,c2x:t+c-h,c2y:e+a-l,ex:t+c,ey:e+a}),y[0].mx=y[0].mx.toFixed(1),y[0].mx=parseFloat(y[0].mx),y[0].my=y[0].my.toFixed(1),y[0].my=parseFloat(y[0].my);for(var f=1;f<y.length;f++)y[f].c1x=y[f].c1x.toFixed(1),y[f].c1x=parseFloat(y[f].c1x),y[f].c1y=y[f].c1y.toFixed(1),y[f].c1y=parseFloat(y[f].c1y),y[f].c2x=y[f].c2x.toFixed(1),y[f].c2x=parseFloat(y[f].c2x),y[f].c2y=y[f].c2y.toFixed(1),y[f].c2y=parseFloat(y[f].c2y),y[f].ex=y[f].ex.toFixed(1),y[f].ex=parseFloat(y[f].ex),y[f].ey=y[f].ey.toFixed(1),y[f].ey=parseFloat(y[f].ey);return y}(c[0].x,c[0].y,c[0].r,c[1].x,c[1].y,(c[1].r,c[2].x),c[2].y,c[2].r))[0].color=x,C.bethelPoint.push(g),W(g,1),c=[{x:p,y:v,r:y}])}}}function f(t){return t=t.toFixed(4),parseFloat(t)}function u(t){if(/^(rgb|RGB)/.test(t)){for(var e=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),a="#",n=0;n<e.length;n++){var i=Number(e[n]).toString(16);a+=i=i.length<2?"0"+i:i}return a=7!==a.length?t:a}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t)){var o=t.replace(/#/,"").split("");if(6===o.length)return t;if(3===o.length){for(var r="#",n=0;n<o.length;n+=1)r+=o[n]+o[n];return r}}return t}this.writeType="canvas",this.canvasName=t,this.lineMin=.5,this.lineMax=2,this.pressure=1,this.linePrack=[],this.chirography=[],this.currentChirography={},this.transformpdfData=[],this.canvasWidth=0,this.canvasHeight=0,this.currentBethelLinePoint=[],this.bethelPoint=[];function d(t,e,a,n,i){return{x:t*Math.cos(a)-e*Math.sin(a)+n,y:t*Math.sin(a)+e*Math.cos(a)+i}}var l=null,c=null,g=null,v=null,p=1,x="#1A1A1A",y=1.5,m=100,b=0,P={},w=[],k=2,S=2,M=!0,F={top:0,right:0,bottom:0,left:0},C=this,I=(this.touchstartCallback="",this.touchmoveCallback="",this.touchendCallback="",this.clearCanvasCallback="",this.init=function(t,e,a,n){C.writeType="canvas",C.canvas=o.dlg.find("#"+C.canvasName)[0],(g=C.canvas.getContext("2d")).rotate(45*Math.PI/180),g.fillStyle="rgba(0,0,0,1)";var i=C.canvas;k=(a=null==a?720:a)/(t=null==t?720:t),S=(n=null==n?1280:n)/(e=null==e?1280:e),$(i).width(t),$(i).attr("width",a),$(i).height(e),$(i).attr("height",n),C.canvasWidth=a,C.canvasHeight=n,r||o.dlg.find("#"+C.canvasName)[0].addEventListener("mousedown",s,!1),r||o.dlg.find("#"+C.canvasName)[0].addEventListener("mousemove",I,!1),r||o.dlg.find("#"+C.canvasName)[0].addEventListener("mouseup",H,!1),r||o.dlg.find("#"+C.canvasName)[0].addEventListener("mouseout",H,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("touchstart",s,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("touchmove",I,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("touchend",H,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("touchcancel",L,!1)},this.initSVG=function(t,e,a,n){C.writeType="svg",k=(a=null==a?720:a)/(t=null==t?720:t),S=(n=null==n?1280:n)/(e=null==e?1280:e),C.canvas=o.dlg.find("#"+C.canvasName)[0],(v=new Snap(C.canvas)).attr({width:t,height:e,viewBox:"0, 0, "+a+", "+n}),o.dlg.find("#"+C.canvasName)[0].addEventListener("mousedown",s,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("mousemove",I,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("mouseup",H,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("mouseout",H,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("touchstart",s,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("touchmove",I,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("touchend",H,!1),o.dlg.find("#"+C.canvasName)[0].addEventListener("touchcancel",L,!1)},this.newCanvas=function(t,e,a,n,i){var o=this.canvas,r=$(o)[0].id,r=E.getElementById(r).getContext("2d"),s=r.getImageData(0,0,o.width,o.height),t=(k=(a=null==a?720:a)/(t=null==t?720:t),S=(n=null==n?1280:n)/(e=null==e?1280:e),$(o).width(t),$(o).attr("width",a),$(o).height(e),$(o).attr("height",n),C.canvasWidth=a,C.canvasHeight=n,parseInt(o.width*(1-1/i)));o.height,console.log(t),r.putImageData(s,parseInt(t),0)},this.setCanvasSize=function(t,e,a,n,i,o){var r=this,s=(null==t&&(t=r.width),null==e&&(e=r.height),null==innerWidth&&(innerWidth=r.innverWidth),null==innerHeight&&(innerHeight=r.innerheight),g.getImageData(0,0,r.innerWidth,r.innerHeight));k=innerWidth/t,S=innerHeight/e,$(r.canvas).width(t),$(r.canvas).attr("width",innerWidth),$(r.canvas).height(e),$(r.canvas).attr("height",innerHeight),r.canvasWidth=innerWidth,r.canvasHeight=innerHeight,g.putImageData(s,0,0)},this.setLineColor=function(t){x=t},this.setLineSize=function(t){y=t},this.setSmoothness=function(t){m=t},this.setLineMin=function(t){this.lineMin=t},this.setLineMax=function(t){this.lineMax=t},this.showAllSign=function(t){var e=this.canvas,e=$(e)[0].id,e=E.getElementById(e),a=e.getContext("2d"),t=parseFloat(1/t),a=(a.scale(t,t),new Image);return a.src=e.toDataURL("image/png"),a},function(t){var t=t||window.event;return C.touchmoveCallback&&C.touchmoveCallback(),"mousemove"!=t.type&&"touchmove"!=t.type||$(t.target)[0].id!=C.canvasName?0:a&&1<t.touches.length?(t.stopPropagation(),t.preventDefault(),!t.cancelable||t.defaultPrevented||t.preventDefault(),0):((n||a&&1==t.touches.length)&&(t.cancelable&&!t.defaultPrevented&&t.preventDefault(),(t=N(a?t.touches[0]:t)).y<F.top&&(F.top=t.y),t.y<0&&(F.top=0),t.x>F.right&&(F.right=t.x),C.canvasWidth-t.x<=0&&(F.right=C.canvasWidth),t.y>F.bottom&&(F.bottom=t.y),C.canvasHeight-t.y<=0&&(F.bottom=C.canvasHeight),t.x<F.left&&(F.left=t.x),t.x<0&&(F.left=0),b=P,P=t,w.unshift({time:(new Date).getTime(),dis:C.distance(P,b),x:t.x,y:t.y}),B(w)),void("function"==typeof C.touchmoveCallback&&C.touchmoveCallback()))}),H=function(t){return(t=i(t||window.event)).stopPropagation(),"mouseup"!=t.type&&"mouseout"!=t.type&&"touchend"!=t.type||$(t.target)[0].id!=C.canvasName?0:void((1===t.which&&n||a&&!(1<t.touches.length))&&(n=!1,t=N(a?t.changedTouches[0]:t),b=P,P=t,w.unshift({time:(new Date).getTime(),dis:C.distance(P,b),x:t.x,y:t.y}),2<w.length&&(w[0].time,w[w.length-1].time,w.length),w=("canvas"==C.writeType?(B(w),t={lineSize:y,lineColor:x},C.chirography.unshift(t),C.linePrack.unshift(w)):C.overlapInCanvas(w),[]),"function"==typeof C.touchendCallback&&C.touchendCallback()))},L=function(t){(t=i(t||window.event)).type},N=function(t){if(null==l||null==C.offsetTop)if("svg"==C.writeType)l=$(C.canvas).offset().left,c=$(C.canvas).offset().top;else{var e=0;l=C.canvas.offsetLeft,c=C.canvas.offsetTop;for(var a=C.canvas.parentNode;e<100&&a.tagName&&"BODY"!=a.tagName;)l+=a.offsetLeft,c+=a.offsetTop,a=a.parentNode,e++}var n=t.clientX-l,t=t.clientY-c+100+o.toolBarHeight;return o.hideToolBar&&(t-=o.toolBarHeight),window!=top&&window.iframeDialog&&(t+=$(window.top.document).find(".kg-hw-content").height()),o.notYTop&&(t-=100),{x:n*=k,y:t*=S}},B=function(t){(function(t){if(t.length<=1)return t[0].r=1;C.distance({x:t[0].x,y:t[0].y},{x:t[1].x,y:t[1].y});for(var e=0,a=0,n=0;n<t.length-1&&(e+=t[n].dis,a+=t[n].time-t[n+1].time,!(m<e));n++);t[0].r=Math.min(a/+e*C.pressure+C.lineMin,C.lineMax)*y})(t),h(t)},W=(this.distance=function(t,e){var a=e.x-t.x,e=e.y-t.y;return Math.sqrt(a*a+e*e)},this.reWriteCanvas=function(){g.restore()},this.writeCanvas=function(){C.clearCanvas();for(var t=0;t<C.linePrack.length;t++){var e=C.linePrack[C.linePrack.length-t-1],a=[];g.fillStyle=C.chirography[C.chirography.length-t-1].lineColor,y=C.chirography[C.chirography.length-t-1].lineSize,x=C.chirography[C.chirography.length-t-1].lineColor;for(var n=0;n<e.length;n++)a.unshift(e[e.length-n-1]),B(a)}return!0},this.clearCanvas=function(){"function"==typeof C.clearCanvasCallback&&C.clearCanvasCallback(),g&&g.clearRect(0,0,C.canvas.width,C.canvas.height),v&&v.clear()},this.clearCanvasAndData=function(){C.clearCanvas(),C.linePrack=[],C.chirography=[],C.bethelPoint=[],M=!0},this.overlapInCanvas=function(t){for(var e=t[0],a=0;a<C.linePrack.length;a++)for(var n=C.linePrack[a],i=0;i<n.length;i++)if((e.x-n[i].x)*(e.x-n[i].x)+(e.y-n[i].y)*(e.y-n[i].y)<400){C.linePrack.splice(a,1),C.chirography.splice(a,1),C.writeCanvas();break}},this.overlapLine=function(t,e,a,n){g.isPointInPath(20,50)},function(t,e,a){if("svg"==C.writeType){void 0===a&&(a=t[0].color);for(var n="M "+t[0].mx+" "+t[0].my+" C",i=1;i<t.length;i++)n=(n=(n+=" "+t[i].c1x+" "+t[i].c1y)+(" "+t[i].c2x+" "+t[i].c2y))+(" "+t[i].ex+" "+t[i].ey);v.path(n).attr("stroke",a).attr("stroke-width",1).attr("fill",a)}else{g.beginPath(),g.moveTo(t[0].mx,t[0].my),null!=a?(g.fillStyle=a,g.strokeStyle=a):(g.fillStyle=t[0].color,g.strokeStyle=t[0].color);for(var o=1;o<t.length;o++)g.bezierCurveTo(t[o].c1x,t[o].c1y,t[o].c2x,t[o].c2y,t[o].ex,t[o].ey);g.stroke(),null!=e&&g.fill()}});this.saveImage=function(){return this.canvas.toDataURL.apply(this.canvas,arguments)},this.coordinateSystem=function(t,e){return{x:t,y:e}},this.transformpdf=function(){for(var t=this.linePrack,e=0;e<t.length;e++){var a=t[e];if(!(a.length<2)){for(var n,i,o,r,s,h,l,c,d,g,v=0,p=a.length,y=+a[p-1].x+0+.1,f=+a[p-1].y+0,u=a[p-1].r,x=+a[p-2].x+0+.1,m=+a[p-2].y+0,b=a[p-2].r,P=x-y,w=m-f,k=2*Math.sqrt(P*P+w*w+1e-4),S=w=w/k*1*u,M=-(P=P/k*1*u),F=[],v=3;v<=a.length;v++)i=+a[p-v].x+0,r=+a[p-v].y+0,s=(b+(h=a[p-v].r))/2,l=x-(n=(x+i)/2),d=-(c=(c=m-(o=(m+r)/2))/(k=2*Math.sqrt(l*l+c*c+1e-4))*1*s),g=l=l/k*1*s,F[0]=C.coordinateSystem(y+S,f+M),F[1]=C.coordinateSystem(x+S,m+M),F[2]=C.coordinateSystem(x+d,m+g),F[3]=C.coordinateSystem(n+d,o+g),F[4]=C.coordinateSystem(n+d-l,o+g-c),F[5]=C.coordinateSystem(n-d-l,o-g-c),F[6]=C.coordinateSystem(n-d,o-g),F[7]=C.coordinateSystem(x-d,m-g),F[8]=C.coordinateSystem(x-S,m-M),F[9]=C.coordinateSystem(y-S,f-M),F[10]=C.coordinateSystem(y-S-P,f-M-w),F[11]=C.coordinateSystem(y+S-P,f+M-w),F[12]=C.coordinateSystem(y+S,f+M),y=n,f=o,x=i,m=r,b=h,P=-l,w=-c,S=d,M=g,C.transformpdfData.push(F);n=+a[0].x+0,o=+a[0].y+0,s=a[0].r,l=x-n,d=-(c=(c=m-o)/(k=2*Math.sqrt(l*l+c*c+1e-4))*1*s),g=l=l/k*1*s,F[0]=C.coordinateSystem(y+S,f+M),F[0]=C.coordinateSystem(y+S,f+M)}}},this.getExtrema=function(){var t=this;F={top:t.canvasHeight*S,right:0,bottom:0,left:t.canvasWidth*k};for(var e=0;e<t.linePrack.length;e++)for(var a=0;a<t.linePrack[e].length;a++)t.linePrack[e][a].y<F.top&&(F.top=t.linePrack[e][a].y),t.linePrack[e][a].y>F.bottom&&(F.bottom=t.linePrack[e][a].y),t.linePrack[e][a].x>F.right&&(F.right=t.linePrack[e][a].x),t.linePrack[e][a].x<F.left&&(F.left=t.linePrack[e][a].x)};this.calcRotateCanvasInfo=function(){for(var t,e,a,n,i=this,o=[],r=[],s=F.bottom-F.top+60,h=F.right-F.left+60,l=0;l<i.linePrack.length;l++){o[l]=[],r[l]={lineSize:i.chirography[l].lineSize,lineColor:i.chirography[l].lineColor};for(var c=0;c<i.linePrack[l].length;c++)n=i.linePrack[l][c].x-F.left+30,t=i.linePrack[l][c].y-F.top+30,e=-Math.PI/2,a=F.right-F.left+60,n=d(n,t,e,0,a),o[l][c]={x:f(n.x),y:f(n.y),dis:i.linePrack[l][c].dis,time:i.linePrack[l][c].time,r:i.linePrack[l][c].r}}return{canvasWidth:s/k,canvasHeight:h/S,canvasInnerWidth:s,canvasInnerHeight:h,linePrack:o,chirography:r,bethelPoint:i.bethelPoint}},this.destory=function(){},this.centreRotate=function(t){for(var e,a=-(Math.min(C.canvasWidth*Math.cos(t),0)+Math.min(C.canvasHeight*Math.cos(t+Math.PI/2),0)),n=-(Math.min(C.canvasWidth*Math.sin(t),0)+Math.min(C.canvasHeight*Math.sin(t+Math.PI/2),0)),i=0;i<C.bethelPoint.length;i++){e=d(C.bethelPoint[i][0].mx,C.bethelPoint[i][0].my,t,a,n),C.bethelPoint[i][0].mx=e.x,C.bethelPoint[i][0].my=e.y;for(var o=1;o<C.bethelPoint[i].length;o++)e=d(C.bethelPoint[i][o].c1x,C.bethelPoint[i][o].c1y,t,a,n),C.bethelPoint[i][o].c1x=e.x,C.bethelPoint[i][o].c1y=e.y,e=d(C.bethelPoint[i][o].c2x,C.bethelPoint[i][o].c2y,t,a,n),C.bethelPoint[i][o].c2x=e.x,C.bethelPoint[i][o].c2y=e.y,e=d(C.bethelPoint[i][o].ex,C.bethelPoint[i][o].ey,t,a,n),C.bethelPoint[i][o].ex=e.x,C.bethelPoint[i][o].ey=e.y}var r=Math.abs(C.canvasWidth*Math.cos(t))+Math.abs(C.canvasHeight*Math.cos(t+Math.PI/2)),s=Math.abs(C.canvasWidth*Math.sin(t))+Math.abs(C.canvasHeight*Math.sin(t+Math.PI/2));C.canvasWidth=r,C.canvasHeight=s},this.toSVG=function(t){for(var e=this,a=t?new Snap(t):new Snap,n=0;n<e.bethelPoint.length;n++){for(var i="M "+f(e.bethelPoint[n][0].mx/e.canvasHeight)+" "+f(e.bethelPoint[n][0].my/e.canvasHeight)+" C",o=1;o<e.bethelPoint[n].length;o++)i=(i=(i+=" "+f(e.bethelPoint[n][o].c1x/e.canvasHeight)+" "+f(e.bethelPoint[n][o].c1y/e.canvasHeight))+(" "+f(e.bethelPoint[n][o].c2x/e.canvasHeight)+" "+f(e.bethelPoint[n][o].c2y/e.canvasHeight)))+(" "+f(e.bethelPoint[n][o].ex/e.canvasHeight)+" "+f(e.bethelPoint[n][o].ey/e.canvasHeight));a.path(i).attr("stroke",e.bethelPoint[n][0].color).attr("stroke-width",1/e.canvasHeight).attr("fill",e.bethelPoint[n][0].color)}t="0 0 "+f(e.canvasWidth/e.canvasHeight)+" 1";return a.attr("viewBox",t),a.attr("width",f(e.canvasWidth/e.canvasHeight)+"px"),a.attr("height","1px"),a.outerSVG()},this.toCommonSVG=function(t){for(var e=t?new Snap(t):new Snap,a=0;a<C.bethelPoint.length;a++){for(var n="M "+f(C.bethelPoint[a][0].mx)+" "+f(C.bethelPoint[a][0].my)+" C",i=1;i<C.bethelPoint[a].length;i++)n=(n=(n+=" "+f(C.bethelPoint[a][i].c1x)+" "+f(C.bethelPoint[a][i].c1y))+(" "+f(C.bethelPoint[a][i].c2x)+" "+f(C.bethelPoint[a][i].c2y)))+(" "+f(C.bethelPoint[a][i].ex)+" "+f(C.bethelPoint[a][i].ey));e.path(n).attr("stroke",C.bethelPoint[a][0].color).attr("stroke-width",1).attr("fill",C.bethelPoint[a][0].color)}t="0 0 "+C.canvasWidth+" "+C.canvasHeight;return e.attr("viewBox",t),e.attr("width",C.canvasWidth+"px"),e.attr("height",C.canvasHeight+"px"),e.outerSVG()},this.pathToSVG=function(l){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,c=$("body").width(),d=$("body").height();if(1==t){var t="svg"+Math.floor(1e4*Math.random()),e=$("<svg id="+t+"></svg>"),a=(e.css("position","fixed"),$("body").prepend(e),new Snap("#"+t));a.attr("width",c+"px"),a.attr("height",d+"px");for(var n=0;n<l.length;n++){for(var i="M "+f(l[n][0].mx*c)+" "+f((1-l[n][0].my)*d)+" C",o=1;o<l[n].length;o++)i=(i=(i+=" "+f(l[n][o].c1x*c)+" "+f((1-l[n][o].c1y)*d))+(" "+f(l[n][o].c2x*c)+" "+f((1-l[n][o].c2y)*d)))+(" "+f(l[n][o].ex*c)+" "+f((1-l[n][o].ey)*d));a.path(i).attr("stroke",l[n][0].color).attr("stroke-width",1).attr("fill","none")}}else Object.keys(l).forEach(function(t){for(var e=l[t],a=0;a<e.length;a++){var n="svg"+a+Math.floor(1e4*Math.random()),i=$("<svg id="+n+"></svg>"),o=(i.css("position","fixed"),$("body").prepend(i),new Snap("#"+n));o.attr("width",c+"px"),o.attr("height",d+"px");for(var r=0;r<e[a].length;r++){for(var s="M "+e[a][r][0].mx*c+" "+(1-e[a][r][0].my)*d+" C",h=1;h<e[a][r].length;h++)s=(s=(s+=" "+e[a][r][h].c1x*c+" "+(1-e[a][r][h].c1y)*d)+(" "+e[a][r][h].c2x*c+" "+(1-e[a][r][h].c2y)*d))+(" "+e[a][r][h].ex*c+" "+(1-e[a][r][h].ey)*d);o.path(s).attr("stroke",e[a][r][0].color).attr("stroke-width",1).attr("fill",e[a][r][0].color)}}})},this.SVGToPath=function(t,e,a,l,c,d,g,n,i,v){var p,o,y;{if(void 0!==t&&void 0!==e&&void 0!==a&&void 0!==l&&void 0!==c&&void 0!==d&&void 0!==g)return e=new Snap(e),p=[],void 0!==n&&void 0!==i&&void 0!==v||(o=parseFloat(e.attr("height")),n=parseFloat(e.getBBox().width),i=parseFloat(e.getBBox().height),v=o/i),n=e.selectAll("path"),y="",n.forEach(function(t){for(var e,a=t.attr("d").split(" "),n=[],i=0;i<a.length;i++)2==(e=a[i].split(",")).length?(n.push(e[0]),n.push(e[1])):n.push(e[0]);for(var o=[],i=0;i<n.length;i++){var r,s=n[i];if(isNaN(parseInt(s.slice(0,1)))){if(y=s.slice(0,1),1==n[i].length&&"Z"!=y)continue;s=s.slice(1)}switch(y){case"M":r=n[i+1],i++;var h="none"==(h=t.attr("stroke"))?"#000000":u(h);console.log(f(1-(parseFloat(r)*v+g)/c)),o.push({mx:f(parseFloat(s)*v/l+d/l),my:f(1-(parseFloat(r)*v+g)/c),color:h});break;case"Q":o.push({c1x:f(parseFloat(s)*v/l+d/l),c1y:f(1-(parseFloat(n[i+1])*v+g)/c),c2x:f(parseFloat(s)*v/l+d/l),c2y:f(1-(parseFloat(n[i+1])*v+g)/c),ex:f(parseFloat(n[i+2])*v/l+d/l),ey:f(1-(parseFloat(n[i+3])*v+g/c))}),i+=3;break;case"C":o.push({c1x:f(parseFloat(s)*v/l+d/l),c1y:f(1-(parseFloat(n[i+1])*v+g)/c),c2x:f(parseFloat(n[i+2])*v/l+d/l),c2y:f(1-(parseFloat(n[i+3])*v+g)/c),ex:f(parseFloat(n[i+4])*v/l+d/l),ey:f(1-(parseFloat(n[i+5])*v+g)/c)}),i+=5;break;case"L":o.push({c1x:f(parseFloat(s)*v/l+d/l),c1y:f(1-(parseFloat(n[i+1])*v+g)/c),c2x:f(parseFloat(s)*v/l+d/l),c2y:f(1-(parseFloat(n[i+1])*v+g)/c),ex:f(parseFloat(s)*v/l+d/l),ey:f(1-(parseFloat(n[i+1])*v+g)/c)}),i++;break;case"Z":p.push(o),o=[]}}o.length&&p.push(o)}),void 0===t[a]&&(t[a]=[]),t[a].push(p),t;console.log("参数缺失")}},this.SVGToPathNoPage=function(t,l,c,d,g,e,a,v){var p,n,y;{if(void 0!==t&&void 0!==l&&void 0!==c&&void 0!==d&&void 0!==g)return t=new Snap(t),p=[],void 0!==e&&void 0!==a&&void 0!==v||(n=parseFloat(t.attr("height")),e=parseFloat(t.getBBox().width),a=parseFloat(t.getBBox().height),v=a/n),e=t.selectAll("path"),y="",e.forEach(function(t){for(var e,a=t.attr("d").split(" "),n=[],i=0;i<a.length;i++)2==(e=a[i].split(",")).length?(n.push(e[0]),n.push(e[1])):n.push(e[0]);for(var o=[],i=0;i<n.length;i++){var r,s=n[i];if(isNaN(parseInt(s.slice(0,1)))){if(y=s.slice(0,1),1==n[i].length&&"Z"!=y)continue;s=s.slice(1)}switch(y){case"M":r=n[i+1],i++;var h="none"==(h=t.attr("stroke"))?"#000000":u(h);o.push({mx:f(parseFloat(s)*v/l+d/l),my:f(1-(parseFloat(r)*v+g)/c),color:h});break;case"Q":o.push({c1x:f(parseFloat(s)*v/l+d/l),c1y:f(1-(parseFloat(n[i+1])*v+g)/c),c2x:f(parseFloat(s)*v/l+d/l),c2y:f(1-(parseFloat(n[i+1])*v+g)/c),ex:f(parseFloat(n[i+2])*v/l+d/l),ey:f(1-(parseFloat(n[i+3])*v+g/c))}),i+=3;break;case"C":o.push({c1x:f(parseFloat(s)*v/l+d/l),c1y:f(1-(parseFloat(n[i+1])*v+g)/c),c2x:f(parseFloat(n[i+2])*v/l+d/l),c2y:f(1-(parseFloat(n[i+3])*v+g)/c),ex:f(parseFloat(n[i+4])*v/l+d/l),ey:f(1-(parseFloat(n[i+5])*v+g)/c)}),i+=5;break;case"L":o.push({c1x:f(parseFloat(s)*v/l+d/l),c1y:f(1-(parseFloat(n[i+1])*v+g)/c),c2x:f(parseFloat(s)*v/l+d/l),c2y:f(1-(parseFloat(n[i+1])*v+g)/c),ex:f(parseFloat(s)*v/l+d/l),ey:f(1-(parseFloat(n[i+1])*v+g)/c)}),i++;break;case"Z":p.push(o),o=[]}}o.length&&p.push(o)}),p;console.log("参数缺失")}}}return E=document,t.prototype.initCanvas=function(t){var e=t.canvas_width,t=t.canvas_height;this.painting.init(e,t,e*this.times,t*this.times),this.canvas.getContext("2d").fillStyle="rgba(0,0,0,0)"},t.prototype.setSize=function(t){this.painting.setLineSize(t)},t.prototype.setColor=function(t){this.painting.setLineColor(t)},t.prototype.clear=function(){this.isSign=!1,this.painting.clearCanvasAndData()},t.prototype.setWebHandWrite=function(t,e){var a=this.canvas.getContext("2d");a.textAlign="left",a.textBaseline="bottom",a.shadowBlur=0,a.font=e.fontStyle+" "+parseFloat(e.fontSize)*this.times+"px "+e.fontFamily,a.fillStyle=e.fontColor;for(var n=0;t&&n<t.length;n++){var i=t[n];a.fillText(i.txt,i.left*this.times,i.top*this.times)}},t.prototype.setImageHandWrite=function(t){var e=this.canvas.getContext("2d"),a=parseInt(t.style.top),n=parseInt(t.style.left),i=parseInt(t.style.width),o=parseInt(t.style.height);e.drawImage(t,n,a,i,o)},t.prototype.toTransparent=function(){for(var t=this.canvas.getContext("2d"),e=t.getImageData(0,0,this.canvas.width,this.canvas.height),a=e.data,n=0;n<a.length;n+=4)255==a[n]&&255==a[n+1]&&255==a[n+2]&&(a[n]=0,a[n+1]=0,a[n+2]=0,a[n+3]=0);t.putImageData(e,0,0)},t.prototype.toDataURL=function(a,n){this.toTransparent();for(var t=this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height),e=t.data,i=t.width,o=0,r=t.height,s=0,h=0;h<this.canvas.width;h++)for(var l=0;l<t.height;l++){var c=4*(h+t.width*l);(0<e[c]||0<e[1+c]||e[2+c]||0<e[3+c])&&(s=Math.max(l,s),o=Math.max(h,o),r=Math.min(l,r),i=Math.min(h,i))}i++,o++,r++,s++;var d=this.painting.saveImage(),g=new Image;g.src=d,g.onload=function(){var t=E.createElement("canvas"),e=(t.width=o-i,t.height=s-r,t.getContext("2d")),e=(1==n.mode&&n.noCutting&&(t.width=n.display_width,t.height=n.display_height,r=i=0),0!=n.mode&&2!=n.mode||!n.noCutting||(t.width=t.width>n.display_width?t.width:n.display_width,t.height=t.height>n.display_height?t.height:n.display_height,r=i=0),e.drawImage(g,i,r,t.width,t.height,0,0,t.width,t.height),{});e.imageData=t.toDataURL(),e.width=t.width,e.height=t.height,a(e)}},{SignaturePad:t,Painting:a}});
//V3.0.0.572